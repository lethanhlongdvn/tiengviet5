<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư của bố - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Nunito & Merriweather -->
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            font-size: 18px;
            line-height: 1.9;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-open .accordion-content {
            max-height: 1000px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .bg-paper {
            background-color: #fdfcf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        .poem-line {
            margin-bottom: 0.5rem;
        }

        /* Tab Styles */
        .tab-btn.active {
            border-bottom: 4px solid #1d4ed8;
            color: #1d4ed8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }

        .quiz-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .quiz-option.selected {
            border-color: #2563eb;
            background-color: #dbeafe;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 py-1 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <a href="index.html" class="flex items-center space-x-2">
                    <div
                        class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white text-lg font-bold">
                        E</div>
                    <span class="text-lg font-extrabold text-blue-600 tracking-tight">EduRobot - <span
                            class="text-yellow-500">Tiếng Việt 5</span></span>
                </a>
            </div>

            <ul class="hidden md:flex space-x-6 font-semibold text-gray-600 text-sm">
                <li><a href="ve-dep-cuoc-song.html"
                        class="hover:text-blue-500 transition-colors font-bold text-blue-600 border-b-2 border-blue-600">Bài
                        học</a></li>
                <li><a href="#" onclick="openTeacherStats()" class="hover:text-blue-500 transition-colors">Thống kê</a>
                </li>
                <li><a href="#" class="hover:text-blue-500 transition-colors">Liên hệ</a></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-1">

        <div
            class="flex flex-col md:flex-row md:items-center justify-between border-b border-gray-200 mb-6 bg-white rounded-t-2xl overflow-hidden shadow-sm">
            <div class="flex-1 flex">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-3 text-center font-bold text-gray-500 transition-all hover:bg-blue-50 border-r border-gray-100">
                    1. Bài thơ
                </button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-3 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                    2. Luyện tập
                </button>
            </div>

            <div id="audio-container" class="p-2 md:pr-4">
                <div
                    class="flex items-center space-x-3 bg-blue-50/50 rounded-full p-1 pr-6 border border-blue-100 shadow-sm transition-all hover:bg-blue-50">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-11 h-11 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-md active:scale-95">
                        <svg id="playIcon" class="w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg>
                    </button>
                    <div class="flex flex-col">
                        <p class="text-[11px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1">
                            NGHE ĐỌC MẪU</p>
                        <p id="audioStatus" class="text-[12px] text-gray-400 font-bold italic leading-none">Đang dừng...
                        </p>
                    </div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/thuguibo.wav" type="audio/wav">
                </audio>
            </div>
        </div>

        <div id="tab-lesson" class="tab-content active">
            <div class="flex flex-col lg:flex-row gap-8">

                <!-- Cột trái (70%) - Bài thơ -->
                <section class="w-full lg:w-[70%] text-center">
                    <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-2 md:p-3">

                        <div class="p-6 md:p-10 bg-paper rounded-2xl shadow-inner border border-gray-50">
                            <div class="serif-font text-gray-800">
                                <h1 class="text-3xl font-black mb-2 text-blue-900 text-center uppercase tracking-tight">
                                    Thư của bố</h1>
                                <p class="text-center text-sm italic text-gray-500 mb-8">Tác giả: Thuỵ Anh</p>

                                <div class="text-left max-w-2xl mx-auto space-y-6">
                                    <!-- Khổ 1 -->
                                    <div class="mb-6">
                                        <p class="poem-line">Con lớn lên, quen vắng bố trong nhà</p>
                                        <p class="poem-line">Hai mẹ con, nhà một phòng cũng trống</p>
                                        <p class="poem-line">Chỉ mong đợi những lá thư gió lộng</p>
                                        <p class="poem-line">Và mặn mòi hương biển xa xôi...</p>
                                        <p class="poem-line">Nghe êm đềm sóng lặng lững lờ trôi,</p>
                                        <p class="poem-line">Thấy đàn cá heo giỡn đùa mặt nước.</p>
                                    </div>

                                    <!-- Khổ 2 -->
                                    <div class="mb-6">
                                        <p class="poem-line">Thư không kể về cơn bão chờ phía trước,</p>
                                        <p class="poem-line">Dải đá ngầm, thăm thẳm nước đen.</p>
                                        <p class="poem-line">Nhịp bước khẩn trương khi khẩu lệnh vang lên,</p>
                                        <p class="poem-line">Mắt dõi theo vật ra-đa rà quét,</p>
                                        <p class="poem-line">Áo đọng muối khô, da nhận mùi nắng khét,...</p>
                                        <p class="poem-line">Thư chỉ nói về nỗi nhớ với thương yêu...</p>
                                    </div>

                                    <!-- Khổ 3 -->
                                    <div class="mb-6">
                                        <p class="poem-line">Con đã lớn khôn, đọc được cả những điều</p>
                                        <p class="poem-line">Chưa được viết trong thư người lính biển</p>
                                        <p class="poem-line">Nơi đầu sóng, sẵn sàng nghênh chiến</p>
                                        <p class="poem-line">Vẫn dịu dàng, êm ái lá thư xanh...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <div class="mb-4 overflow-hidden rounded-2xl shadow-sm relative group max-w-2xl mx-auto">
                            <img src="C:/Users/Admin/.gemini/antigravity/brain/cbb865b6-a5f3-4a35-b283-692f4fd0abc3/thu_cua_bo_illustration_1768924463410.png"
                                alt="Thư của bố" class="w-full h-auto block">
                        </div>
                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span class="w-10 h-10 bg-yellow-400 rounded-xl flex items-center justify-center mr-3">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">1.
                                        Ở khổ thơ thứ nhất, bạn nhỏ đã chia sẻ điều gì?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Bạn nhỏ chia sẻ hoàn cảnh của gia đình mình: Bố công tác ngoài đảo xa nên hai mẹ
                                        con
                                        luôn cảm thấy <span class="font-bold text-blue-600">trống vắng</span>, luôn
                                        hướng về
                                        cuộc sống ngoài đảo của bố. Bạn nhỏ luôn <span
                                            class="font-bold text-blue-600">mong
                                            chờ những lá thư</span> kể chuyện biển cả thú vị do bố gửi về.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">2.
                                        Những chi tiết nào cho thấy bố bạn nhỏ phải vượt qua nhiều khó khăn, vất vả để
                                        bảo
                                        vệ biển đảo của Tổ quốc?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        <ul class="list-disc ml-4 space-y-1">
                                            <li><span class="font-bold text-blue-600">Cơn bão</span> chờ phía trước</li>
                                            <li><span class="font-bold text-blue-600">Dải đá ngầm</span>, thăm thẳm nước
                                                đen
                                            </li>
                                            <li><span class="font-bold text-blue-600">Áo đọng muối khô</span></li>
                                            <li><span class="font-bold text-blue-600">Da nhận mùi nắng khét</span></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">3.
                                        Theo em, vì sao trong thư bố bạn nhỏ không kể về những khó khăn, vất vả của
                                        mình?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Bố bạn nhỏ không kể vì <span class="font-bold text-blue-600">không muốn người
                                            thân
                                            phải lo lắng</span>.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">4.
                                        Bạn nhỏ đã thể hiện tình cảm của mình với bố qua những hành động, việc làm
                                        nào?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        <ul class="list-disc ml-4 space-y-1">
                                            <li><span class="font-bold text-blue-600">A.</span> Làm quen với cuộc sống
                                                vắng
                                                bố</li>
                                            <li><span class="font-bold text-blue-600">B.</span> Mong đợi những lá thư
                                                của bố
                                            </li>
                                            <li><span class="font-bold text-blue-600">C.</span> Hiểu được cả những điều
                                                bố
                                                chưa viết trong thư</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">5.
                                        Hai dòng thơ "Nơi đầu sóng, sẵn sàng nghênh chiến/ Vẫn dịu dàng, êm ái lá thư
                                        xanh…"
                                        cho em hiểu điều gì về người lính biển?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Hai dòng thơ cho thấy <span class="font-bold text-blue-600">tinh thần, ý chí
                                            quật
                                            cường, tư thế chủ động, luôn sẵn sàng chiến đấu</span> để bảo vệ chủ quyền
                                        biển
                                        đảo. Đồng thời, nó cũng hiện lên hình ảnh một <span
                                            class="font-bold text-blue-600">người chồng, người cha thân thương, gần gũi
                                            và
                                            chan chứa tình yêu thương gia đình</span>.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

        </div>
        </div>

        <!-- Quiz Tab Content -->
        <div id="tab-quiz" class="tab-content">
            <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10 max-w-4xl mx-auto">
                <div id="quiz-registration">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-black text-blue-900 mb-2">THÔNG TIN HỌC SINH</h2>
                        <p class="text-gray-500">Vui lòng nhập thông tin để bắt đầu luyện tập: <b>Thư của bố</b></p>
                    </div>
                    <form id="regForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Họ và tên:</label>
                            <input type="text" id="studentName" required
                                class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                placeholder="Nhập đầy đủ họ tên của em">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Lớp:</label>
                                <select id="studentClass" required
                                    class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                    <option value="">-- Chọn lớp --</option>
                                    <option value="5/1">Lớp 5/1</option>
                                    <option value="5/2">Lớp 5/2</option>
                                    <option value="5/3">Lớp 5/3</option>
                                    <option value="5/4">Lớp 5/4</option>
                                    <option value="5/5">Lớp 5/5</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Trường:</label>
                                <div class="relative">
                                    <select id="schoolSelect" onchange="checkSchool(this)"
                                        class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                        <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                        <option value="other">Trường khác...</option>
                                    </select>
                                    <input type="text" id="otherSchool"
                                        class="hidden mt-4 w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                        placeholder="Nhập tên trường của em">
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-lg uppercase tracking-wider">
                            Bắt đầu làm bài
                        </button>
                    </form>
                </div>

                <div id="quiz-container" class="hidden">
                    <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <span id="questionNum"
                                class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black text-xl">1</span>
                            <div>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Câu hỏi</p>
                                <p class="text-xs text-gray-400 font-bold" id="progressText">Đang thực hiện: 1/5</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Thời gian còn lại
                            </p>
                            <p id="timer" class="text-lg font-black text-blue-900">20:00</p>
                        </div>
                    </div>

                    <div id="questionArea" class="mb-8">
                        <h3 id="questionText" class="text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h3>
                        <div id="optionsArea" class="grid grid-cols-1 gap-4"></div>
                    </div>

                    <div class="flex justify-end pt-6 border-t border-gray-100">
                        <button id="nextBtn" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center">
                            Tiếp theo
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="quiz-results" class="hidden text-center py-12">
                    <div class="mb-8 relative inline-block">
                        <svg class="w-48 h-48 mx-auto" viewBox="0 0 36 36">
                            <path class="text-gray-100" stroke-width="3" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path id="scoreCircle" class="text-green-500" stroke-width="3" stroke-dasharray="0, 100"
                                stroke-linecap="round" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="scoreText" class="text-5xl font-black text-blue-900">0</span>
                            <span class="text-sm font-bold text-gray-400 uppercase">Điểm</span>
                        </div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10" id="resultMsg">Chúc mừng em đã hoàn thành bài luyện tập.</p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="restartQuiz()"
                            class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-4 px-10 rounded-2xl transition-all active:scale-95">Làm
                            lại</button>
                        <button onclick="submitResults(event)"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95">Nộp
                            bài</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Statistics Modal -->
        <div id="statsModal" class="modal">
            <div
                class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col m-4">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-blue-600 text-white">
                    <h2 class="text-2xl font-black">THỐNG KÊ KẾT QUẢ HỌC TẬP</h2>
                    <button onclick="closeModal()" class="hover:bg-blue-700 p-2 rounded-full transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-6 overflow-x-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-xs font-bold tracking-widest">
                                <th class="p-4 border-b">STT</th>
                                <th class="p-4 border-b">Họ và tên</th>
                                <th class="p-4 border-b">Lớp</th>
                                <th class="p-4 border-b">Trường</th>
                                <th class="p-4 border-b text-center">Điểm số</th>
                                <th class="p-4 border-b text-center">Thời gian làm</th>
                                <th class="p-4 border-b text-right">Thời gian nộp</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody" class="text-sm"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-zinc-900 text-zinc-400 py-2 px-4 mt-2">
        <div class="container mx-auto text-center text-xs">
            <p>@ 2026 EduRobot - Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        /* UI LOGIC */
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.replace('text-gray-400', 'text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.replace('text-green-500', 'text-gray-400');
            }
        }

        audio.onended = () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.replace('text-green-500', 'text-gray-400');
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'text-blue-600'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('btn-' + tabId).classList.add('active', 'text-blue-600');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        /* FIREBASE & TEACHER STATS */
        const firebaseConfig = {
            apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
            authDomain: "gamhoctap.firebaseapp.com",
            databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gamhoctap",
            storageBucket: "gamhoctap.firebasestorage.app",
            messagingSenderId: "833329613932",
            appId: "1:833329613932:web:0d8574827bcfe50b535c49",
            measurementId: "G-YT1PKCYS67"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function openTeacherStats() {
            const pin = prompt("Vui lòng nhập mã PIN giáo viên:");
            if (pin === 'dvn') {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else if (pin !== null) alert("Mã PIN không chính xác!");
        }

        function closeModal() { document.getElementById('statsModal').classList.remove('active'); }

        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td></tr>';
            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5")
                    .where("lessonTitle", "==", "Thư của bố")
                    .get();
                tbody.innerHTML = '';
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td></tr>';
                    return;
                }
                const results = [];
                snapshot.forEach(doc => results.push(doc.data()));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));

                results.forEach((data, index) => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50 text-sm";
                    tr.innerHTML = `
                        <td class="p-4 font-bold text-gray-400">${index + 1}</td>
                        <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
                        <td class="p-4 text-gray-600">${data.studentClass || data.className || '---'}</td>
                        <td class="p-4 text-gray-600">${data.school}</td>
                        <td class="p-4 text-center">
                            <span class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 60 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">${Math.round(data.score)}/100</span>
                        </td>
                        <td class="p-4 text-center text-gray-600 font-bold">${data.timeDisplay || '---'}</td>
                        <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (e) { tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu.</td></tr>'; }
        }

        function exportToExcel() {
            const tbody = document.getElementById('statsTableBody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            if (rows.length === 0 || rows[0].innerText.includes('Đang tải') || rows[0].innerText.includes('Chưa có')) {
                alert("Không có dữ liệu để xuất!");
                return;
            }

            const data = rows.map((row, index) => {
                const cells = row.querySelectorAll('td');
                return {
                    'STT': index + 1,
                    'Họ và Tên': cells[1].innerText,
                    'Lớp': cells[2].innerText,
                    'Trường': cells[3].innerText,
                    'Điểm số': cells[4].innerText,
                    'Thời gian': cells[5].innerText,
                    'Ngày nộp': cells[6].innerText
                };
            });

            const ws = XLSX.utils.json_to_sheet(data);
            ws['!cols'] = [
                { wch: 5 },  // STT
                { wch: 25 }, // Họ và Tên
                { wch: 10, t: 's' }, // Lớp (Force Text)
                { wch: 30 }, // Trường
                { wch: 15 }, // Điểm số
                { wch: 15 }, // Thời gian
                { wch: 25 }  // Ngày nộp
            ];

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Thống kê");
            XLSX.writeFile(wb, "ThongKe_ThuCuaBo.xlsx");
        }

        /* REGISTRATION LOGIC */
        function checkSchool() {
            const select = document.getElementById('schoolSelect');
            const other = document.getElementById('otherSchool');
            if (select.value === 'other') {
                other.classList.remove('hidden');
                other.required = true;
            } else {
                other.classList.add('hidden');
                other.required = false;
            }
        }

        let studentData = {}, selectedQuestions = [], currentIdx = 0, score = 0, startTime;

        document.getElementById('regForm').onsubmit = function (e) {
            e.preventDefault();
            const schoolVal = document.getElementById('schoolSelect').value;
            studentData = {
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                school: schoolVal === 'other' ? document.getElementById('otherSchool').value : schoolVal
            };
            const shuffled = shuffle([...allQuestions]);
            selectedQuestions = shuffled.slice(0, 5);
            currentIdx = 0;
            score = 0;
            startTime = new Date();
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            showQuestion();
        };

        /* QUIZ ENGINE */
        const allQuestions = [
            { q: "Bài thơ \"Thư của bố\" được sáng tác bởi tác giả nào?", a: ["Thuỵ Anh", "Trần Đăng Khoa", "Nguyên Khoa Điềm", "Phạm Tiến Duật"], c: 0 },
            { q: "Hoàn cảnh gia đình của bạn nhỏ trong khổ thơ đầu được miêu tả như thế nào?", a: ["Gia đình đông vui, nhộn nhịp", "Bố mẹ đều đi làm xa, bạn nhỏ ở với bà", "Nhà một phòng trống vắng vì bố đi công tác xa, chỉ có hai mẹ con,", "Cả gia đình đang sống cùng nhau ngoài hải đảo"], c: 2 },
            { q: "Hai mẹ con bạn nhỏ thường mong đợi điều gì từ nơi xa?", a: ["Những món quà từ biển", "Những lá thư gió lộng và mặn mòi hương biển", "Những cuộc điện thoại của bố", "Những con cá heo"], c: 1 },
            { q: "Trong thư gửi về nhà, bố thường kể cho con nghe những hình ảnh êm đềm nào?", a: ["Cơn bão lớn và sóng dữ", "Những chiếc tàu chiến hiện đại", "Sóng lặng lững lờ trôi, đàn cá heo giỡn đùa mặt nước", "Những khẩu lệnh vang lên"], c: 2 },
            { q: "Những khó khăn, nguy hiểm nào của biển cả mà bố KHÔNG kể trong thư?", a: ["Cơn bão chờ phía trước, dải đá ngầm, nước đen thăm thẳm,", "Nắng đẹp và gió mát", "Cá heo và chim hải âu", "Những hòn đảo xinh đẹp"], c: 0 },
            { q: "Hình ảnh \"Áo đọng muối khô, da nhận mùi nắng khét\" gợi tả điều gì về công việc của bố?", a: ["Bố thường xuyên đi tắm biển", "Bố làm việc trong nhà máy muối", "Sự vất vả, dãi dầu nắng gió và khắc nghiệt của người lính biển,", "Bố thích mặc áo màu muối tiêu"], c: 2 },
            { q: "Những chi tiết như \"nhịp bước khẩn trương\", \"khẩu lệnh vang lên\", \"mắt dõi theo ra-đa\" cho thấy nhiệm vụ của bố là gì?", a: ["Đánh bắt cá xa bờ", "Canh giữ, bảo vệ vùng biển và sẵn sàng chiến đấu,", "Nghiên cứu khoa học về đại dương", "Lái tàu du lịch"], c: 1 },
            { q: "Theo em, vì sao trong thư bố không hề nhắc đến những gian khổ, hiểm nguy nơi đầu sóng?", a: ["Vì bố quên không viết", "Vì bố thấy những điều đó bình thường", "Vì bố không muốn người thân ở nhà phải lo lắng", "Vì giấy viết thư không đủ chỗ"], c: 2 },
            { q: "Thay vì kể lể khó khăn, nội dung chính trong những lá thư của bố là gì?", a: ["Kể về các loại vũ khí", "Chỉ nói về nỗi nhớ với thương yêu dành cho gia đình", "Yêu cầu gửi thêm lương thực", "Nhắc nhở con học bài"], c: 1 },
            { q: "Câu thơ \"Con đã lớn khôn, đọc được cả những điều / Chưa được viết trong thư người lính biển\" thể hiện điều gì ở bạn nhỏ?", a: ["Bạn nhỏ đã biết đọc chữ thành thạo", "Bạn nhỏ có khả năng đọc suy nghĩ của người khác", "Sự thấu hiểu sâu sắc, cảm nhận được những hy sinh thầm lặng của bố dù bố không nói ra,", "Bạn nhỏ thích đọc thư của bố nhiều lần"], c: 2 },
            { q: "Cụm từ \"Lá thư xanh\" trong bài thơ có thể hiểu theo nghĩa nào?", a: ["Lá thư được viết trên giấy màu xanh", "Lá thư được gói trong lá cây", "Lá thư mang niềm tin, hy vọng và sức sống từ biển cả gửi về đất liền", "Lá thư của những người lính trẻ tuổi"], c: 2 },
            { q: "Hai câu thơ cuối: \"Nơi đầu sóng, sẵn sàng nghênh chiến / Vẫn dịu dàng, êm ái lá thư xanh\" khắc họa vẻ đẹp nào của người lính?", a: ["Vẻ đẹp lãng mạn, bay bổng", "Sự nghiêm khắc và lạnh lùng", "Sự mệt mỏi vì chiến tranh", "Tinh thần thép, ý chí quật cường nhưng tâm hồn vẫn tràn đầy tình yêu thương dịu dàng,"], c: 3 },
            { q: "Bài thơ ca ngợi những phẩm chất gì của người lính biển?", a: ["Sự thông minh và tài giỏi", "Tinh thần vượt khó, ý chí kiên cường bảo vệ Tổ quốc và tình yêu gia đình tha thiết", "Sự vui vẻ và hài hước", "Sức khỏe phi thường"], c: 1 },
            { q: "Qua bài thơ, tình cảm của bạn nhỏ và mẹ dành cho bố được thể hiện như thế nào?", a: ["Luôn lo lắng và muốn bố về ngay", "Luôn quan tâm, thấu hiểu, sẻ chia và là hậu phương vững chắc cho bố", "Buồn bã vì bố đi vắng thường xuyên", "Trách móc vì bố ít gửi thư"], c: 1 },
            { q: "Biện pháp nghệ thuật nào nổi bật nhất được sử dụng để làm nổi bật sự vất vả của bố so với giọng điệu êm ái trong thư?", a: ["Nhân hóa", "Tương phản (đối lập giữa thực tế gian khổ và lời thư dịu dàng),", "So sánh", "Điệp ngữ"], c: 1 }
        ];

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function showQuestion() {
            const q = selectedQuestions[currentIdx];
            document.getElementById('questionNum').innerText = currentIdx + 1;
            document.getElementById('progressText').innerText = `Đang thực hiện: ${currentIdx + 1}/5`;
            document.getElementById('questionText').innerText = q.q;

            const area = document.getElementById('optionsArea');
            area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full p-4 text-left border-2 border-gray-100 rounded-2xl font-bold transition-all hover:border-blue-200 hover:bg-blue-50/50 flex items-center group";
                btn.innerHTML = `
                    <span class="w-8 h-8 rounded-full border-2 border-gray-200 flex items-center justify-center mr-4 group-hover:border-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-all text-sm">${String.fromCharCode(65 + i)}</span>
                    <span class="flex-1">${opt}</span>
                `;
                btn.onclick = () => selectOption(i, btn);
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('nextBtn').onclick = nextQuestion;
        }

        function selectOption(idx, btn) {
            document.querySelectorAll('#optionsArea button').forEach(b => {
                b.classList.remove('border-blue-600', 'bg-blue-50');
                b.querySelector('span').classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
            });
            btn.classList.add('border-blue-600', 'bg-blue-50');
            btn.querySelector('span').classList.add('bg-blue-600', 'text-white', 'border-blue-600');
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('nextBtn').dataset.selected = idx;
        }

        function nextQuestion() {
            const selected = parseInt(document.getElementById('nextBtn').dataset.selected);
            if (selected === selectedQuestions[currentIdx].c) score += 20;

            currentIdx++;
            if (currentIdx < 5) showQuestion();
            else showResults();
        }

        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = Math.round(score);
            const dash = (score / 100) * 100; // SVG uses 100 as base here
            document.getElementById('scoreCircle').setAttribute('stroke-dasharray', `${dash}, 100`);

            if (score >= 80) {
                document.getElementById('resultTitle').innerText = "Rất tuyệt vời!";
                document.getElementById('resultMsg').innerText = "Em đã hoàn thành bài tập xuất sắc. Tiếp tục phát huy nhé!";
            } else if (score >= 60) {
                document.getElementById('resultTitle').innerText = "Làm tốt lắm!";
                document.getElementById('resultMsg').innerText = "Em đã hiểu bài khá tốt rồi đấy!";
            } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên nhé!";
                document.getElementById('resultMsg').innerText = "Hãy xem lại bài đọc và làm lại bài tập để đạt điểm cao hơn.";
            }
        }

        function restartQuiz() {
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-registration').classList.remove('hidden');
        }

        async function submitResults(e) {
            const btn = e.target;
            btn.disabled = true;
            btn.innerText = "Đang gửi...";
            const duration = Math.floor((new Date() - startTime) / 1000);
            const minutes = Math.floor(duration / 60);
            const seconds = duration % 60;
            const timeStr = `${minutes}p ${seconds}s`;

            try {
                await db.collection("diem_tieng_viet_lop5").add({
                    ...studentData,
                    lessonTitle: "Thư của bố",
                    score: Math.round(score),
                    duration: duration,
                    timeDisplay: timeStr,
                    endTime: new Date().toISOString(),
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert(`Chúc mừng ${studentData.studentName} đã nộp bài thành công!`);
                restartQuiz();
                switchTab('lesson');
            } catch (err) {
                console.error(err);
                alert("Có lỗi khi gửi kết quả. Em vui lòng thử lại nhé!");
            } finally {
                btn.disabled = false;
                btn.innerText = "NỘP KẾT QUẢ";
            }
        }
    </script>
</body>

</html>