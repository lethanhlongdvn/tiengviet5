<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hương cốm mùa thu - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Nunito & Merriweather -->
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            line-height: 1.8;
        }

        .bg-paper {
            background-color: #fdfbf7;
            background-image: url("https://www.transparenttextures.com/patterns/natural-paper.png");
        }

        .tab-btn.active {
            color: #2563eb;
            border-bottom: 3px solid #2563eb;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease-out;
            opacity: 0;
        }

        .accordion-open .accordion-content {
            max-height: 500px;
            opacity: 1;
            padding-bottom: 20px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .quiz-option.selected {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #1d4ed8;
        }

        /* Modal Teacher Stats */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50 shadow-sm border-b border-blue-100">
        <nav class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <a href="index.html" class="flex items-center space-x-2">
                    <div
                        class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white text-lg font-bold">
                        E</div>
                    <span class="text-lg font-extrabold text-blue-600 tracking-tight">EduRobot - <span
                            class="text-blue-500">Tiếng Việt 5</span></span>
                </a>
            </div>

            <ul class="hidden md:flex space-x-6 font-semibold text-gray-600 text-sm">
                <li><a href="index.html" class="hover:text-blue-500 transition-colors">Trang chủ</a></li>
                <li><a href="ve-dep-cuoc-song.html" class="text-blue-600 border-b-2 border-blue-500">Bài học</a>
                </li>
                <li><button onclick="openTeacherStats()" class="hover:text-blue-500 transition-colors">Dành cho Giáo
                        viên</button></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-4">
        <!-- Navigation -->
        <div class="flex items-center justify-between mb-2">
            <a href="ve-dep-cuoc-song.html"
                class="flex items-center text-gray-500 hover:text-blue-600 transition-colors text-sm font-bold">
                <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Trở về
            </a>
        </div>

        <!-- Tab & Audio Header -->
        <div
            class="flex flex-col md:flex-row md:items-center justify-between border-b border-gray-200 mb-4 bg-white rounded-t-2xl overflow-hidden shadow-sm">
            <div class="flex-1 flex">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-3 text-center font-bold text-gray-500 transition-all hover:bg-blue-50 border-r border-gray-100">
                    1. Bài học
                </button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-3 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                    2. Luyện tập
                </button>
            </div>

            <div id="audio-container" class="p-2 md:pr-4">
                <div
                    class="flex items-center space-x-3 bg-blue-50/50 rounded-full p-1 pr-6 border border-blue-100 shadow-sm transition-all hover:bg-blue-50">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-11 h-11 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-md active:scale-95">
                        <svg id="playIcon" class="w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg>
                    </button>
                    <div class="flex flex-col">
                        <p class="text-[11px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1">
                            NGHE ĐỌC MẪU</p>
                        <p id="audioStatus" class="text-[12px] text-gray-400 font-bold italic leading-none">Đang dừng...
                        </p>
                    </div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/huongcommuathu.mp3" type="audio/mpeg">
                </audio>
            </div>
        </div>

        <!-- TAB 1: BÀI HỌC -->
        <div id="tab-lesson" class="tab-content active">

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%] text-left">
                    <div class="bg-white rounded-[30px] shadow-sm border border-blue-100 p-6 md:p-8">
                        <div class="p-6 md:p-10 bg-paper rounded-2xl shadow-inner border border-gray-100">
                            <h1 class="text-3xl font-black mb-10 text-blue-900 text-center uppercase tracking-tight">
                                HƯƠNG CỐM MÙA THU</h1>
                            <div class="serif-font text-gray-800 md:columns-2 gap-12">
                                <p class="mb-8 italic">
                                    Tháng Chín heo may về phố<br>
                                    Dắt theo hương cốm vào thu<br>
                                    Sớm nay xôn xao ô cửa<br>
                                    Gió thơm vừa ghé – ô kìa!
                                </p>
                                <p class="mb-8 italic">
                                    Gió kể: Ngày xưa hạt thóc<br>
                                    Trời đem gieo tặng nhà nông<br>
                                    Sớm khuya mồ hôi đổ xuống<br>
                                    Đợi mùa cây lúa trĩu bông!
                                </p>
                                <p class="mb-8 italic">
                                    Hạt lúa tròn căng hơi sữa<br>
                                    Thảo thơm dâng tặng cho đời<br>
                                    Tay me, tay ba sàng sẩy<br>
                                    Cốm mang hồn đất, hồn người.
                                </p>
                                <p class="mb-8 italic">
                                    Em thấy màu vàng của nắng<br>
                                    Em thấy màu xanh của trời<br>
                                    Em thấy màu nâu của đất<br>
                                    Ủ trong hạt cốm xanh ngời!
                                </p>
                                <p class="mb-8 italic">
                                    Tháng Chín bước chân ra phố<br>
                                    Tay lùa từng ngón gió thơm<br>
                                    Hồ Gươm chớp đôi mắt biếc<br>
                                    Nhắc mùa hương cốm vừa lên!
                                </p>
                                <p class="text-right italic font-bold text-gray-600 mt-6 break-inside-avoid">(Bảo Ngọc)
                                </p>
                            </div>
                        </div>

                        <!-- Nội dung chính -->
                        <div class="mt-8 bg-blue-50 rounded-3xl p-6 border border-blue-100 relative overflow-hidden">
                            <div class="absolute -right-10 -top-10 w-40 h-40 bg-blue-100 rounded-full opacity-50">
                            </div>
                            <div class="flex flex-col md:flex-row items-center gap-6 relative z-10">
                                <div class="bg-blue-600 p-6 rounded-2xl text-white shadow-lg shrink-0 text-center">
                                    <p class="text-[10px] font-bold uppercase tracking-widest opacity-80 mb-1">Thông
                                        điệp</p>
                                    <h3 class="text-xl font-black uppercase">Nội dung chính</h3>
                                </div>
                                <div>
                                    <p class="text-gray-700 font-bold leading-relaxed">
                                        Cốm là một đặc sản tiêu biểu của Hà Nội, là một thức quà ngon. Cốm được làm từ
                                        những tinh tuý của đất trời và bàn tay khéo léo, cần cù của người làm cốm. Qua
                                        đó, bài thơ nhắc nhở chúng ta biết trân trọng công sức lao động của người nông
                                        dân.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <div class="mb-4 overflow-hidden rounded-2xl shadow-sm relative group max-w-full mx-auto">
                            <img src="hinh_anh/huong-com-mua-thu.png" alt="Hương cốm mùa thu"
                                class="w-full h-auto block">
                        </div>
                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span class="w-10 h-10 bg-yellow-400 rounded-xl flex items-center justify-center mr-3">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-4 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">1.
                                        Khung cảnh thiên nhiên và cảm xúc khi mùa cốm đến?</span>
                                    <svg class="w-4 h-4 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content px-4">
                                    <div class="text-sm text-gray-600 border-t border-gray-50 pt-2">
                                        <span class="text-green-600 font-bold">Trả lời:</span>
                                        <ul class="list-disc ml-4 space-y-1">
                                            <li><b>Thiên nhiên:</b> Tháng Chín, mùa thu, gió heo may thổi về phố.</li>
                                            <li><b>Cảm xúc:</b> Xôn xao, ngỡ ngàng, vui mừng (Sớm nay xôn xao ô cửa, ô
                                                kìa!).</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-4 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">2.
                                        Hành trình làm ra hạt cốm?</span>
                                    <svg class="w-4 h-4 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content px-4">
                                    <div class="text-sm text-gray-600 border-t border-gray-50 pt-2">
                                        <span class="text-green-600 font-bold">Trả lời:</span> Trời gieo hạt thóc ->
                                        Người nông dân vất vả chăm sóc -> Lúa trĩu bông -> Thu hoạch khi hạt tròn căng
                                        hơi sữa -> Qua bàn tay mẹ, ba sàng sẩy mới thành cốm.
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-4 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">3.
                                        Cách tả màu sắc cho thấy cảm nhận gì?</span>
                                    <svg class="w-4 h-4 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content px-4">
                                    <div class="text-sm text-gray-600 border-t border-gray-50 pt-2">
                                        <span class="text-green-600 font-bold">Trả lời:</span> Bạn nhỏ nhận thấy cốm là
                                        sự góp sức của thiên nhiên (nắng vàng, trời xanh, đất nâu). Tất cả ủ trong hạt
                                        cốm xanh ngời kì diệu.
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-4 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">4.
                                        Chi tiết nào cho thấy cốm là quà của Hà Nội?</span>
                                    <svg class="w-4 h-4 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content px-4">
                                    <div class="text-sm text-gray-600 border-t border-gray-50 pt-2">
                                        <span class="text-green-600 font-bold">Trả lời:</span> Chi tiết nhắc đến "Hồ
                                        Gươm" - địa danh nổi tiếng của Thủ đô Hà Nội.
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-100">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-4 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">5.
                                        Tình cảm của tác giả đối với hương cốm?</span>
                                    <svg class="w-4 h-4 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content px-4">
                                    <div class="text-sm text-gray-600 border-t border-gray-50 pt-2">
                                        <span class="text-green-600 font-bold">Trả lời:</span> Tác giả yêu tha thiết
                                        hương cốm và mùa thu Hà Nội; trân trọng, biết ơn thiên nhiên và người lao động;
                                        tự hào về thức quà quê hương.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- TAB 2: LUYỆN TẬP -->
        <div id="tab-quiz" class="tab-content">
            <div
                class="max-w-4xl mx-auto bg-white rounded-[32px] shadow-xl border border-blue-100 overflow-hidden flex flex-col">
                <!-- Registration -->
                <div id="quiz-registration"
                    class="p-6 md:p-8 flex-grow flex flex-col items-center justify-center text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center text-blue-600 mb-4">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                            </path>
                        </svg>
                    </div>
                    <h2 class="text-xl font-black text-gray-800 mb-1">Kiểm tra kiến thức</h2>

                    <form id="regForm" class="w-full max-w-sm space-y-4">
                        <div class="flex flex-col text-left">
                            <label for="studentName"
                                class="text-[10px] font-black text-blue-600 uppercase mb-1 ml-4">Tên
                                của em:</label>
                            <input type="text" id="studentName" placeholder="Nhập họ và tên..." required
                                class="w-full px-5 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all outline-none font-bold text-sm">
                        </div>

                        <div class="grid grid-cols-2 gap-3 text-left">
                            <div class="flex flex-col">
                                <label for="studentClass"
                                    class="text-[10px] font-black text-blue-600 uppercase mb-1 ml-4">Lớp:</label>
                                <select id="studentClass" required
                                    class="w-full px-5 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all outline-none font-bold appearance-none text-sm">
                                    <option value="">Chọn lớp</option>
                                    <option value="5/1">Lớp 5/1</option>
                                    <option value="5/2">Lớp 5/2</option>
                                    <option value="5/3">Lớp 5/3</option>
                                    <option value="5/4">Lớp 5/4</option>
                                    <option value="5/5">Lớp 5/5</option>
                                </select>
                            </div>
                            <div class="flex flex-col">
                                <label for="schoolSelect"
                                    class="text-[10px] font-black text-blue-600 uppercase mb-1 ml-4">Trường:</label>
                                <select id="schoolSelect" onchange="checkSchool(this)" required
                                    class="w-full px-5 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all outline-none font-bold appearance-none text-sm">
                                    <option value="">Chọn trường</option>
                                    <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                    <option value="other">Trường khác...</option>
                                </select>
                            </div>
                        </div>
                        <input type="text" id="otherSchool" placeholder="Nhập tên trường của em"
                            class="hidden w-full px-5 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-100 focus:border-blue-500 transition-all outline-none font-bold text-sm">

                        <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-3 rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95 text-base">
                            BẮT ĐẦU NGAY
                        </button>
                    </form>
                </div>

                <!-- Quiz Engine -->
                <div id="quiz-container" class="hidden flex-grow flex flex-col">
                    <div class="bg-blue-50 px-6 py-3 flex justify-between items-center border-b border-blue-100">
                        <div class="flex items-center">
                            <span
                                class="w-8 h-8 bg-blue-600 text-white rounded-lg flex items-center justify-center font-black mr-3 shadow-md text-sm"
                                id="questionNum">1</span>
                            <p class="font-black text-blue-900 uppercase tracking-wider text-[10px]" id="progressText">
                                Đang thực hiện: 1/5</p>
                        </div>
                        <div
                            class="text-blue-600 font-bold text-xs bg-white px-3 py-1 rounded-full shadow-sm border border-blue-100">
                            Hương cốm mùa thu
                        </div>
                    </div>

                    <div class="p-5 md:p-6 flex-grow">
                        <h3 class="text-lg font-black text-gray-800 mb-4 leading-tight" id="questionText">Câu hỏi?</h3>
                        <div class="grid grid-cols-1 gap-2" id="optionsArea">
                            <!-- Options -->
                        </div>
                    </div>

                    <div class="p-3 border-t border-gray-50 flex justify-end">
                        <button id="nextBtn" disabled
                            class="bg-blue-600 disabled:opacity-30 hover:bg-blue-700 text-white font-black py-2.5 px-8 rounded-xl shadow-lg transition-all active:scale-95 text-sm">
                            CÂU TIẾP THEO
                        </button>
                    </div>
                </div>

                <!-- Results -->
                <div id="quiz-results"
                    class="hidden p-6 md:p-8 flex-grow flex flex-col items-center justify-center text-center">
                    <div class="relative w-32 h-32 mb-4">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="96" cy="96" r="80" stroke="currentColor" stroke-width="12" fill="transparent"
                                class="text-gray-100" />
                            <circle id="scoreCircle" cx="96" cy="96" r="80" stroke="currentColor" stroke-width="12"
                                fill="transparent" class="text-blue-500" stroke-dasharray="0, 100"
                                stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-black text-gray-800" id="scoreText">0</span>
                            <span class="text-gray-400 font-bold uppercase tracking-widest text-xs italic">Điểm
                                số</span>
                        </div>
                    </div>

                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành bài tập!</h2>
                    <p class="text-gray-500 mb-10 max-w-md font-medium" id="resultMsg">Em đã nỗ lực hết mình rồi đấy!
                    </p>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-sm">
                        <button onclick="restartQuiz()"
                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 font-black py-3 rounded-2xl transition-all">LÀM
                            LẠI</button>
                        <button onclick="submitResults(event)"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-black py-3 rounded-2xl shadow-lg shadow-blue-200 transition-all">NỘP
                            KẾT QUẢ</button>
                    </div>
                </div>
            </div>

        </div>

    </main>

    <!-- Modal Teacher Stats -->
    <div id="statsModal" class="modal">
        <div class="bg-white rounded-[32px] w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl m-4">
            <div class="p-6 border-b flex justify-between items-center bg-blue-50">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                            </path>
                        </svg>
                    </div>
                    <h2 class="text-2xl font-black text-blue-900">Bảng kết quả học tập</h2>
                </div>
                <div class="flex items-center space-x-2">
                    <button onclick="exportToExcel()"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-xl text-sm flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg> Xuất Excel
                    </button>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 p-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex-grow overflow-auto p-6 bg-gray-50">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="text-left text-gray-500 uppercase text-xs font-black tracking-widest border-b pb-4">
                            <th class="p-4">STT</th>
                            <th class="p-4">Họ và Tên</th>
                            <th class="p-4">Lớp</th>
                            <th class="p-4">Trường</th>
                            <th class="p-4 text-center">Điểm số</th>
                            <th class="p-4 text-center">Thời gian</th>
                            <th class="p-4 text-right">Ngày nộp</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="bg-zinc-900 text-zinc-400 py-4 px-4 mt-8">
        <div class="container mx-auto text-center text-xs">
            <p>@ 2026 EduRobot - Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        /* UI LOGIC */
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.replace('text-gray-400', 'text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.replace('text-green-500', 'text-gray-400');
            }
        }

        audio.onended = () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.replace('text-green-500', 'text-gray-400');
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        /* FIREBASE & TEACHER STATS */
        const firebaseConfig = {
            apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
            authDomain: "gamhoctap.firebaseapp.com",
            databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gamhoctap",
            storageBucket: "gamhoctap.firebasestorage.app",
            messagingSenderId: "833329613932",
            appId: "1:833329613932:web:0d8574827bcfe50b535c49",
            measurementId: "G-YT1PKCYS67"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function openTeacherStats() {
            const pin = prompt("Vui lòng nhập mã PIN giáo viên:");
            if (pin === 'dvn') {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else if (pin !== null) alert("Mã PIN không chính xác!");
        }

        function closeModal() { document.getElementById('statsModal').classList.remove('active'); }

        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td></tr>';
            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Hương cốm mùa thu").get();
                tbody.innerHTML = '';
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td></tr>';
                    return;
                }
                const results = [];
                snapshot.forEach(doc => results.push(doc.data()));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));

                results.forEach((data, index) => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';
                    let duration = '---';
                    if (data.startTime && data.endTime) {
                        const diffMs = new Date(data.endTime) - new Date(data.startTime);
                        duration = `${Math.floor(diffMs / 60000)} phút ${Math.floor((diffMs % 60000) / 1000)} giây`;
                    }
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50 text-sm bg-white";
                    tr.innerHTML = `
                        <td class="p-4 font-bold text-gray-400">${index + 1}</td>
                        <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
                        <td class="p-4 text-gray-600">${data.className}</td>
                        <td class="p-4 text-gray-600">${data.school}</td>
                        <td class="p-4 text-center">
                            <span class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 50 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">${data.score}/100</span>
                        </td>
                        <td class="p-4 text-center text-gray-600 font-bold">${duration}</td>
                        <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (e) { tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu.</td></tr>'; }
        }

        function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Kết quả", raw: true, cellStyles: true });
            const ws = wb.Sheets["Kết quả"];
            if (ws['!cols']) {
                ws['!cols'][2] = { t: 's' }; // Ensure 'Class' column is text
            } else {
                ws['!cols'] = [{ wch: 10 }, { wch: 25 }, { t: 's', wch: 10 }, { wch: 25 }, { wch: 10 }, { wch: 20 }, { wch: 20 }];
            }
            XLSX.writeFile(wb, "KetQua_HuongComMuaThu.xlsx");
        }

        /* QUIZ ENGINE */
        const allQuestions = [
            { q: "Bài thơ \"Hương cốm mùa thu\" được sáng tác bởi tác giả nào?", a: ["Trần Đăng Khoa", "Bảo Ngọc", "Nguyễn Khoa Điềm", "Huy Cận"], c: 1 },
            { q: "Mùa cốm về được báo hiệu bằng loại gió nào trong tháng Chín?", a: ["Gió bấc", "Gió nồm", "Gió heo may", "Gió lào"], c: 2 },
            { q: "Cảm xúc của nhân vật trong khổ thơ đầu khi gió thơm ghé thăm là gì?", a: ["Buồn bã, tiếc nuối", "Xôn xao, ngỡ ngàng, vui mừng", "Lo lắng, sợ hãi", "Thờ ơ, không quan tâm"], c: 1 },
            { q: "Theo lời gió kể, hạt thóc ngày xưa có nguồn gốc từ đâu?", a: ["Do người nước ngoài mang đến", "Mọc hoang trong rừng", "Trời đem gieo tặng nhà nông", "Do chim tha về"], c: 2 },
            { q: "Để có được \"cây lúa trĩu bông\", người nông dân đã phải bỏ ra điều gì?", a: ["Vàng bạc", "Mồ hôi sớm khuya đổ xuống", "Những lời ca tiếng hát", "Nước mắt"], c: 1 },
            { q: "Hạt lúa được thu hoạch để làm cốm vào thời điểm nào?", a: ["Khi hạt lúa đã chín vàng ươm", "Khi hạt lúa còn non nớt", "Khi hạt lúa tròn căng hơi sữa", "Khi hạt lúa đã khô cong"], c: 2 },
            { q: "Những ai được nhắc đến trong việc trực tiếp \"sàng sẩy\" làm ra hạt cốm?", a: ["Những cô tiên", "Tay me, tay ba", "Những chú bé", "Gió và nắng"], c: 1 },
            { q: "Câu thơ \"Cốm mang hồn đất, hồn người\" có ý nghĩa gì?", a: ["Cốm được làm từ đất nung", "Cốm có hình dáng giống con người", "Cốm là sự kết tinh của đất đai màu mỡ và công sức lao động của con người", "Cốm được dùng để cúng đất đai"], c: 2 },
            { q: "Màu sắc nào tượng trưng cho \"nắng\" được ủ trong hạt cốm?", a: ["Màu xanh", "Màu vàng", "Màu nâu", "Màu đỏ"], c: 1 },
            { q: "Màu sắc nào tượng trưng cho \"đất\" được nhắc đến trong bài?", a: ["Màu đen", "Màu xám", "Màu nâu", "Màu tím"], c: 2 },
            { q: "Dù ủ nhiều màu sắc của trời đất, nhưng màu sắc thực tế của \"hạt cốm\" là màu gì?", a: ["Vàng óng", "Nâu đất", "Xanh ngời", "Trắng tinh"], c: 2 },
            { q: "Địa danh nào xuất hiện ở khổ thơ cuối cho biết cốm là đặc sản của Hà Nội?", a: ["Chùa Một Cột", "Sông Hồng", "Hồ Gươm", "Hồ Tây"], c: 2 },
            { q: "Hình ảnh \"Hồ Gươm chớp đôi mắt biếc\" sử dụng biện pháp nghệ thuật gì?", a: ["So sánh", "Nhân hóa", "Điệp ngữ", "Ẩn dụ"], c: 1 },
            { q: "Vì sao tác giả gọi hạt lúa là \"thảo thơm\"?", a: ["Vì hạt lúa có hương thơm và tấm lòng thơm thảo dâng tặng cho đời", "Vì hạt lúa được làm từ cỏ thảo mộc", "Vì tên của người làm ra hạt lúa là Thảo", "Vì hạt lúa dùng để nấu chè"], c: 0 },
            { q: "Nội dung chính của bài thơ là gì?", a: ["Miêu tả vẻ đẹp của Hồ Gươm vào mùa thu", "Kể về quy trình trồng lúa nước", "Ca ngợi hương vị của cốm - thức quà tinh túy của đất trời và bàn tay khéo léo của người Hà Nội", "Miêu tả những cơn gió heo may tháng Chín"], c: 2 }
        ];

        let studentData = {}, currentQuizQuestions = [], currentQuestionIdx = 0, score = 0, selectedOption = null;

        function checkSchool() {
            const select = document.getElementById('schoolSelect');
            const other = document.getElementById('otherSchool');
            if (select.value === 'other') {
                other.classList.remove('hidden');
                other.required = true;
            } else {
                other.classList.add('hidden');
                other.required = false;
            }
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        document.getElementById('regForm').onsubmit = (e) => {
            e.preventDefault();
            studentData = {
                studentName: document.getElementById('studentName').value,
                className: document.getElementById('studentClass').value,
                school: document.getElementById('schoolSelect').value === 'other' ? document.getElementById('otherSchool').value : document.getElementById('schoolSelect').value,
                startTime: new Date().toISOString()
            };
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            startQuiz();
        };

        function startQuiz() {
            currentQuizQuestions = [...allQuestions].sort(() => Math.random() - 0.5).slice(0, 5);
            currentQuestionIdx = 0; score = 0; showQuestion();
        }

        function showQuestion() {
            const q = currentQuizQuestions[currentQuestionIdx];
            document.getElementById('questionNum').innerText = currentQuestionIdx + 1;
            document.getElementById('progressText').innerText = `Đang thực hiện: ${currentQuestionIdx + 1}/5`;
            document.getElementById('questionText').innerText = q.q;
            const area = document.getElementById('optionsArea'); area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'w-full p-4 text-left border-2 border-gray-100 rounded-2xl font-bold transition-all hover:border-blue-200 hover:bg-blue-50/50 flex items-center group';
                btn.innerHTML = `<span class="w-8 h-8 rounded-full border-2 border-gray-200 flex items-center justify-center mr-4 group-hover:border-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-all text-sm">${String.fromCharCode(65 + i)}</span><span class="flex-1">${opt}</span>`;
                btn.onclick = () => {
                    document.querySelectorAll('#optionsArea button').forEach(b => {
                        b.classList.remove('border-blue-600', 'bg-blue-50');
                        b.querySelector('span').classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                    });
                    btn.classList.add('border-blue-600', 'bg-blue-50');
                    btn.querySelector('span').classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    document.getElementById('nextBtn').disabled = false;
                    selectedOption = i;
                };
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true; selectedOption = null;
        }

        document.getElementById('nextBtn').onclick = () => {
            if (selectedOption === currentQuizQuestions[currentQuestionIdx].c) score += 20;
            currentQuestionIdx++;
            if (currentQuestionIdx < 5) showQuestion(); else showResults();
        };


        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = score;
            const dash = (score / 100) * 502.6; // 2 * PI * 80
            document.getElementById('scoreCircle').style.strokeDasharray = `${dash}, 502.6`;

            if (score >= 80) {
                document.getElementById('resultTitle').innerText = "Rất tuyệt vời!";
                document.getElementById('resultMsg').innerText = "Em đã hoàn thành bài tập xuất sắc. Tiếp tục phát huy nhé!";
            } else if (score >= 60) {
                document.getElementById('resultTitle').innerText = "Làm tốt lắm!";
                document.getElementById('resultMsg').innerText = "Em đã hiểu bài khá tốt rồi đấy!";
            } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên nhé!";
                document.getElementById('resultMsg').innerText = "Hãy xem lại bài đọc và làm lại bài tập để đạt điểm cao hơn.";
            }
        }

        function restartQuiz() {
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-registration').classList.remove('hidden');
        }

        async function submitResults(e) {
            const btn = e.target; btn.disabled = true; btn.innerText = "Đang gửi...";
            try {
                await db.collection("diem_tieng_viet_lop5").add({
                    ...studentData, lessonTitle: "Hương cốm mùa thu", score: score, endTime: new Date().toISOString(), submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert(`Chúc mừng ${studentData.studentName} đã hoàn thành bài tập!`);
                restartQuiz(); switchTab('lesson');
            } catch (e) { alert("Lỗi khi gửi kết quả."); } finally { btn.disabled = false; btn.innerText = "NỘP KẾT QUẢ"; }
        }
    </script>
    <a href="huong-sac-tram-mien.html?week=24"
        class="fixed bottom-8 right-8 z-[100] group flex items-center space-x-3 bg-white/80 backdrop-blur-xl p-2 pr-6 rounded-2xl shadow-2xl border border-white/50 hover:scale-105 transition-all active:scale-95">
        <div
            class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200 group-hover:rotate-12 transition-transform">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        </div>
        <span class="text-sm font-black text-slate-700 uppercase tracking-wider">Trở về</span>
    </a>
</body>

</html>