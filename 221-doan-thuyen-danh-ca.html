<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đoàn thuyền đánh cá - EduRobot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --accent: #f59e0b;
            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        .hidden {
            display: none !important;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .tab-btn.active {
            color: var(--primary);
            background: white;
            box-shadow: inset 0 -3px 0 var(--primary);
        }

        .tab-content {
            display: none !important;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content.active {
            display: block !important;
        }

        #tab-quiz.active {
            display: flex !important;
        }

        #quiz-container {
            height: calc(100vh - 180px);
            max-height: 600px;
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1.5px solid #e2e8f0;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateX(4px);
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .accordion-open .accordion-content {
            max-height: 500px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .modal,
        .success-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: 1rem;
        }

        .modal.active,
        .success-modal.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        .reading-content p {
            margin-bottom: 2rem;
            text-align: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">
    <header class="sticky top-0 z-50 px-4 py-2">
        <nav class="container mx-auto glass-card rounded-xl px-5 py-2 flex justify-between items-center shadow-lg">
            <div class="flex items-center space-x-3">
                <div
                    class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center text-white shadow-xl transform hover:rotate-6 transition-transform">
                    <span class="text-lg font-black">E</span>
                </div>
                <div class="flex flex-col md:flex-row md:items-center md:space-x-4">
                    <div class="flex items-center space-x-2">
                        <span
                            class="text-base font-black bg-gradient-to-r from-blue-600 to-indigo-800 bg-clip-text text-transparent hidden md:block">EduRobot</span>
                        <span
                            class="text-[11px] font-black px-2.5 py-0.5 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 text-white animate-pulse uppercase">Tiếng
                            Việt 5</span>
                    </div>
                    <div class="h-4 w-px bg-gray-200 hidden md:block"></div>
                    <div class="flex items-center space-x-2 overflow-hidden">
                        <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Chủ điểm:</span>
                        <span class="text-sm font-black uppercase tracking-wider text-blue-800">Vẻ đẹp cuộc sống</span>
                    </div>
                </div>
            </div>
            <ul class="flex space-x-6 text-xs font-bold items-center">
                <li><a href="cd5-ve-dep-cuoc-song.html?week=22"
                        class="flex items-center text-blue-600 hover:text-blue-700"><svg class="w-4 h-4 mr-1"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>Quay lại</a></li>
                <li class="border-l border-gray-200 pl-6"><a href="index.html"
                        class="text-gray-500 hover:text-blue-600">Trang chủ</a></li>
                <li><button onclick="openTeacherStats()"
                        class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-lg hover:bg-blue-100">Giáo viên</button>
                </li>
            </ul>
        </nav>
    </header>
    <main class="container mx-auto px-4 py-2">
        <div class="glass-card mb-4 rounded-2xl overflow-hidden flex flex-col md:flex-row shadow-lg">
            <div class="flex-1 flex bg-white/40">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-4 text-center font-black text-gray-400 uppercase tracking-wider">1.
                    Bài học</button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-4 text-center font-black text-gray-400 uppercase tracking-wider">2. Luyện
                    tập</button>
            </div>
            <div id="audio-container"
                class="p-2 md:px-4 flex items-center bg-blue-50/20 md:border-l border-gray-100/50">
                <div
                    class="flex items-center space-x-3 bg-white/60 backdrop-blur-md rounded-xl p-1.5 pr-4 border border-white shadow-inner">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-9 h-9 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg flex items-center justify-center text-white shadow-md"><svg
                            id="playIcon" class="w-5 h-5 ml-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg><svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg></button>
                    <div class="flex flex-col"><span
                            class="text-[9px] font-black text-blue-600 uppercase tracking-widest leading-none mb-0.5">ĐỌC
                            MẪU</span><span id="audioStatus"
                            class="text-[10px] text-gray-400 font-bold italic leading-none">Đang dừng...</span></div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/doanthuyendanhca.mp3" type="audio/mpeg">
                </audio>
            </div>
        </div>
        <div id="tab-lesson" class="tab-content active">
            <div class="flex flex-col lg:flex-row gap-6">
                <section class="w-full lg:w-[70%]">
                    <div class="glass-card rounded-[40px] p-6 md:p-10 shadow-2xl">
                        <div
                            class="bg-paper rounded-[32px] p-8 md:p-12 shadow-inner border border-white/50 relative overflow-hidden">
                            <h1
                                class="text-4xl font-black mb-12 text-blue-950 text-center uppercase tracking-tighter leading-tight relative">
                                <span
                                    class="bg-blue-600 w-12 h-1.5 absolute -bottom-4 left-1/2 -translate-x-1/2 rounded-full"></span>
                                Đoàn thuyền đánh cá
                            </h1>
                            <div class="serif-font text-gray-800 text-lg leading-relaxed relative reading-content"
                                id="reading-content-placeholder">
                                <div class="space-y-12 italic">
                                    <div class="text-center">
                                        Mặt trời xuống biển như hòn lửa<br>
                                        Sóng đã cài then, đêm sập cửa<br>
                                        Đoàn thuyền đánh cá lại ra khơi<br>
                                        Câu hát căng buồm cùng gió khơi.
                                    </div>
                                    <div class="text-center">
                                        Hát rằng: cá bạc Biển Đông lặng,<br>
                                        Cá thu Biển Đông như đoàn thoi<br>
                                        Đêm ngày dệt biển muôn luồng sáng<br>
                                        Đến dệt lưới ta, đoàn cá ơi!
                                    </div>
                                    <div class="text-center">
                                        Ta hát bài ca gọi cá vào<br>
                                        Gõ thuyền đã có nhịp trăng cao<br>
                                        Biển cho ta cá như lòng mẹ<br>
                                        Nuôi lớn đời ta tự buổi nào.
                                    </div>
                                    <div class="text-center">
                                        Sao mờ, kéo lưới kịp trời sáng<br>
                                        Ta kéo xoăn tay chùm cá nặng<br>
                                        Vảy bạc đuôi vàng loé rạng đông,<br>
                                        Lưới xếp buồm lên đón nắng hồng.
                                    </div>
                                    <div class="text-center">
                                        Câu hát căng buồm với gió khơi,<br>
                                        Đoàn thuyền chạy đua cùng mặt trời<br>
                                        Mặt trời đội biển nhô màu mới,<br>
                                        Mắt cá huy hoàng muôn dặm phơi.
                                    </div>
                                </div>
                                <p class="text-right font-black text-blue-900 uppercase tracking-widest text-sm mt-12">
                                    Huy Cận</p>
                            </div>
                        </div>
                        <div class="mt-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[32px] p-8 text-white shadow-xl"
                            id="summary-placeholder">
                            <div class="flex flex-col md:flex-row items-center gap-8 relative z-10">
                                <div
                                    class="bg-white/20 backdrop-blur-md p-6 rounded-2xl border border-white/30 shadow-lg shrink-0 text-center min-w-[160px]">
                                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-100 mb-1">
                                        Thông điệp</p>
                                    <h3 class="text-2xl font-black uppercase tracking-tight">Ý NGHĨA</h3>
                                </div>
                                <div class="flex-grow">
                                    <p class="text-lg font-bold leading-relaxed text-blue-50">
                                        Niềm vui lao động và tình yêu biển cả quê hương. Bài thơ thể hiện niềm vui của
                                        người lao động hòa với cảm xúc trước khung cảnh huy hoàng của biển cả.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <aside class="w-full lg:w-[30%]">
                    <div class="glass-card rounded-[40px] p-6 sticky top-28 shadow-xl">
                        <div class="mb-6"><img src="hinh_anh/doanthuyendanhca.png" alt="Minh họa"
                                class="w-full h-auto rounded-3xl object-contain drop-shadow-xl"></div>
                        <div class="flex items-center space-x-4 mb-8">
                            <div
                                class="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-200">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-black text-gray-800 tracking-tight">Tìm hiểu bài</h2>
                        </div>
                        <div class="space-y-4" id="questions-placeholder">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">1.
                                        Khung cảnh thiên nhiên lúc đoàn thuyền ra khơi được miêu tả như thế nào?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2"><span
                                                class="w-1.5 h-1.5 rounded-full bg-green-500"></span><span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span></div>
                                        <p class="font-medium">Đoàn thuyền ra khơi lúc mặt trời đang lặn, chuyển sang
                                            đêm. Tác giả dùng hình ảnh so sánh "như hòn lửa" và nhân hóa "sóng cài then,
                                            đêm sập cửa" để miêu tả biển cả gần gũi như ngôi nhà.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">2.
                                        Những chi tiết nào thể hiện niềm vui và tình yêu biển cả của người lao
                                        động?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2"><span
                                                class="w-1.5 h-1.5 rounded-full bg-green-500"></span><span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span></div>
                                        <p class="font-medium">o Tiếng hát căng buồm, xua tan mệt nhọc ("Ta hát bài ca
                                            gọi cá vào").<br>o Lòng biết ơn: Ví biển như "lòng mẹ" nuôi lớn đời ta tự
                                            bao đời.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">3.
                                        Hình ảnh "đoàn thuyền chạy đua cùng mặt trời" ở khổ thơ cuối nói lên điều
                                        gì?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2"><span
                                                class="w-1.5 h-1.5 rounded-full bg-green-500"></span><span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span></div>
                                        <p class="font-medium">Hình ảnh này thể hiện sự hòa quyện giữa vẻ đẹp thiên
                                            nhiên rực rỡ và tư thế lao động khỏe khoắn, đầy hào khí, khẩn trương của
                                            người ngư dân khi trở về.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
        <div id="tab-quiz" class="tab-content">
            <div
                class="max-w-4xl mx-auto glass-card rounded-[40px] shadow-2xl overflow-hidden flex flex-col min-h-[500px]">
                <!-- Registration -->
                <div id="quiz-registration" class="p-4 md:p-8 flex-grow flex flex-col justify-center overflow-auto">
                    <div class="text-center mb-6">
                        <div
                            class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl mx-auto transform -rotate-3">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                </path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-black text-gray-800 mb-1 tracking-tight">Đăng ký luyện tập</h2>
                        <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Đoàn thuyền đánh cá</p>
                    </div>
                    <form onsubmit="startQuiz(event)" class="w-full max-w-sm mx-auto space-y-4">
                        <input type="text" id="studentName" required placeholder="Họ và tên của em"
                            class="w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold placeholder:text-gray-300 shadow-sm">
                        <div class="grid grid-cols-2 gap-4">
                            <select id="studentClass" required
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                <option value="">Chọn Lớp</option>
                                <option value="5/1">5/1</option>
                                <option value="5/2">5/2</option>
                                <option value="5/3">5/3</option>
                                <option value="5/4">5/4</option>
                                <option value="5/5">5/5</option>
                            </select>
                            <select id="schoolSelect" required onchange="checkSchool()"
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                <option value="Tiểu học Đỗ Văn Nại">TH Đỗ Văn Nại</option>
                                <option value="Khác">Trường khác...</option>
                            </select>
                        </div>
                        <input type="text" id="otherSchool" placeholder="Tên trường của em"
                            class="hidden w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white transition-all font-bold shadow-sm">
                        <button type="submit"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl transition-all active:scale-95 text-base uppercase tracking-wider">Bắt
                            đầu luyện tập</button>
                    </form>
                </div>
                <!-- Quiz Engine -->
                <div id="quiz-container" class="hidden flex-grow flex flex-col">
                    <div class="bg-blue-600/5 px-6 py-4 flex justify-between items-center border-b border-blue-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black mr-4 shadow-lg"
                                id="questionNum">1</div>
                            <div class="flex flex-col"><span
                                    class="text-[10px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1"
                                    id="progressText">CÂU TRẮC NGHIỆM: 1/5</span><span
                                    class="text-xs text-gray-400 font-bold leading-none">Đoàn thuyền đánh cá</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 flex-grow flex flex-col justify-center overflow-auto">
                        <h3 class="text-xl md:text-2xl font-black text-gray-800 mb-6 leading-tight transition-all"
                            id="questionText">Nội dung câu hỏi?</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="optionsArea"></div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-50 flex justify-between items-center bg-gray-50/50">
                        <span class="text-xs font-bold text-gray-400 italic">* Chọn đáp án đúng nhất</span>
                        <button id="nextBtn" disabled
                            class="bg-blue-600 disabled:opacity-30 hover:bg-blue-700 text-white font-black py-3 px-10 rounded-2xl shadow-lg transition-all active:scale-95 uppercase text-sm tracking-widest">Câu
                            tiếp theo</button>
                    </div>
                </div>
                <!-- Results -->
                <div id="quiz-results"
                    class="hidden p-8 flex-grow flex flex-col items-center justify-center text-center">
                    <div class="relative w-40 h-40 mb-8">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="80" cy="80" r="74" stroke="currentColor" stroke-width="12" fill="transparent"
                                class="text-gray-100" />
                            <circle id="scoreCircle" cx="80" cy="80" r="74" stroke="url(#scoreGrad)" stroke-width="12"
                                fill="transparent" class="transition-all duration-1000 ease-out"
                                stroke-dasharray="0, 465" stroke-linecap="round" />
                            <defs>
                                <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#3b82f6" />
                                    <stop offset="100%" stop-color="#818cf8" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center"><span
                                class="text-5xl font-black text-gray-800" id="scoreText">0</span><span
                                class="text-[10px] text-gray-400 font-black uppercase tracking-[0.2em] mt-1">Điểm
                                số</span></div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành bài tập!</h2>
                    <p class="text-gray-500 mb-10 max-w-sm font-bold" id="resultMsg">Em đã nỗ lực hết mình rồi đấy!</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md">
                        <button onclick="restartQuiz()"
                            class="bg-white hover:bg-gray-50 text-gray-700 font-black py-4 rounded-2xl border-2 border-gray-100 transition-all shadow-sm">LÀM
                            LẠI</button>
                        <button onclick="submitResults(event)"
                            class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl transition-all">NỘP
                            KẾT QUẢ</button>
                    </div>
                </div>
            </div>
            <!-- Modals -->
            <div id="statsModal" class="modal">
                <div
                    class="bg-white rounded-[40px] w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl m-4 transform transition-all">
                    <div class="p-8 border-b flex justify-between items-center bg-gray-50/50 backdrop-blur-xl">
                        <div class="flex items-center space-x-4">
                            <div
                                class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg">
                                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                    </path>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-2xl font-black text-gray-800 tracking-tight">Bảng kết quả học tập</h2>
                                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-1">Dành riêng cho
                                    giáo viên</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3"><button onclick="exportToExcel()"
                                class="bg-green-600 hover:bg-green-700 text-white font-black py-3 px-6 rounded-2xl text-sm flex items-center shadow-lg transition-all active:scale-95"><svg
                                    class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg> XUẤT EXCEL</button><button onclick="closeModal()"
                                class="w-12 h-12 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-2xl transition-all"><svg
                                    class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                        d="M6 18L18 6M6 6l12 12"></path>
                                </svg></button></div>
                    </div>
                    <div class="flex-grow overflow-auto p-8 bg-gray-50/30">
                        <table class="w-full">
                            <thead>
                                <tr
                                    class="text-left text-gray-400 uppercase text-[10px] font-black tracking-[0.2em] border-b-2 border-gray-100 pb-4">
                                    <th class="px-6 py-4">STT</th>
                                    <th class="px-6 py-4">Họ và Tên</th>
                                    <th class="px-6 py-4">Lớp</th>
                                    <th class="px-6 py-4">Trường</th>
                                    <th class="px-6 py-4 text-center">Điểm</th>
                                    <th class="px-6 py-4 text-center">Lần</th>
                                    <th class="px-6 py-4 text-center">Thời gian</th>
                                    <th class="px-6 py-4 text-right">Hoàn thành</th>
                                </tr>
                            </thead>
                            <tbody id="statsTableBody" class="divide-y divide-gray-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="successModal" class="success-modal">
                <div
                    class="glass-card success-card rounded-[40px] p-10 max-w-sm w-full text-center shadow-3xl border-white/50">
                    <div
                        class="w-24 h-24 bg-gradient-to-br from-green-400 to-emerald-600 rounded-3xl flex items-center justify-center text-white mx-auto mb-8 shadow-xl transform rotate-6 scale-110">
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2 tracking-tight">Nộp bài thành công!</h2>
                    <p class="text-gray-500 mb-10 font-bold leading-relaxed">Chúc mừng em đã hoàn thành thử thách kiến
                        thức!</p><button onclick="closeSuccessModal()"
                        class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl transition-all active:scale-95 uppercase tracking-widest text-sm">Trở
                        về bài học</button>
                </div>
            </div>
        </div>
    </main>
    <footer class="py-5 px-4 mt-12 bg-white/30 backdrop-blur-md border-t border-white/50 text-center">
        <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">@ 2026 EduRobot - Hệ thống học tập
            thông minh</p>
        <p class="text-xs font-bold text-blue-600 mt-2">Phát triển bởi Lê Thành Long</p>
    </footer>
    <script id="script-placeholder">
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }
        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');
        function toggleAudio() {
            if (audio.paused) { audio.play(); playIcon.classList.add('hidden'); pauseIcon.classList.remove('hidden'); audioStatus.innerText = "Đang phát..."; audioStatus.classList.replace('text-gray-400', 'text-green-500'); }
            else { audio.pause(); playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); audioStatus.innerText = "Đang dừng..."; audioStatus.classList.replace('text-green-500', 'text-gray-400'); }
        }
        audio.onended = () => { playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden'); audioStatus.innerText = "Đang dừng..."; audioStatus.classList.replace('text-green-500', 'text-gray-400'); };
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }
        const allQuestions = [
            { q: "Tác giả của bài thơ \"Đoàn thuyền đánh cá\" là ai?", a: ["Tố Hữu", "Trần Đăng Khoa", "Huy Cận", "Xuân Diệu"], c: 2 },
            { q: "Đoàn thuyền đánh cá ra khơi vào thời điểm nào trong ngày?", a: ["Bình minh", "Giữa trưa", "Hoàng hôn", "Nửa đêm"], c: 2 },
            { q: "Trong khổ thơ đầu, \"Mặt trời xuống biển\" được so sánh với gì?", a: ["Quả cầu lửa", "Hòn lửa", "Hòn than", "Ngọn đèn"], c: 1 },
            { q: "Biện pháp nghệ thuật nào được sử dụng trong câu \"Sóng đã cài then, đêm sập cửa\"?", a: ["So sánh", "Nhân hóa", "Điệp từ", "Đảo ngữ"], c: 1 },
            { q: "Âm thanh nào cùng đoàn thuyền căng buồm ra khơi?", a: ["Tiếng sóng vỗ", "Tiếng còi tàu", "Câu hát", "Tiếng gõ thuyền"], c: 2 },
            { q: "Trong câu \"Cá thu Biển Đông như đoàn thoi\", tác giả tả loài cá nào?", a: ["Cá bạc", "Cá nục", "Cá chim", "Cá thu"], c: 3 },
            { q: "Ngư dân \"hát bài ca gọi cá vào\" với ý nghĩa gì?", a: ["Xua đuổi thú dữ", "Xua tan mệt nhọc và cầu mong bội thu", "Thông báo vị trí", "Ru ngủ biển"], c: 1 },
            { q: "Hình ảnh \"Biển cho ta cá như lòng mẹ\" thể hiện điều gì?", a: ["Sợ hãi thiên nhiên", "Chinh phục thiên nhiên", "Lòng biết ơn gắn bó", "Thờ ơ với biển"], c: 2 },
            { q: "Âm thanh nào đóng vai trò giữ nhịp cho bài ca gọi cá vào?", a: ["Sóng vỗ", "Gió thổi", "Nhịp trăng cao gõ thuyền", "Mái chèo"], c: 2 },
            { q: "Đoàn thuyền đánh cá trở về vào thời điểm nào?", a: ["Giữa trưa", "Trăng lên", "Sao mờ, rạng đông", "Màn đêm"], c: 2 },
            { q: "Hình ảnh \"Ta kéo xoăn tay chùm cá nặng\" gợi tả điều gì?", a: ["Đang tập thể dục", "Vẻ đẹp khỏe khoắn và mẻ lưới nặng", "Vất vả đau đớn", "Sợ bão"], c: 1 },
            { q: "Màu sắc nào mô tả cảnh rạng đông trong khổ 4?", a: ["Vảy bạc", "Đuôi vàng", "Nắng hồng", "Tất cả các ý trên"], c: 3 },
            { q: "Ý nghĩa của câu thơ \"Đoàn thuyền chạy đua cùng mặt trời\" là gì?", a: ["Chạy trốn nắng", "Khí thế hào hùng, khẩn trương lao động", "Thi thể thao", "Bị đuổi"], c: 1 },
            { q: "Bài thơ \"Đoàn thuyền đánh cá\" ca ngợi vẻ đẹp nào?", a: ["Thuyền hiện đại", "Con người yêu lao động và biển khơi huy hoàng", "Biển đêm đáng sợ", "Bầu trời sao"], c: 1 },
            { q: "Cảm hứng chủ đạo xuyên suốt bài thơ là gì?", a: ["Buồn man mác", "Lo lắng hiểm nguy", "Vui tươi, lạc quan, hăng say lao động", "Cô đơn"], c: 2 }
        ];
        let selectedQuestions = [], currentIdx = 0, score = 0, studentData = {}, startTime = null;
        function checkSchool() {
            const select = document.getElementById('schoolSelect'), other = document.getElementById('otherSchool');
            if (select.value === 'Khác') { other.classList.remove('hidden'); other.required = true; }
            else { other.classList.add('hidden'); other.required = false; }
        }
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) { randomIndex = Math.floor(Math.random() * currentIndex); currentIndex--;[array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; }
            return array;
        }
        function startQuiz(e) {
            e.preventDefault();
            const schoolVal = document.getElementById('schoolSelect').value;
            studentData = { studentName: document.getElementById('studentName').value, studentClass: document.getElementById('studentClass').value, school: schoolVal === 'Khác' ? document.getElementById('otherSchool').value : schoolVal };
            selectedQuestions = shuffle([...allQuestions]).slice(0, 5); currentIdx = 0; score = 0; startTime = new Date();
            document.getElementById('quiz-registration').classList.add('hidden'); document.getElementById('quiz-container').classList.remove('hidden'); showQuestion();
        }
        function showQuestion() {
            const q = selectedQuestions[currentIdx];
            document.getElementById('questionNum').innerText = currentIdx + 1;
            document.getElementById('progressText').innerText = `CÂU TRẮC NGHIỆM: ${currentIdx + 1}/5`;
            document.getElementById('questionText').innerText = q.q;
            const area = document.getElementById('optionsArea'); area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button'); btn.className = "option-btn w-full p-4 text-left bg-white rounded-2xl font-bold flex items-center group shadow-sm";
                btn.innerHTML = `<div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 group-hover:bg-blue-600 group-hover:text-white transition-all text-xs font-black shadow-inner">${String.fromCharCode(65 + i)}</div><span class="flex-1 text-sm md:text-base text-gray-700">${opt}</span>`;
                btn.onclick = () => selectOption(i, btn); area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true; document.getElementById('nextBtn').onclick = nextQuestion;
        }
        function selectOption(idx, btn) {
            document.querySelectorAll('#optionsArea button').forEach(b => { b.classList.remove('selected'); b.querySelector('div').classList.remove('bg-blue-600', 'text-white'); });
            btn.classList.add('selected'); btn.querySelector('div').classList.add('bg-blue-600', 'text-white');
            document.getElementById('nextBtn').disabled = false; document.getElementById('nextBtn').dataset.selected = idx;
        }
        function nextQuestion() {
            const selected = parseInt(document.getElementById('nextBtn').dataset.selected);
            if (selected === selectedQuestions[currentIdx].c) score += 20;
            currentIdx++; if (currentIdx < 5) showQuestion(); else showResults();
        }
        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden'); document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = score;
            document.getElementById('scoreCircle').style.strokeDasharray = `${(score / 100) * 465}, 465`;
            if (score >= 80) { document.getElementById('resultTitle').innerText = "Rất tuyệt vời!"; document.getElementById('resultMsg').innerText = "Em đã hoàn thành bài tập xuất sắc. Tiếp tục phát huy nhé!"; }
            else if (score >= 60) { document.getElementById('resultTitle').innerText = "Làm tốt lắm!"; document.getElementById('resultMsg').innerText = "Em đã hiểu bài khá tốt rồi đấy!"; }
            else { document.getElementById('resultTitle').innerText = "Cố gắng lên nhé!"; document.getElementById('resultMsg').innerText = "Hãy xem lại bài đọc và làm lại bài tập để đạt điểm cao hơn."; }
        }
        function restartQuiz() { document.getElementById('quiz-results').classList.add('hidden'); document.getElementById('quiz-registration').classList.remove('hidden'); }
        const firebaseConfig = { apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc", authDomain: "gamhoctap.firebaseapp.com", projectId: "gamhoctap", storageBucket: "gamhoctap.firebasestorage.app", messagingSenderId: "833329613932", appId: "1:833329613932:web:0d8574827bcfe50b535c49", measurementId: "G-YT1PKCYS67" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();
        function closeSuccessModal() { document.getElementById('successModal').classList.remove('active'); restartQuiz(); switchTab('lesson'); }
        async function submitResults(e) {
            const btn = e.target; btn.disabled = true; btn.innerText = "Đang gửi...";
            const duration = Math.floor((new Date() - startTime) / 1000);
            const timeStr = `${Math.floor(duration / 60)}p ${duration % 60}s`;
            try {
                await db.collection("diem_tieng_viet_lop5").add({ ...studentData, lessonTitle: "Đoàn thuyền đánh cá", score: score, duration: duration, timeDisplay: timeStr, submittedAt: firebase.firestore.FieldValue.serverTimestamp() });
                document.getElementById('successModal').classList.add('active');
            } catch (err) { console.error(err); alert("Có lỗi khi gửi kết quả."); } finally { btn.disabled = false; btn.innerText = "NỘP KẾT QUẢ"; }
        }
        function openTeacherStats() { const pin = prompt("Mã PIN:"); if (pin === "dvn") { document.getElementById('statsModal').classList.add('active'); loadStats(); } }
        function closeModal() { document.getElementById('statsModal').classList.remove('active'); }
        let currentStatsData = [];
        async function loadStats() {
            const tbody = document.getElementById('statsTableBody'); tbody.innerHTML = '<tr><td colspan="8" class="text-center p-10">Đang tải...</td></tr>';
            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Đoàn thuyền đánh cá").get();
                if (snapshot.empty) { tbody.innerHTML = '<tr><td colspan="8" class="text-center p-10">Chưa có dữ liệu.</td></tr>'; return; }
                const groups = {};
                snapshot.forEach(doc => {
                    const d = doc.data(), key = `${d.studentName}_${d.studentClass}`.toLowerCase();
                    if (!groups[key] || d.score > groups[key].score) groups[key] = { ...d, attempts: (groups[key]?.attempts || 0) + 1 };
                    else groups[key].attempts++;
                });
                currentStatsData = Object.values(groups).sort((a, b) => b.score - a.score);
                tbody.innerHTML = currentStatsData.map((d, i) => `<tr class="border-b text-sm"><td class="p-4">${i + 1}</td><td class="p-4 font-bold">${d.studentName}</td><td class="p-4 font-bold text-center">${d.studentClass}</td><td class="p-4 text-xs">${d.school}</td><td class="p-4 text-center font-bold text-blue-600">${d.score}</td><td class="p-4 text-center">${d.attempts}</td><td class="p-4 text-center">${d.timeDisplay}</td><td class="p-4 text-right text-[10px]">${d.submittedAt ? d.submittedAt.toDate().toLocaleString() : 'N/A'}</td></tr>`).join('');
            } catch (err) { console.error(err); tbody.innerHTML = '<tr><td colspan="8" class="text-center p-10 text-red-500">Lỗi tải dữ liệu.</td></tr>'; }
        }
        function exportToExcel() {
            if (!currentStatsData.length) return;
            const ws = XLSX.utils.json_to_sheet(currentStatsData.map((d, i) => ({ 'STT': i + 1, 'Họ Tên': d.studentName, 'Lớp': d.studentClass, 'Trường': d.school, 'Điểm': d.score, 'Số lần': d.attempts, 'Thời gian': d.timeDisplay, 'Ngày nộp': d.submittedAt ? d.submittedAt.toDate().toLocaleString() : '' })));
            ws['!cols'] = [{ wch: 5 }, { wch: 25 }, { wch: 10 }, { wch: 30 }, { wch: 10 }, { wch: 10 }, { wch: 15 }, { wch: 20 }];
            const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Diem");
            XLSX.writeFile(wb, "KetQua_DoanThuyenDanhCa.xlsx");
        }
    </script>
</body>

</html>