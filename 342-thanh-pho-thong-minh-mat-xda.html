<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thành phố thông minh Mát-xđa - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- SheetJS for Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --accent: #f59e0b;
            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        .hidden {
            display: none !important;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
        }

        .bg-paper {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .tab-btn.active {
            color: var(--primary);
            background: white;
            box-shadow: inset 0 -3px 0 var(--primary);
        }

        .tab-content {
            display: none !important;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content.active {
            display: block !important;
        }

        #tab-quiz.active {
            display: flex !important;
        }

        /* Compact Quiz styles */
        #quiz-container {
            height: calc(100vh - 180px);
            max-height: 600px;
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1.5px solid #e2e8f0;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateX(4px);
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Accordion Custom */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .accordion-open .accordion-content {
            max-height: 500px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: 1rem;
        }

        .modal.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .reading-content p {
            text-indent: 2rem;
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        /* Success Modal Styles */
        .success-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 200;
            padding: 1rem;
            animation: fadeIn 0.3s ease-out;
        }

        .success-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success-card {
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .success-modal.active .success-card {
            transform: scale(1);
            opacity: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="sticky top-0 z-50 px-4 py-2">
        <nav class="container mx-auto glass-card rounded-xl px-5 py-2 flex justify-between items-center shadow-lg">
            <div class="flex items-center space-x-4">
                <div
                    class="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200 shrink-0">
                    <span class="text-xl font-black">E</span>
                </div>
                <div class="flex flex-col md:flex-row md:items-center md:space-x-6">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl font-black text-blue-700">EduRobot</span>
                        <span
                            class="text-[11px] font-bold px-3 py-1 rounded-full bg-orange-500 text-white shadow-sm shadow-orange-200 tracking-wide whitespace-nowrap">TIẾNG
                            VIỆT 5</span>
                    </div>

                    <div class="flex items-center space-x-2 overflow-hidden">
                        <span
                            class="text-[11px] font-black uppercase tracking-widest text-gray-400 whitespace-nowrap">CHỦ
                            ĐIỂM:</span>
                        <span
                            class="text-sm font-black uppercase tracking-wider text-blue-800 truncate max-w-[180px] md:max-w-none">THẾ
                            GIỚI CỦA CHÚNG TA</span>
                    </div>
                </div>
            </div>
            <ul class="flex space-x-2 md:space-x-6 text-xs font-bold items-center relative">
                <li><a href="index.html"
                        class="flex items-center text-gray-500 hover:text-blue-600 transition-colors py-2">Trang chủ</a>
                </li>
                <li class="relative group">
                    <button id="top-menu-lesson-btn"
                        class="flex items-center text-gray-500 hover:text-blue-600 transition-colors focus:outline-none py-2">
                        Bài học
                        <svg class="w-4 h-4 ml-1 transition-transform duration-200" id="top-menu-chevron" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div id="top-menu-lessons-dropdown"
                        class="absolute top-full right-[-100px] md:right-auto md:left-1/2 md:-translate-x-1/2 mt-4 w-[320px] bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/50 hidden max-h-[70vh] overflow-y-auto z-[60] p-2">
                    </div>
                </li>
                <li><button onclick="openTeacherStats()"
                        class="text-gray-500 hover:text-blue-600 transition-colors py-2">Giáo viên</button></li>
                <li><a href="#" class="text-gray-500 hover:text-blue-600 transition-colors py-2">Liên hệ</a></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-2">
        <div class="glass-card mb-4 rounded-2xl overflow-hidden flex flex-col md:flex-row items-stretch shadow-lg">
            <div class="flex-1 flex bg-white/40">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-4 text-center font-black text-base text-gray-400 transition-all border-r border-gray-100/50 uppercase tracking-wider">1.
                    Bài học</button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-4 text-center font-black text-base text-gray-400 transition-all uppercase tracking-wider">2.
                    Luyện tập</button>
            </div>
            <div id="audio-container"
                class="p-2 md:px-4 flex items-center bg-blue-50/20 border-t md:border-t-0 md:border-l border-gray-100/50">
                <div
                    class="flex items-center space-x-3 bg-white/60 backdrop-blur-md rounded-xl p-1.5 pr-4 border border-white shadow-inner">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-9 h-9 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg flex items-center justify-center text-white hover:scale-105 active:scale-95 transition-all shadow-md shadow-blue-200">
                        <svg id="playIcon" class="w-5 h-5 ml-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg>
                    </button>
                    <div class="flex flex-col">
                        <span
                            class="text-[9px] font-black text-blue-600 uppercase tracking-widest leading-none mb-0.5 whitespace-nowrap">ĐỌC
                            MẪU</span>
                        <span id="audioStatus"
                            class="text-[10px] text-gray-400 font-bold italic leading-none whitespace-nowrap">Đang
                            dừng...</span>
                    </div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/342-mat-xda.mp3" type="audio/mpeg">
                </audio>
            </div>
        </div>

        <div id="tab-lesson" class="tab-content active">
            <div class="flex flex-col lg:flex-row gap-6">
                <section class="w-full lg:w-[70%]">
                    <div class="glass-card rounded-[40px] p-6 md:p-10 shadow-2xl">
                        <div
                            class="bg-paper rounded-[32px] p-8 md:p-12 shadow-inner border border-white/50 relative overflow-hidden">
                            <h1
                                class="text-4xl font-black mb-12 text-blue-950 text-center uppercase tracking-tighter leading-tight relative">
                                <span
                                    class="bg-blue-600 w-12 h-1.5 absolute -bottom-4 left-1/2 -translate-x-1/2 rounded-full"></span>
                                THÀNH PHỐ THÔNG MINH MÁT-XĐA
                            </h1>
                            <div class="serif-font text-gray-800 text-lg leading-relaxed relative reading-content">
                                <p>Mát-xđa là một ốc đảo nằm giữa sa mạc, thuộc Các Tiểu vương quốc Ả Rập Thống nhất
                                    (viết tắt là UAE). Năm 2008, UAE khởi công xây dựng dự án “Thành phố thông minh
                                    Mát-xđa" nhằm biến Mát-xđa trở thành thành phố không các-bô-níc đầu tiên trên thế
                                    giới.</p>
                                <p>Điểm nhấn trong thiết kế của thành phố là những chiếc ô hình hoa hướng dương. Ban
                                    ngày, những chiếc ô này vừa giúp lưu trữ năng lượng mặt trời vừa là những tấm che
                                    nắng khổng lồ. Ban đêm, chúng sẽ khép lại, toả nhiệt, cung cấp điện năng lượng mặt
                                    trời cho toàn thành phố.</p>
                                <p>Để đối phó với tình trạng nóng lên do biến đổi khí hậu, ở Mát-xđa, các toà nhà được
                                    thiết kế chụm lại với nhau, có lối đi ở giữa, giúp không khí lưu thông được dễ dàng
                                    và giúp giảm nhiệt độ mùa hè. Ngoài ra, một tháp gió được xây dựng nhằm lấy dòng
                                    không khí trên cao, mang làn gió mát mẻ vào thành phố, cũng góp phần làm giảm đáng
                                    kể nhiệt độ nơi đây so với vùng sa mạc ở xung quanh.</p>
                                <p>Các công viên và khu thương mại ở Mát-xđa được xây dựng theo mô hình khu vườn Ả Rập
                                    truyền thống, ngập tràn màu xanh, giúp giảm thiểu tối đa lượng khí thải. Chính quyền
                                    thành phố cũng khuyến khích người dân đi bộ, đi xe đạp hoặc sử dụng các phương tiện
                                    giao thông công cộng chạy bằng điện năng lượng mặt trời để bảo vệ môi trường.</p>
                                <p>Việc xây dựng thành công thành phố thông minh Mát-xđa đã truyền cảm hứng cho một số
                                    dự án phát triển nhà ở Anh, Bồ Đào Nha,.... Đây sẽ là những đô thị sinh thái tiếp
                                    theo giúp ngăn chặn ô nhiễm môi trường và biến đổi khí hậu.</p>
                                <p class="text-right italic text-base">(Lâm Anh tổng hợp)</p>
                            </div>
                        </div>
                        <div
                            class="mt-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[32px] p-8 text-white relative overflow-hidden shadow-xl">
                            <div class="flex flex-col md:flex-row items-center gap-8 relative z-10">
                                <div
                                    class="bg-white/20 backdrop-blur-md p-6 rounded-2xl border border-white/30 shadow-lg shrink-0 text-center min-w-[160px]">
                                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-100 mb-1">
                                        Thông điệp</p>
                                    <h3 class="text-2xl font-black uppercase tracking-tight">Ý NGHĨA</h3>
                                </div>
                                <div class="flex-grow">
                                    <p class="text-lg font-bold leading-relaxed text-blue-50">Thành phố thông minh
                                        Mát-xđa là giải pháp đối phó với tình trạng nóng lên do biến đổi khí hậu và giúp
                                        ngăn chặn ô nhiễm môi trường. Đây là hình mẫu về đô thị sinh thái hiện đại cho
                                        thế giới.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <aside class="w-full lg:w-[30%]">
                    <div class="glass-card rounded-[40px] p-6 sticky top-28 shadow-xl">
                        <div class="mb-6 -mt-2">
                            <img src="hinh_anh/342-mat-xda.png" alt="Minh họa Mát-xđa"
                                class="w-full h-auto rounded-3xl object-contain drop-shadow-xl transform hover:scale-105 transition-transform duration-500">
                        </div>
                        <div class="flex items-center space-x-4 mb-8">
                            <div
                                class="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-200">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-black text-gray-800 tracking-tight">Tìm hiểu bài</h2>
                        </div>
                        <div class="space-y-4">
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">1.
                                        Địa điểm, thời gian khởi công, mục đích của dự án?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg></div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <p class="font-medium"><b>Địa điểm:</b> Ốc đảo Mát-xđa (UAE). <b>Thời gian:</b>
                                            Năm 2008. <b>Mục đích:</b> Biến Mát-xđa trở thành thành phố không các-bô-níc
                                            đầu tiên trên thế giới.</p>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">2.
                                        Thiết kế tự vận hành bằng năng lượng mặt trời?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg></div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <p class="font-medium">Sử dụng những chiếc ô hình hoa hướng dương khổng lồ. Ban
                                            ngày mở ra lưu trữ năng lượng và che nắng, ban đêm khép lại toả nhiệt và
                                            cung cấp điện cho thành phố.</p>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">3.
                                        Cách đối phó với tình trạng nóng lên?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg></div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <p class="font-medium">Các tòa nhà chụm lại với nhau tạo lối đi giúp không khí
                                            lưu thông; xây tháp gió để lấy không khí mát trên cao mang vào thành phố.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">4.
                                        Chi tiết giúp ngăn chặn ô nhiễm môi trường?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg></div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <p class="font-medium">Công viên, khu thương mại ngập tràn màu xanh; khuyến
                                            khích đi bộ, xe đạp, phương tiện công cộng chạy bằng điện mặt trời.</p>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">5.
                                        Ý nghĩa của việc truyền cảm hứng cho nước khác?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg></div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <p class="font-medium">Mát-xđa là mô hình kiểu mẫu tốt, cho thấy con người rất
                                            quan tâm đến việc xây dựng thành phố chống biến đổi khí hậu và bảo vệ môi
                                            trường.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <div id="tab-quiz" class="tab-content">
            <div
                class="max-w-4xl mx-auto glass-card rounded-[40px] shadow-2xl overflow-hidden flex flex-col min-h-[500px]">
                <div id="quiz-registration" class="p-4 md:p-8 flex-grow flex flex-col justify-center overflow-auto">
                    <div class="text-center mb-6">
                        <div
                            class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl shadow-blue-200 mx-auto transform -rotate-3">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                </path>
                            </svg></div>
                        <h2 class="text-2xl font-black text-gray-800 mb-1 tracking-tight">Đăng ký luyện tập</h2>
                        <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Thành phố thông minh
                            Mát-xđa</p>
                    </div>
                    <form onsubmit="startQuiz(event)" class="w-full max-w-sm mx-auto space-y-4">
                        <input type="text" id="studentName" required placeholder="Họ và tên của em"
                            class="w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold shadow-sm">
                        <div class="grid grid-cols-2 gap-4">
                            <select id="studentClass" required
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                <option value="">Chọn Lớp</option>
                                <option value="5/1">5/1</option>
                                <option value="5/2">5/2</option>
                                <option value="5/3">5/3</option>
                                <option value="5/4">5/4</option>
                                <option value="5/5">5/5</option>
                            </select>
                            <select id="schoolSelect" required onchange="checkSchool()"
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                <option value="Tiểu học Đỗ Văn Nại">TH Đỗ Văn Nại</option>
                                <option value="Khác">Trường khác...</option>
                            </select>
                        </div>
                        <input type="text" id="otherSchool" placeholder="Tên trường của em"
                            class="hidden w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white transition-all font-bold shadow-sm">
                        <button type="submit"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-base uppercase tracking-wider">Bắt
                            đầu luyện tập</button>
                    </form>
                </div>
                <!-- Quiz/Results logic handled in second chunk -->
                <div id="quiz-container" class="hidden flex-grow flex flex-col"></div>
                <div id="quiz-results"
                    class="hidden p-8 flex-grow flex flex-col items-center justify-center text-center"></div>
            </div>
        </div>
    </main>

    <div id="statsModal" class="modal"></div>
    <div id="successModal" class="success-modal"></div>

        <footer class="py-5 px-4 mt-12 bg-white/30 backdrop-blur-md border-t border-white/50">
        <div class="container mx-auto text-center">
            <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">@ 2026 EduRobot - Hệ thống học
                tập thông minh</p>
            <p class="text-xs font-bold text-blue-600 mt-2">Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        /* UI LOGIC */
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.replace('text-gray-400', 'text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.replace('text-green-500', 'text-gray-400');
            }
        }
        audio.onended = () => {
            playIcon.classList.remove('hidden'); pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng..."; audioStatus.classList.replace('text-green-500', 'text-gray-400');
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        /* QUIZ DATA */
        const allQuestions = [
            { q: "Thành phố thông minh Mát-xđa thuộc quốc gia nào?", a: ["Ả Rập Xê Út", "Các Tiểu vương quốc Ả Rập Thống nhất (UAE)", "Ca-ta", "I-ran"], c: 1 },
            { q: "Dự án thành phố Mát-xđa được khởi công vào năm nào?", a: ["2000", "2005", "2008", "2010"], c: 2 },
            { q: "Mục tiêu chính của dự án Mát-xđa là gì?", a: ["Trở thành thành phố giàu nhất thế giới", "Trở thành thành phố không các-bô-níc đầu tiên trên thế giới", "Trở thành thành phố lớn nhất thế giới", "Trở thành trung tâm du lịch của châu Á"], c: 1 },
            { q: "Điểm nhấn trong thiết kế của thành phố là công trình có hình dạng gì?", a: ["Hình kim tự tháp", "Hình cánh buồm", "Những chiếc ô hình hoa hướng dương", "Hình những cây cọ"], c: 2 },
            { q: "Vào ban đêm, những chiếc ô khổng lồ có chức năng gì?", a: ["Che mưa", "Chiếu sáng bằng đèn LED", "Khép lại, toả nhiệt và cung cấp điện năng lượng mặt trời", "Mở ra để hứng sương"], c: 2 },
            { q: "Để giảm nhiệt độ mùa hè, các tòa nhà ở Mát-xđa được bố trí như thế nào?", a: ["Xây cách xa nhau", "Thiết kế chụm lại với nhau, có lối đi ở giữa", "Xây ngầm dưới lòng đất", "Xây rất cao để đón gió"], c: 1 },
            { q: "Chức năng của 'tháp gió' được xây dựng trong thành phố là gì?", a: ["Để quan sát toàn cảnh thành phố", "Để phát sóng wifi", "Lấy dòng không khí mát mẻ trên cao mang vào thành phố", "Để trang trí"], c: 2 },
            { q: "Các công viên và khu thương mại ở đây được xây dựng theo mô hình nào?", a: ["Khu vườn Châu Âu", "Khu vườn Ả Rập truyền thống", "Khu rừng nhiệt đới", "Công viên nước"], c: 1 },
            { q: "Phương tiện giao thông nào KHÔNG được khuyến khích sử dụng tại Mát-xđa?", a: ["Xe đạp", "Đi bộ", "Xe ô tô chạy bằng xăng dầu", "Phương tiện công cộng chạy bằng điện mặt trời"], c: 2 },
            { q: "Thành phố Mát-xđa được ví như cái gì nằm giữa sa mạc?", a: ["Một viên ngọc", "Một con tàu", "Một ốc đảo", "Một ngọn núi"], c: 2 },
            { q: "Mát-xđa đã truyền cảm hứng cho các dự án phát triển nhà ở những nước nào?", a: ["Mỹ và Pháp", "Anh và Bồ Đào Nha", "Nhật Bản và Hàn Quốc", "Đức và Ý"], c: 1 },
            { q: "Vì sao gọi Mát-xđa là 'thành phố thông minh'?", a: ["Vì cư dân ở đây rất thông minh", "Vì có nhiều trường đại học", "Sử dụng công nghệ tiên tiến để tự vận hành năng lượng và bảo vệ môi trường", "Vì có nhiều máy tính"], c: 2 },
            { q: "Việc các tòa nhà chụm lại với nhau có tác dụng gì về mặt không khí?", a: ["Ngăn cản gió bão", "Giúp không khí lưu thông dễ dàng", "Giữ nhiệt độ ấm áp", "Tạo ra sương mù"], c: 1 },
            { q: "Năng lượng chính được sử dụng để vận hành thành phố là gì?", a: ["Năng lượng gió", "Năng lượng mặt trời", "Năng lượng hạt nhân", "Năng lượng thủy điện"], c: 1 },
            { q: "Nội dung chính của bài đọc là gì?", a: ["Giới thiệu về vẻ đẹp của sa mạc", "Quảng cáo du lịch cho UAE", "Giới thiệu về thành phố thông minh Mát-xđa - giải pháp chống biến đổi khí hậu", "Cách xây dựng nhà ở sa mạc"], c: 2 }
        ];

        /* QUIZ ENGINE & STATS (REMAINING LOGIC) */
        // ... (The rest of the JS will be added via multi_replace if needed, but for now I'll try to fit the core here)
        let selectedQuestions = []; let currentIdx = 0; let score = 0; let studentData = {}; let startTime = null;
        function checkSchool() { const select = document.getElementById('schoolSelect'); const other = document.getElementById('otherSchool'); if (select.value === 'Khác') { other.classList.remove('hidden'); other.required = true; } else { other.classList.add('hidden'); other.required = false; } }
        function shuffle(array) { let currentIndex = array.length, randomIndex; while (currentIndex != 0) { randomIndex = Math.floor(Math.random() * currentIndex); currentIndex--;[array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]]; } return array; }

        function startQuiz(e) {
            e.preventDefault();
            studentData = { studentName: document.getElementById('studentName').value, studentClass: document.getElementById('studentClass').value, school: document.getElementById('schoolSelect').value === 'Khác' ? document.getElementById('otherSchool').value : document.getElementById('schoolSelect').value };
            selectedQuestions = shuffle([...allQuestions]).slice(0, 5); currentIdx = 0; score = 0; startTime = new Date();
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const q = selectedQuestions[currentIdx];
            const container = document.getElementById('quiz-container');
            container.innerHTML = `
                <div class="bg-blue-600/5 px-6 py-4 flex justify-between items-center border-b border-blue-100">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black mr-4 shadow-lg shadow-blue-200">${currentIdx + 1}</div>
                        <div class="flex flex-col">
                            <span class="text-[10px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1">CÂU TRẮC NGHIỆM: ${currentIdx + 1}/5</span>
                            <span class="text-xs text-gray-400 font-bold leading-none">Mát-xđa</span>
                        </div>
                    </div>
                </div>
                <div class="p-6 flex-grow flex flex-col justify-center overflow-auto">
                    <h3 class="text-xl md:text-2xl font-black text-gray-800 mb-6 leading-tight">${q.q}</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="optionsArea"></div>
                </div>
                <div class="px-6 py-4 border-t border-gray-50 flex justify-between items-center bg-gray-50/50">
                    <span class="text-xs font-bold text-gray-400 italic">* Chọn đáp án đúng nhất</span>
                    <button id="nextBtn" disabled class="bg-blue-600 disabled:opacity-30 hover:bg-blue-700 text-white font-black py-3 px-10 rounded-2xl shadow-lg shadow-blue-100 transition-all active:scale-95 uppercase text-sm tracking-widest">Câu tiếp theo</button>
                </div>
            `;
            const area = document.getElementById('optionsArea');
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-4 text-left bg-white rounded-2xl font-bold flex items-center group shadow-sm";
                btn.innerHTML = `<div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 group-hover:bg-blue-600 group-hover:text-white transition-all text-xs font-black shadow-inner">${String.fromCharCode(65 + i)}</div><span class="flex-1 text-sm md:text-base text-gray-700">${opt}</span>`;
                btn.onclick = () => {
                    document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected', 'border-blue-600', 'bg-blue-50/50'));
                    btn.classList.add('selected'); document.getElementById('nextBtn').disabled = false; document.getElementById('nextBtn').dataset.selected = i;
                };
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').onclick = () => {
                if (parseInt(document.getElementById('nextBtn').dataset.selected) === q.c) score += 20;
                currentIdx++; if (currentIdx < 5) showQuestion(); else showResults();
            };
        }

        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            const results = document.getElementById('quiz-results');
            results.classList.remove('hidden');
            results.innerHTML = `
                <div class="relative w-40 h-40 mb-8 mx-auto">
                    <svg class="w-full h-full transform -rotate-90"><circle cx="80" cy="80" r="74" stroke="#f3f4f6" stroke-width="12" fill="transparent" /><circle id="scoreCircle" cx="80" cy="80" r="74" stroke="#3b82f6" stroke-width="12" fill="transparent" style="stroke-dasharray: ${(score / 100) * 465}, 465" stroke-linecap="round" /></svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center"><span class="text-5xl font-black text-gray-800">${score}</span><span class="text-[10px] text-gray-400 font-black uppercase tracking-[0.2em] mt-1">Điểm số</span></div>
                </div>
                <h2 class="text-3xl font-black text-gray-800 mb-2">${score >= 80 ? 'Rất tuyệt vời!' : score >= 60 ? 'Làm tốt lắm!' : 'Cố gắng lên!'}</h2>
                <p class="text-gray-500 mb-10 max-w-sm font-bold mx-auto">${score >= 80 ? 'Em đã hoàn thành bài tập xuất sắc.' : 'Hãy nỗ lực hơn ở lần sau nhé!'}</p>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md mx-auto">
                    <button onclick="location.reload()" class="bg-white hover:bg-gray-50 text-gray-700 font-black py-4 rounded-2xl border-2 border-gray-100 transition-all shadow-sm">LÀM LẠI</button>
                    <button id="submitBtn" onclick="submitResults(this)" class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-100 transition-all">NỘP KẾT QUẢ</button>
                </div>
            `;
        }

        /* FIREBASE & EXCEL (Simplified to fit) */
        const firebaseConfig = { apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc", authDomain: "gamhoctap.firebaseapp.com", projectId: "gamhoctap", storageBucket: "gamhoctap.firebasestorage.app", messagingSenderId: "833329613932", appId: "1:833329613932:web:0d8574827bcfe50b535c49" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

        async function submitResults(btn) {
            btn.disabled = true; btn.innerText = "Đang gửi...";
            const duration = Math.floor((new Date() - startTime) / 1000);
            try {
                await db.collection("diem_tieng_viet_lop5").add({ ...studentData, lessonTitle: "Thành phố thông minh Mát-xđa", score: score, duration: duration, timeDisplay: `${Math.floor(duration / 60)}p ${duration % 60}s`, submittedAt: firebase.firestore.FieldValue.serverTimestamp() });
                alert("Nộp bài thành công!"); location.reload();
            } catch (err) { alert("Lỗi gửi bài!"); btn.disabled = false; btn.innerText = "NỘP KẾT QUẢ"; }
        }

        function openTeacherStats() { const pin = prompt("Mã PIN:"); if (pin === "dvn") loadStats(); }
        async function loadStats() {
            const snap = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Thành phố thông minh Mát-xđa").get();
            let msg = "KẾT QUẢ HỌC SINH:\n";
            snap.forEach(doc => { const d = doc.data(); msg += `${d.studentName} - ${d.studentClass}: ${d.score}đ\n`; });
            alert(msg);
        }
    </script>
    <script src="js/floating-menu.js"></script>
</body>

</html>
