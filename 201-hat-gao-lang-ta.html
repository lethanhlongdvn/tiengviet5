<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hạt gạo làng ta - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Nunito & Merriweather -->
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --accent: #f59e0b;
            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            font-size: 19px;
            line-height: 1.8;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .accordion-open .accordion-content {
            max-height: 1000px;
            padding-bottom: 1.5rem;
        }

        .bg-paper {
            background-color: #fdfcf7;
            background-image: radial-gradient(#e5e7eb 0.8px, transparent 0.8px);
            background-size: 24px 24px;
        }

        .poem-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
            max-width: fit-content;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
            .poem-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem 4rem;
            }
        }

        .poem-stanza {
            break-inside: avoid;
            text-align: left;
            white-space: nowrap;
        }

        .poem-stanza p:first-child {
            font-weight: 900;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        /* Tab Styles */
        .tab-btn {
            position: relative;
            overflow: hidden;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: #2563eb;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .tab-btn.active::after {
            width: 100%;
        }

        .tab-btn.active {
            color: #1e40af;
            background: rgba(255, 255, 255, 0.5);
        }

        .tab-content {
            display: none !important;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block !important;
        }

        #tab-quiz.active {
            display: flex !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Success Modal Styles */
        .success-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 200;
            padding: 1rem;
            animation: fadeInModal 0.3s ease-out;
        }

        .success-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success-card {
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .success-modal.active .success-card {
            transform: scale(1);
            opacity: 1;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeInModal {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800 min-h-screen flex flex-col overflow-x-hidden">

    <!-- Header -->
    <header class="sticky top-0 z-50 px-4 py-2">
                                <nav class="container mx-auto glass-card rounded-xl px-5 py-2 flex justify-between items-center shadow-lg">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200 shrink-0">
                    <span class="text-xl font-black">E</span>
                </div>
                <div class="flex flex-col md:flex-row md:items-center md:space-x-6">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl font-black text-blue-700">EduRobot</span>
                        <span class="text-[11px] font-bold px-3 py-1 rounded-full bg-orange-500 text-white shadow-sm shadow-orange-200 tracking-wide whitespace-nowrap">TIẾNG VIỆT 5</span>
                    </div>
                
                    <div class="flex items-center space-x-2 overflow-hidden">
                        <span class="text-[11px] font-black uppercase tracking-widest text-gray-400 whitespace-nowrap">CHỦ ĐIỂM:</span>
                        <span class="text-sm font-black uppercase tracking-wider text-blue-800 truncate max-w-[180px] md:max-w-none">VẺ ĐẸP CUỘC SỐNG</span>
                    </div>
                </div>
            </div>
            <ul class="flex space-x-2 md:space-x-6 text-xs font-bold items-center relative">
                <!-- Home -->
                <li>
                    <a href="index.html" class="flex items-center text-gray-500 hover:text-blue-600 transition-colors py-2">
                        Trang chủ
                    </a>
                </li>
                
                <!-- Lessons Dropdown -->
                <li class="relative group">
                    <button id="top-menu-lesson-btn" class="flex items-center text-gray-500 hover:text-blue-600 transition-colors focus:outline-none py-2">
                        Bài học
                        <svg class="w-4 h-4 ml-1 transition-transform duration-200" id="top-menu-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <!-- Dropdown Content (Hidden by default) -->
                     <div id="top-menu-lessons-dropdown" class="absolute top-full right-[-100px] md:right-auto md:left-1/2 md:-translate-x-1/2 mt-4 w-[320px] bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/50 hidden max-h-[70vh] overflow-y-auto z-[60] p-2">
                        <!-- Content rendered by floating-menu.js -->
                    </div>
                </li>

                <!-- Teacher -->
                <li>
                    <button onclick="openTeacherStats()" class="text-gray-500 hover:text-blue-600 transition-colors py-2">
                        Giáo viên
                    </button>
                </li>
                
                <!-- Contact -->
                <li>
                    <a href="#" class="text-gray-500 hover:text-blue-600 transition-colors py-2">
                        Liên hệ
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Success Modal -->
    <div id="successModal" class="success-modal">
        <div
            class="success-card glass-card p-10 rounded-[40px] shadow-3xl max-w-md w-full text-center relative overflow-hidden border-2 border-white/50">
            <div class="absolute -top-24 -left-24 w-48 h-48 bg-green-500/10 rounded-full blur-3xl"></div>
            <div class="absolute -bottom-24 -right-24 w-48 h-48 bg-blue-500/10 rounded-full blur-3xl"></div>

            <div class="relative">
                <div
                    class="w-24 h-24 bg-gradient-to-tr from-green-500 to-emerald-400 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-green-200 transform rotate-12">
                    <svg class="w-12 h-12 text-white transform -rotate-12" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>

                <h2 class="text-3xl font-black text-slate-800 mb-3 uppercase tracking-tight">Nộp bài thành công!</h2>
                <p class="text-slate-600 font-medium mb-8 leading-relaxed">Tuyệt vời! Kết quả của em đã được lưu lại.
                    Hãy tiếp tục cố gắng nhé!</p>

                <button onclick="closeSuccessModal()"
                    class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 uppercase tracking-wider text-sm">
                    Trở về bài học
                </button>
            </div>
        </div>
    </div>

    <main class="container mx-auto px-4 py-2 flex-grow flex flex-col min-h-0">

        <!-- Tab & Audio Header -->
        <div class="glass-card mb-4 rounded-2xl overflow-hidden flex flex-col md:flex-row items-stretch shadow-lg">
            <div class="flex-1 flex bg-white/40">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-4 text-center font-black text-base text-gray-400 transition-all border-r border-gray-100/50 uppercase tracking-wider">
                    1. Bài học
                </button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-4 text-center font-black text-base text-gray-400 transition-all uppercase tracking-wider">
                    2. Luyện tập
                </button>
            </div>

            <div id="audio-container" class="p-2 md:pr-4 flex items-center bg-blue-600/5 backdrop-blur-md">
                <div
                    class="flex items-center space-x-3 bg-blue-50/50 rounded-full p-1 pr-6 border border-blue-100 shadow-sm transition-all hover:bg-blue-50">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-11 h-11 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-md active:scale-95">
                        <svg id="playIcon" class="w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg>
                    </button>
                    <div class="flex flex-col">
                        <p class="text-[11px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1">
                            NGHE ĐỌC MẪU</p>
                        <p id="audioStatus" class="text-[12px] text-gray-400 font-bold italic leading-none">Đang dừng...
                        </p>
                    </div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/hatgaolangta.wav" type="audio/wav">
                </audio>
            </div>
        </div>

        <div id="tab-lesson" class="tab-content active">
            <div class="flex flex-col lg:flex-row gap-8">

                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%]">
                    <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10">
                        <div
                            class="p-8 md:p-12 bg-paper rounded-2xl shadow-inner border border-gray-50 max-w-4xl mx-auto">
                            <div class="serif-font text-gray-800 text-left">
                                <h1 class="text-3xl font-black mb-2 text-blue-900 text-center">Hạt gạo làng ta</h1>
                                <p class="text-lg italic mb-8 text-gray-600 font-bold text-center">Trần Đăng Khoa</p>

                                <div
                                    class="poem-container py-12 px-10 bg-blue-50/30 rounded-[40px] border border-blue-100/50 shadow-inner max-w-3xl mx-auto">
                                    <div class="poem-stanza">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Có vị phù sa</p>
                                        <p>Của sông Kinh Thầy</p>
                                        <p>Có hương sen thơm</p>
                                        <p>Trong hồ nước đầy</p>
                                        <p>Có lời mẹ hát</p>
                                        <p>Ngọt bùi đắng cay...</p>
                                    </div>

                                    <div class="poem-stanza">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Có bão tháng Bảy</p>
                                        <p>Có mưa tháng Ba</p>
                                        <p>Giọt mồ hôi sa</p>
                                        <p>Những trưa tháng Sáu</p>
                                        <p>Nước như ai nấu</p>
                                        <p>Chết cả cá cờ</p>
                                        <p>Cua ngoi lên bờ</p>
                                        <p>Mẹ em xuống cấy...</p>
                                    </div>

                                    <div class="poem-stanza">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Những năm bom Mỹ</p>
                                        <p>Trút trên mái nhà</p>
                                        <p>Những năm cây súng</p>
                                        <p>Theo người đi xa</p>
                                        <p>Những năm băng đạn</p>
                                        <p>Vàng như lúa đồng</p>
                                        <p>Bát cơm mùa gặt</p>
                                        <p>Thơm hào giao thông...</p>
                                    </div>

                                    <div class="poem-stanza">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Có công các bạn</p>
                                        <p>Sớm nào chống hạn</p>
                                        <p>Vục mẻ miệng gàu</p>
                                        <p>Trưa nào bắt sâu</p>
                                        <p>Lúa cao rát mặt</p>
                                        <p>Chiều nào gánh phân</p>
                                        <p>Quang trành quết đất</p>
                                    </div>

                                    <div class="poem-stanza col-span-1 md:col-span-2 md:mx-auto">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Gửi ra tiền tuyến</p>
                                        <p>Gửi về phương xa</p>
                                        <p>Em vui em hát</p>
                                        <p>Hạt vàng làng ta.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <div class="mb-4 overflow-hidden rounded-2xl shadow-sm relative group max-w-full mx-auto">
                            <img src="C:/Users/Admin/.gemini/antigravity/brain/cbb865b6-a5f3-4a35-b283-692f4fd0abc3/hat_gao_lang_ta_illustration_1768924318312.png"
                                alt="Hạt gạo làng ta"
                                class="w-full h-auto block transform group-hover:scale-105 transition-transform duration-500">
                        </div>

                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span class="w-10 h-10 bg-yellow-400 rounded-xl flex items-center justify-center mr-3">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        1. Hạt gạo kết tinh từ những tinh túy nào?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Chi tiết cho thấy hạt gạo được kết tinh từ những tinh túy của thiên nhiên là:
                                            <b>phù sa của sông Kinh Thầy, hương sen thơm trong hồ nước đầy</b>.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        2. Hạt gạo mang nét đẹp gì của người nông dân?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Bài thơ cho thấy <b>sự cần cù, chịu khó, tinh thần vượt lên thử thách khắc
                                                nghiệt</b> của thiên nhiên và tình yêu lao động của người nông dân.</p>
                                        <p class="mt-2">Hình ảnh: <i>bão tháng Bảy, mưa tháng Ba, giọt mồ hôi sa, nước
                                                như
                                                ai nấu (chết cả cá cờ, cua ngoi lên bờ), mẹ em xuống cấy...</i></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        3. Ý nghĩa "Bát cơm mùa gặt/ Thơm hào giao thông"?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Gợi lên hình ảnh những hạt gạo ấm áp nghĩa tình của hậu phương gửi ra tiền
                                            tuyến.
                                            Hạt gạo còn thơm mùi của những hào giao thông - biểu tượng của tinh thần
                                            kháng
                                            chiến chống Mỹ cứu nước.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        4. Đóng góp của các bạn nhỏ là gì?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Các bạn nhỏ đã tham gia: <b>chống hạn (vục mẻ miệng gàu), bắt sâu (lúa cao
                                                rát
                                                mặt), gánh phân (quang trành quết đất)</b> để cùng người lớn tạo ra hạt
                                            gạo.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        5. Vì sao hạt gạo được gọi là "hạt vàng"?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Hạt gạo được gọi là <b>“hạt vàng”</b> là vì nó vô cùng quý giá. Nó được kết
                                            tinh
                                            từ đất trời và chứa đựng biết bao mồ hôi, công sức lao động vất vả, "một
                                            nắng
                                            hai sương" của con người mới làm ra được.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- Nội dung chính -->
            <div
                class="mt-8 bg-gradient-to-br from-white to-blue-50/50 rounded-[40px] shadow-xl border border-blue-100/50 p-8 md:p-12 overflow-hidden relative group">
                <div
                    class="absolute -right-20 -top-20 w-64 h-64 bg-blue-100/30 rounded-full blur-3xl group-hover:bg-blue-200/30 transition-colors duration-700">
                </div>
                <div
                    class="absolute -left-20 -bottom-20 w-64 h-64 bg-indigo-100/20 rounded-full blur-3xl group-hover:bg-indigo-200/20 transition-colors duration-700">
                </div>

                <div class="flex flex-col lg:flex-row items-center gap-10 relative z-10">
                    <div
                        class="bg-gradient-to-br from-blue-600 to-indigo-700 p-10 rounded-[2.5rem] text-white shadow-2xl shadow-blue-200/50 shrink-0 text-center md:text-left transform hover:rotate-2 transition-transform duration-300">
                        <div
                            class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mb-4 mx-auto md:mx-0">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18 18.246 18.477 16.5 18.477 14.754 18.477 13.168 18.477 12 19.253">
                                </path>
                            </svg>
                        </div>
                        <p class="text-xs font-black uppercase tracking-[0.2em] opacity-80 mb-2">Thông điệp</p>
                        <h3 class="text-3xl font-black uppercase tracking-tight leading-tight">Nội dung<br>chính</h3>
                    </div>

                    <div class="flex-grow space-y-6">
                        <div class="flex items-start gap-4">
                            <div
                                class="mt-1.5 w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center shrink-0">
                                <div class="w-2 h-2 bg-blue-600 rounded-full"></div>
                            </div>
                            <p class="text-xl font-black leading-relaxed text-slate-800">
                                Bài thơ ca ngợi giá trị của hạt gạo được làm nên từ mồ hôi, công sức của con người và
                                những tinh túy của đất trời.
                            </p>
                        </div>

                        <div class="flex items-start gap-4">
                            <div
                                class="mt-1.5 w-6 h-6 bg-emerald-100 rounded-full flex items-center justify-center shrink-0">
                                <div class="w-2 h-2 bg-emerald-600 rounded-full"></div>
                            </div>
                            <p class="text-lg text-slate-600 leading-relaxed font-medium">
                                Đồng thời, tác giả muốn nhắc nhở chúng ta lòng biết ơn đối với người nông dân, trân
                                trọng từng hạt gạo mình ăn mỗi ngày vì đó là "hạt vàng" quý giá.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Tab Content -->
        <div id="tab-quiz" class="tab-content flex-grow flex-col overflow-hidden">
            <div
                class="bg-white rounded-[30px] shadow-sm border border-gray-100 flex-grow flex flex-col overflow-hidden relative max-w-4xl mx-auto w-full">
                <div id="quiz-registration" class="p-4 md:p-8 flex-grow flex flex-col justify-center overflow-auto">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-black text-blue-900 mb-1 leading-tight tracking-tight">THÔNG TIN HỌC
                            SINH</h2>
                        <p class="text-xs text-gray-500 font-bold uppercase tracking-wider">Hạt gạo làng ta</p>
                    </div>
                    <form id="regForm" class="space-y-4 max-w-2xl mx-auto w-full">
                        <div>
                            <label
                                class="block text-[11px] font-black text-gray-400 uppercase tracking-widest mb-2 ml-1">Họ
                                và tên:</label>
                            <input type="text" id="studentName" required
                                class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white rounded-2xl outline-none transition-all font-bold placeholder:text-gray-300 shadow-sm"
                                placeholder="Nhập đầy đủ họ tên của em">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label
                                    class="block text-[11px] font-black text-gray-400 uppercase tracking-widest mb-2 ml-1">Lớp:</label>
                                <div class="relative">
                                    <select id="studentClass" required
                                        class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white rounded-2xl outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                        <option value="">-- Chọn lớp --</option>
                                        <option value="5/1">Lớp 5/1</option>
                                        <option value="5/2">Lớp 5/2</option>
                                        <option value="5/3">Lớp 5/3</option>
                                        <option value="5/4">Lớp 5/4</option>
                                        <option value="5/5">Lớp 5/5</option>
                                    </select>
                                    <div
                                        class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-[11px] font-black text-gray-400 uppercase tracking-widest mb-2 ml-1">Trường:</label>
                                <div class="relative">
                                    <select id="schoolSelect" onchange="checkSchool(this)"
                                        class="w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white rounded-2xl outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                        <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                        <option value="other">Trường khác...</option>
                                    </select>
                                    <div
                                        class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <input type="text" id="otherSchool"
                            class="hidden w-full p-4 bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white rounded-2xl outline-none transition-all font-bold shadow-sm"
                            placeholder="Nhập tên trường của em">

                        <div class="pt-2">
                            <button type="submit"
                                class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-base uppercase tracking-[0.1em]">
                                Bắt đầu làm bài
                            </button>
                        </div>
                    </form>
                </div>

                <div id="quiz-container" class="hidden flex-grow flex-col overflow-hidden">
                    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 bg-gray-50/50">
                        <div class="flex items-center space-x-3">
                            <span id="questionNum"
                                class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black text-xl">1</span>
                            <div>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Câu hỏi</p>
                                <p class="text-xs text-gray-400 font-bold" id="progressText">Đang thực hiện: 1/5</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Thời gian còn lại
                            </p>
                            <p id="timer" class="text-lg font-black text-blue-900">20:00</p>
                        </div>
                    </div>

                    <div id="questionArea" class="flex-grow overflow-auto p-6 flex flex-col justify-center">
                        <h3 id="questionText" class="text-xl md:text-2xl font-black text-gray-800 mb-6 leading-tight">
                        </h3>
                        <div id="optionsArea" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                    </div>

                    <div class="flex justify-between items-center px-6 py-4 border-t border-gray-100 bg-gray-50/50">
                        <span class="text-xs font-bold text-gray-400 italic">* Chọn đáp án đúng nhất</span>
                        <button id="nextBtn" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-3 px-10 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center">
                            Tiếp theo
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="quiz-results"
                    class="hidden p-8 flex-grow flex flex-col items-center justify-center text-center">
                    <div class="mb-8 relative inline-block">
                        <svg class="w-48 h-48 mx-auto" viewBox="0 0 36 36">
                            <path class="text-gray-100" stroke-width="3" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path id="scoreCircle" class="text-green-500" stroke-width="3" stroke-dasharray="0, 100"
                                stroke-linecap="round" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="scoreText" class="text-5xl font-black text-blue-900">0</span>
                            <span class="text-sm font-bold text-gray-400 uppercase">Điểm</span>
                        </div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10" id="resultMsg">Chúc mừng em đã hoàn thành bài luyện tập.</p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="restartQuiz()"
                            class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-4 px-10 rounded-2xl transition-all active:scale-95">Làm
                            lại</button>
                        <button onclick="submitResults(event)"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95">Nộp
                            bài</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Statistics Modal -->
        <div id="statsModal" class="modal">
            <div
                class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col m-4">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-blue-600 text-white">
                    <h2 class="text-2xl font-black">THỐNG KÊ KẾT QUẢ HỌC TẬP</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportToExcel()"
                            class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-xl flex items-center text-sm font-bold shadow-lg transition-all">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 0 01-2-2V5a2 0 012-2h5.586a1 0 01.707.293l5.414 5.414a1 0 01.293.707V19a2 0 01-2 2z">
                                </path>
                            </svg>
                            Xuất Excel
                        </button>
                        <button onclick="closeModal()" class="hover:bg-blue-700 p-2 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-6 overflow-x-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-xs font-bold tracking-widest">
                                <th class="p-4 border-b">STT</th>
                                <th class="p-4 border-b">Họ và tên</th>
                                <th class="p-4 border-b">Lớp</th>
                                <th class="p-4 border-b">Trường</th>
                                <th class="p-4 border-b text-center">Điểm số</th>
                                <th class="p-4 border-b text-center">Thời gian làm</th>
                                <th class="p-4 border-b text-right">Thời gian nộp</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody" class="text-sm"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
        <footer class="py-5 px-4 mt-12 bg-white/30 backdrop-blur-md border-t border-white/50">
        <div class="container mx-auto text-center">
            <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">@ 2026 EduRobot - Hệ thống học
                tập thông minh</p>
            <p class="text-xs font-bold text-blue-600 mt-2">Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.replace('text-gray-400', 'text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.replace('text-green-500', 'text-gray-400');
            }
        }

        audio.onended = () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.replace('text-green-500', 'text-gray-400');
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'text-blue-600'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.getElementById('btn-' + tabId).classList.add('active', 'text-blue-600');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
            restartQuiz();
            switchTab('lesson');
        }

        /* QUIZ ENGINE */
        const allQuestions = [
            { q: "Bài thơ \"Hạt gạo làng ta\" do nhà thơ nào sáng tác?", a: ["Tố Hữu", "Trần Đăng Khoa", "Phạm Tiến Duật", "Nguyễn Duy"], c: 1 },
            { q: "Dòng sông nào đã mang nặng phù sa bồi đắp cho hạt gạo làng ta?", a: ["Sông Hồng", "Sông Đuống", "Sông Cửu Long", "Sông Kinh Thầy"], c: 3 },
            { q: "Ngoài vị phù sa và hương sen thơm, trong khổ thơ đầu, hạt gạo còn chứa đựng điều gì sâu sắc từ người mẹ?", a: ["Lời ru buồn", "Lời mẹ hát ngọt bùi đắng cay", "Những câu chuyện cổ tích", "Tiếng cười vui vẻ"], c: 1 },
            { q: "Những khó khăn của thiên nhiên mà hạt gạo và người nông dân phải trải qua được nhắc đến trong khổ thơ thứ hai là gì?", a: ["Bão tháng Bảy, mưa tháng Ba", "Lũ lụt miền Trung", "Hạn hán kéo dài quanh năm", "Gió rét mùa đông"], c: 0 },
            { q: "Hình ảnh \"Nước như ai nấu / Chết cả cá cờ\" gợi tả điều gì?", a: ["Nước sông bị ô nhiễm", "Người dân đang nấu nước sôi", "Cái nắng nóng khắc nghiệt của trưa tháng Sáu", "Cuộc sống ấm no, sung túc"], c: 2 },
            { q: "Trước cái nắng nóng làm \"cua ngoi lên bờ\", hình ảnh người mẹ hiện lên như thế nào?", a: ["Mẹ nghỉ ngơi dưới bóng cây", "Mẹ em xuống cấy", "Mẹ về nhà tránh nắng", "Mẹ ngồi quạt mát cho con"], c: 1 },
            { q: "Khổ thơ thứ ba nhắc đến bối cảnh lịch sử nào của đất nước?", a: ["Thời kỳ xây dựng chủ nghĩa xã hội", "Những năm kháng chiến chống Pháp", "Những năm bom Mỹ trút trên mái nhà", "Thời kỳ bao cấp"], c: 2 },
            { q: "Trong những năm tháng chiến tranh, hạt gạo đã theo người đi xa như thế nào?", a: ["Trong những năm băng đạn, bát cơm mùa gặt thơm hào giao thông", "Được chở bằng xe tải lớn ra chiến trường", "Được cất giấu kỹ trong kho", "Chỉ dùng để nuôi quân ở hậu phương"], c: 0 },
            { q: "Các bạn nhỏ trong bài thơ đã góp công sức làm ra hạt gạo bằng những việc làm nào?", a: ["Đi học và trông em", "Nấu cơm giúp mẹ", "Chống hạn, vục mẻ miệng gàu, bắt sâu, gánh phân", "Chăn trâu và cắt cỏ"], c: 2 },
            { q: "Câu thơ \"Quang trành quết đất\" nói lên điều gì về sự đóng góp của các bạn nhỏ?", a: ["Các bạn nhỏ rất ham chơi", "Sự vất vả, nỗ lực lao động của các bạn nhỏ dù tuổi còn nhỏ", "Các bạn nhỏ làm hỏng dụng cụ lao động", "Đất ngoài đồng rất dính"], c: 1 },
            { q: "Hạt gạo làm ra được gửi đi đâu?", a: ["Chỉ để ăn trong gia đình", "Xuất khẩu ra nước ngoài", "Gửi ra tiền tuyến, gửi về phương xa", "Đem ra chợ bán"], c: 2 },
            { q: "Vì sao tác giả gọi hạt gạo là \" hạt vàng\"?", a: ["Vì hạt gạo có màu vàng óng", "Vì hạt gạo bán được rất nhiều tiền", "Vì hạt gạo rất quý giá, được làm nên từ mồ hôi công sức của bao người", "Vì lúa chín trên đồng trông như vàng"], c: 2 },
            { q: "Bài thơ ca ngợi phẩm chất tốt đẹp nào của người nông dân?", a: ["Cần cù, chịu khó, không ngại gian khổ và yêu lao động", "Thông minh, sáng tạo trong sản xuất", "Vui vẻ, lạc quan yêu đời", "Dũng cảm trong chiến đấu"], c: 0 },
            { q: "Hình ảnh nào dưới đây thể hiện sự kết tinh của đất trời trong hạt gạo?", a: ["Giọt mồ hôi sa", "Vị phù sa, hương sen thơm", "Mẻ miệng gàu", "Hào giao thông"], c: 1 },
            { q: "Qua bài thơ, tác giả muốn nhắc nhở chúng ta điều gì?", a: ["Phải biết tiết kiệm nước", "Phải chăm chỉ học tập", "Phải biết quý trọng hạt gạo và công sức của những người lao động", "Phải yêu thiên nhiên, đất nước"], c: 2 }
        ];

        let studentData = {}, currentQuizQuestions = [], currentQuestionIdx = 0, score = 0, selectedOption = null;

        function checkSchool() {
            const select = document.getElementById('schoolSelect');
            const other = document.getElementById('otherSchool');
            if (select.value === 'other' || select.value === 'Khác') {
                other.classList.remove('hidden');
                other.required = true;
            } else {
                other.classList.add('hidden');
                other.required = false;
            }
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        const regForm = document.getElementById('regForm');
        regForm.onsubmit = (e) => {
            e.preventDefault();
            studentData = {
                studentName: document.getElementById('studentName').value,
                className: document.getElementById('studentClass').value,
                school: document.getElementById('schoolSelect').value === 'other' ? document.getElementById('otherSchool').value : document.getElementById('schoolSelect').value,
                startTime: new Date().toISOString()
            };
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            startQuiz();
        };

        function startQuiz() {
            currentQuizQuestions = shuffle([...allQuestions]).slice(0, 5);
            currentQuestionIdx = 0; score = 0; showQuestion();
        }

        function showQuestion() {
            const q = currentQuizQuestions[currentQuestionIdx];
            document.getElementById('questionNum').innerText = currentQuestionIdx + 1;
            document.getElementById('progressText').innerText = `Đang thực hiện: ${currentQuestionIdx + 1}/5`;
            document.getElementById('questionText').innerText = q.q;
            const area = document.getElementById('optionsArea'); area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'w-full p-4 text-left border-2 border-gray-100 rounded-2xl font-bold transition-all hover:border-blue-200 hover:bg-blue-50/50 flex items-center group';
                btn.innerHTML = `<span class="w-8 h-8 rounded-full border-2 border-gray-200 flex items-center justify-center mr-4 group-hover:border-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-all text-sm">${String.fromCharCode(65 + i)}</span><span class="flex-1">${opt}</span>`;
                btn.onclick = () => {
                    document.querySelectorAll('#optionsArea button').forEach(b => {
                        b.classList.remove('border-blue-600', 'bg-blue-50');
                        b.querySelector('span').classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                    });
                    btn.classList.add('border-blue-600', 'bg-blue-50');
                    btn.querySelector('span').classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    document.getElementById('nextBtn').disabled = false;
                    selectedOption = i;
                };
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true; selectedOption = null;
        }

        document.getElementById('nextBtn').onclick = () => {
            if (selectedOption === currentQuizQuestions[currentQuestionIdx].c) score += 20;
            currentQuestionIdx++;
            if (currentQuestionIdx < 5) showQuestion(); else showResults();
        };

        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = score;
            const circle = document.getElementById('scoreCircle');
            circle.setAttribute('stroke-dasharray', `${score}, 100`);

            if (score >= 80) {
                document.getElementById('resultTitle').innerText = "Rất tuyệt vời!";
                document.getElementById('resultMsg').innerText = "Em hiểu rất rõ về ý nghĩa bài thơ này.";
            } else if (score >= 60) {
                document.getElementById('resultTitle').innerText = "Làm tốt lắm!";
                document.getElementById('resultMsg').innerText = "Em đã cảm nhận được giá trị hạt gạo và lòng biết ơn.";
            } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên nhé!";
                document.getElementById('resultMsg').innerText = "Em hãy đọc lại bài thơ và thử lại nhé.";
            }
        }

        function restartQuiz() {
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-registration').classList.remove('hidden');
        }

        /* FIREBASE CONFIG */
        const firebaseConfig = {
            apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
            authDomain: "gamhoctap.firebaseapp.com",
            databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gamhoctap",
            storageBucket: "gamhoctap.firebasestorage.app",
            messagingSenderId: "833329613932",
            appId: "1:833329613932:web:0d8574827bcfe50b535c49",
            measurementId: "G-YT1PKCYS67"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function submitResults(e) {
            const btn = e.target;
            btn.disabled = true;
            btn.innerText = "Đang nộp...";
            try {
                await db.collection("diem_tieng_viet_lop5").add({
                    ...studentData,
                    lessonTitle: "Hạt gạo làng ta",
                    score: score,
                    endTime: new Date().toISOString(),
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('successModal').classList.add('active');
            } catch (e) {
                alert("Lỗi khi gửi kết quả: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "Nộp bài";
            }
        }

        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td></tr>';
            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Hạt gạo làng ta").get();
                tbody.innerHTML = '';
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td></tr>';
                    return;
                }
                const results = [];
                snapshot.forEach(doc => results.push(doc.data()));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));

                results.forEach((data, index) => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';
                    let duration = '---';
                    if (data.startTime && data.endTime) {
                        const diffMs = new Date(data.endTime) - new Date(data.startTime);
                        duration = `${Math.floor(diffMs / 60000)} phút ${Math.floor((diffMs % 60000) / 1000)} giây`;
                    }
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50 text-sm bg-white";
                    tr.innerHTML = `
                        <td class="p-4 font-bold text-gray-400">${index + 1}</td>
                        <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
                        <td class="p-4 text-gray-600">${data.className}</td>
                        <td class="p-4 text-gray-600">${data.school}</td>
                        <td class="p-4 text-center">
                            <span class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 50 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">${data.score}/100</span>
                        </td>
                        <td class="p-4 text-center text-gray-600 font-bold">${duration}</td>
                        <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (e) { tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu.</td></tr>'; }
        }

        function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Kết quả", raw: true, cellStyles: true });
            const ws = wb.Sheets["Kết quả"];
            if (ws['!cols']) {
                ws['!cols'][2] = { t: 's' }; // Ensure 'Class' column is text
            } else {
                ws['!cols'] = [{ wch: 10 }, { wch: 25 }, { t: 's', wch: 10 }, { wch: 25 }, { wch: 10 }, { wch: 20 }, { wch: 20 }];
            }
            XLSX.writeFile(wb, "KetQua_HatGaoLangTa.xlsx");
        }

        function openTeacherStats() {
            const pin = prompt("Vui lòng nhập mã PIN bảo mật:");
            if (pin === "dvn") {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else if (pin !== null) {
                alert("Mã PIN không chính xác!");
            }
        }

        function closeModal() {
            document.getElementById('statsModal').classList.remove('active');
        }
    </script>

<script src="js/floating-menu.js"></script>
</body>

</html>
