<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đoàn thuyền đánh cá - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Nunito & Merriweather -->
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            font-size: 19px;
            line-height: 1.8;
        }

        .serif-font p {
            margin-bottom: 1.5rem;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-open .accordion-content {
            max-height: 800px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .bg-paper {
            background-color: #fdfcf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        /* Tab Styles */
        .tab-btn.active {
            border-bottom: 4px solid #1d4ed8;
            color: #1d4ed8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }

        .quiz-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .quiz-option.selected {
            border-color: #2563eb;
            background-color: #dbeafe;
        }

        .correct {
            border-color: #10b981 !important;
            background-color: #ecfdf5 !important;
        }

        .incorrect {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 py-1 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <a href="index.html" class="flex items-center space-x-2">
                    <div
                        class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white text-lg font-bold">
                        E</div>
                    <span class="text-lg font-extrabold text-blue-600 tracking-tight">EduRobot - <span
                            class="text-yellow-500">Tiếng Việt 5</span></span>
                </a>
            </div>

            <ul class="hidden md:flex space-x-6 font-semibold text-gray-600 text-sm">
                <li><a href="index.html" class="hover:text-blue-500 transition-colors">Trang chủ</a></li>
                <li><a href="ve-dep-cuoc-song.html"
                        class="hover:text-blue-500 transition-colors font-bold text-blue-600 border-b-2 border-blue-600">Bài
                        học</a></li>
                <li><a href="#" onclick="openTeacherStats()" class="hover:text-blue-500 transition-colors">Thống kê</a>
                </li>
                <li><a href="#" class="hover:text-blue-500 transition-colors">Liên hệ</a></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-1">

        <!-- Navigation Header -->
        <div class="mb-4">
            <a href="ve-dep-cuoc-song.html?week=22"
                class="inline-flex items-center text-gray-600 hover:text-blue-600 font-bold transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Quay lại Tuần 22
            </a>
        </div>

        <!-- Tab Bar -->
        <div class="flex border-b border-gray-200 mb-3 bg-white rounded-t-2xl overflow-hidden shadow-sm">
            <button onclick="switchTab('lesson')" id="btn-lesson"
                class="tab-btn active flex-1 py-2 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                1. Bài học
            </button>
            <button onclick="switchTab('quiz')" id="btn-quiz"
                class="tab-btn flex-1 py-2 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                2. Luyện tập
            </button>
        </div>

        <div id="tab-lesson" class="tab-content active">
            <!-- Audio Player Section -->
            <div class="flex justify-end mb-4">
                <div
                    class="flex items-center space-x-4 bg-white rounded-full p-1 pr-6 shadow-sm border border-blue-100">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-lg shadow-blue-200">
                        <svg id="playIcon" class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    <div>
                        <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Nghe đọc mẫu</p>
                        <p id="audioStatus" class="text-xs text-gray-400 font-bold italic">Đang dừng...</p>
                    </div>
                    <audio id="lessonAudio">
                        <source src="am_thanh/doanthuyendanhca.mp3" type="audio/mp3">
                    </audio>
                </div>
            </div>
            <div class="flex flex-col lg:flex-row gap-8">

                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%]">
                    <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-8">
                        <div class="mb-4 overflow-hidden rounded-2xl shadow-sm relative group w-full h-auto">
                            <img src="C:/Users/Admin/.gemini/antigravity/brain/cbb865b6-a5f3-4a35-b283-692f4fd0abc3/doan_thuyen_danh_ca_illustration_1768924595318.png"
                                alt="Đoàn thuyền đánh cá" class="w-full h-auto object-cover">
                        </div>
                        <div class="p-6 md:p-10 bg-paper rounded-2xl shadow-inner border border-gray-50">
                            <div class="serif-font text-gray-800 text-center">
                                <h1 class="text-3xl font-black mb-6 text-blue-900 text-center uppercase tracking-tight">
                                    ĐOÀN THUYỀN ĐÁNH CÁ</h1>

                                <p>
                                    Mặt trời xuống biển như hòn lửa<br>
                                    Sóng đã cài then, đêm sập cửa<br>
                                    Đoàn thuyền đánh cá lại ra khơi<br>
                                    Câu hát căng buồm cùng gió khơi.
                                </p>

                                <p>
                                    Hát rằng: cá bạc Biển Đông lặng,<br>
                                    Cá thu Biển Đông như đoàn thoi<br>
                                    Đêm ngày dệt biển muôn luồng sáng<br>
                                    Đến dệt lưới ta, đoàn cá ơi!
                                </p>

                                <p>
                                    Ta hát bài ca gọi cá vào<br>
                                    Gõ thuyền đã có nhịp trăng cao<br>
                                    Biển cho ta cá như lòng mẹ<br>
                                    Nuôi lớn đời ta tự buổi nào.
                                </p>

                                <p>
                                    Sao mờ, kéo lưới kịp trời sáng<br>
                                    Ta kéo xoăn tay chùm cá nặng<br>
                                    Vảy bạc đuôi vàng loé rạng đông,<br>
                                    Lưới xếp buồm lên đón nắng hồng.
                                </p>

                                <p>
                                    Câu hát căng buồm với gió khơi,<br>
                                    Đoàn thuyền chạy đua cùng mặt trời<br>
                                    Mặt trời đội biển nhô màu mới,<br>
                                    Mắt cá huy hoàng muôn dặm phơi.
                                </p>

                                <p class="text-right italic font-bold text-gray-600 mt-6">(Huy Cận)</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span class="w-10 h-10 bg-yellow-400 rounded-xl flex items-center justify-center mr-3">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        1. Khung cảnh thiên nhiên khi đoàn thuyền ra khơi?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Đoàn thuyền ra khơi lúc <b>mặt trời đang lặn, chuyển sang đêm</b>. Tác giả
                                            dùng
                                            hình ảnh so sánh "như hòn lửa" và nhân hóa "sóng cài then, đêm sập cửa" để
                                            miêu
                                            tả biển cả gần gũi như ngôi nhà.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        2. Chi tiết nào thể hiện cảm xúc của người đánh cá?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <ul class="list-disc ml-4 space-y-1">
                                            <li><b>Niềm vui lao động:</b> Tiếng hát căng buồm, xua tan mệt nhọc ("Ta hát
                                                bài ca gọi cá vào").</li>
                                            <li><b>Lòng biết ơn:</b> Ví biển như "lòng mẹ" nuôi lớn đời ta tự bao đời.
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        3. Ý nghĩa những hình ảnh ở khổ thơ cuối?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Hình ảnh triệu mắt cá lấp lánh và đoàn thuyền <b>"chạy đua cùng mặt trời"</b>
                                            thể
                                            hiện sự hòa quyện giữa vẻ đẹp thiên nhiên rực rỡ và tư thế lao động khỏe
                                            khoắn,
                                            lạc quan của người ngư dân.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        4. Bài thơ giúp em cảm nhận vẻ đẹp gì của cuộc sống?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Bài thơ ca ngợi vẻ đẹp của những <b>người lao động hăng say, yêu đời</b> và
                                            sự
                                            giàu có, huy hoàng của biển cả quê hương.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- Nội dung chính -->
            <div
                class="mt-2 bg-white rounded-[30px] shadow-sm border border-blue-100 p-6 md:p-8 overflow-hidden relative">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-blue-50 rounded-full opacity-50"></div>
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-2 gap-4">
                    <div
                        class="bg-blue-600 p-8 rounded-3xl text-white shadow-xl shadow-blue-200 shrink-0 text-center md:text-left">
                        <p class="text-xs font-bold uppercase tracking-widest opacity-80 mb-2">Thông điệp</p>
                        <h3 class="text-2xl font-black uppercase tracking-wider">Nội dung chính</h3>
                    </div>
                    <div class="flex-grow">
                        <p class="text-lg font-semibold leading-relaxed text-blue-900 mb-2">
                            Niềm vui lao động và tình yêu biển cả quê hương.
                        </p>
                        <p class="text-gray-600 leading-relaxed text-base">
                            Bài thơ thể hiện niềm vui của người lao động hòa với cảm xúc trước khung cảnh huy hoàng của
                            biển
                            cả, xua tan những gian lao, vất vả. Qua đó ca ngợi vẻ đẹp của những con người yêu lao động
                            và
                            yêu thiên nhiên đất nước.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Luyện tập Tab -->
        <div id="tab-quiz" class="tab-content">
            <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10 max-w-4xl mx-auto">
                <!-- Registration Form -->
                <div id="quiz-registration">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-black text-blue-900 mb-2">THÔNG TIN HỌC SINH</h2>
                        <p class="text-gray-500">Vui lòng nhập thông tin để bắt đầu bài luyện tập</p>
                    </div>
                    <form id="regForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Họ và tên:</label>
                            <input type="text" id="studentName" required
                                class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                placeholder="Nhập đầy đủ họ tên của em">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Lớp:</label>
                                <select id="studentClass" required
                                    class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                    <option value="">-- Chọn lớp --</option>
                                    <option value="5/1">Lớp 5/1</option>
                                    <option value="5/2">Lớp 5/2</option>
                                    <option value="5/3">Lớp 5/3</option>
                                    <option value="5/4">Lớp 5/4</option>
                                    <option value="5/5">Lớp 5/5</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Trường:</label>
                                <div class="relative">
                                    <select id="schoolSelect" onchange="checkSchool(this)"
                                        class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                        <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                        <option value="other">Trường khác...</option>
                                    </select>
                                    <input type="text" id="otherSchool"
                                        class="hidden mt-4 w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                        placeholder="Nhập tên trường của em">
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-lg uppercase tracking-wider">
                            Bắt đầu làm bài
                        </button>
                    </form>
                </div>

                <!-- Quiz Questions -->
                <div id="quiz-container" class="hidden">
                    <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <span id="questionNum"
                                class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black text-xl">1</span>
                            <div>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Câu hỏi</p>
                                <p class="text-xs text-gray-400 font-bold" id="progressText">Đang thực hiện: 1/15</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Thời gian còn
                                lại</p>
                            <p id="timer" class="text-lg font-black text-blue-900">20:00</p>
                        </div>
                    </div>

                    <div id="questionArea" class="mb-8">
                        <h3 id="questionText" class="text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h3>
                        <div id="optionsArea" class="grid grid-cols-1 gap-4">
                            <!-- Options will be injected here -->
                        </div>
                    </div>

                    <div class="flex justify-end pt-6 border-t border-gray-100">
                        <button id="nextBtn" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center">
                            Tiếp theo
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="quiz-results" class="hidden text-center py-12">
                    <div class="mb-8 relative inline-block">
                        <svg class="w-48 h-48 mx-auto" viewBox="0 0 36 36">
                            <path class="text-gray-100" stroke-width="3" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path id="scoreCircle" class="text-green-500" stroke-width="3" stroke-dasharray="0, 100"
                                stroke-linecap="round" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="scoreText" class="text-5xl font-black text-blue-900">0</span>
                            <span class="text-sm font-bold text-gray-400 uppercase">Điểm</span>
                        </div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10" id="resultMsg">Chúc mừng em đã hoàn thành bài luyện tập.</p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="restartQuiz()"
                            class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-4 px-10 rounded-2xl transition-all active:scale-95">
                            Làm lại
                        </button>
                        <button onclick="submitResults(event)"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95">Nộp
                            bài</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Statistics Modal -->
        <div id="statsModal" class="modal">
            <div
                class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col m-4">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-blue-600 text-white">
                    <h2 class="text-2xl font-black">THỐNG KÊ KẾT QUẢ HỌC TẬP</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportToExcel()"
                            class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-xl flex items-center text-sm font-bold shadow-lg transition-all">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            Xuất Excel
                        </button>
                        <button onclick="closeModal()" class="hover:bg-blue-700 p-2 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-6 overflow-x-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-xs font-bold tracking-widest">
                                <th class="p-4 border-b">STT</th>
                                <th class="p-4 border-b">Họ và tên</th>
                                <th class="p-4 border-b">Lớp</th>
                                <th class="p-4 border-b">Trường</th>
                                <th class="p-4 border-b text-center">Điểm số</th>
                                <th class="p-4 border-b text-center">Thời gian làm</th>
                                <th class="p-4 border-b text-right">Thời gian nộp</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody" class="text-sm">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-zinc-900 text-zinc-400 py-3 px-4 mt-2">
        <div class="container mx-auto text-center text-sm">
            <p>@ 2026 EduRobot - Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => {
                el.classList.remove('accordion-open');
            });
            if (!isOpen) {
                item.classList.add('accordion-open');
            }
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.remove('text-gray-400');
                audioStatus.classList.add('text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.remove('text-green-500');
                audioStatus.classList.add('text-gray-400');
            }
        }

        audio.onended = function () {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.remove('text-green-500');
            audioStatus.classList.add('text-gray-400');
        };

        /* FIREBASE CONFIG */
        const firebaseConfig = {
            apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
            authDomain: "gamhoctap.firebaseapp.com",
            databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gamhoctap",
            storageBucket: "gamhoctap.firebasestorage.app",
            messagingSenderId: "833329613932",
            appId: "1:833329613932:web:0d8574827bcfe50b535c49",
            measurementId: "G-YT1PKCYS67"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /* TEACHER STATS LOGIC */
        function openTeacherStats() {
            const pin = prompt("Vui lòng nhập mã PIN giáo viên:");
            if (pin === 'dvn') {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else if (pin !== null) {
                alert("Mã PIN không chính xác!");
            }
        }

        function closeModal() {
            document.getElementById('statsModal').classList.remove('active');
        }

        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td></tr>';

            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5")
                    .where("lessonTitle", "==", "Đoàn thuyền đánh cá")
                    .get();

                tbody.innerHTML = '';
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td></tr>';
                    return;
                }

                // Sort in memory to avoid needing Firestore index
                const results = [];
                snapshot.forEach(doc => results.push(doc.data()));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));

                results.forEach((data, index) => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';

                    // Calculate duration
                    let duration = '---';
                    if (data.startTime && data.endTime) {
                        const start = new Date(data.startTime);
                        const end = new Date(data.endTime);
                        const diffMs = end - start;
                        const mins = Math.floor(diffMs / 60000);
                        const secs = Math.floor((diffMs % 60000) / 1000);
                        duration = `${mins} phút ${secs} giây`;
                    }

                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50";
                    tr.innerHTML = `
                        <td class="p-4 font-bold text-gray-400">${index + 1}</td>
                        <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
                        <td class="p-4 text-gray-600 font-bold">${data.className}</td>
                        <td class="p-4 text-gray-600">${data.school}</td>
                        <td class="p-4 text-center">
                            <span class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 50 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">
                                ${data.score}/100
                            </span>
                        </td>
                        <td class="p-4 text-center text-gray-600 font-bold">${duration}</td>
                        <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error("Error loading stats:", error);
                tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu. Vui lòng thử lại.</td></tr>';
            }
        }

        function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Kết quả", raw: true });
            XLSX.writeFile(wb, "ThongKe_GiaoVien_EduRobot.xlsx");
        }

        /* TAB LOGIC */
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'text-blue-600'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.getElementById('btn-' + tabId).classList.add('active', 'text-blue-600');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        /* QUIZ DATA */
        const quizData = [
            {
                question: "Tác giả của bài thơ \"Đoàn thuyền đánh cá\" là ai?",
                options: ["Tố Hữu", "Trần Đăng Khoa", "Huy Cận", "Xuân Diệu"],
                answer: 2
            },
            {
                question: "Đoàn thuyền đánh cá ra khơi vào thời điểm nào trong ngày?",
                options: ["Bình minh", "Giữa trưa", "Hoàng hôn (lúc mặt trời lặn)", "Nửa đêm"],
                answer: 2
            },
            {
                question: "Trong khổ thơ đầu, hình ảnh \"Mặt trời xuống biển\" được so sánh với sự vật gì?",
                options: ["Quả cầu lửa", "Hòn lửa", "Hòn than", "Ngọn đèn"],
                answer: 1
            },
            {
                question: "Biện pháp nghệ thuật nào được sử dụng trong câu thơ \"Sóng đã cài then, đêm sập cửa\"?",
                options: ["So sánh", "Nhân hóa", "Điệp từ", "Đảo ngữ"],
                answer: 1
            },
            {
                question: "Cùng với gió khơi, âm thanh nào đã cùng đoàn thuyền căng buồm ra khơi?",
                options: ["Tiếng sóng vỗ", "Tiếng còi tàu", "Câu hát", "Tiếng gõ thuyền"],
                answer: 2
            },
            {
                question: "Trong câu \"Cá thu Biển Đông như đoàn thoi\", tác giả dùng hình ảnh \"đoàn thoi\" để tả loài cá nào?",
                options: ["Cá bạc", "Cá nục", "Cá chim", "Cá thu"],
                answer: 3
            },
            {
                question: "Những người ngư dân đã \"hát bài ca gọi cá vào\" với niềm tin gì?",
                options: ["Để xua đuổi các loài thú dữ", "Xua tan mệt nhọc và mong muốn thu hoạch bội thu", "Để thông báo vị trí cho các thuyền khác", "Để ru ngủ biển cả"],
                answer: 1
            },
            {
                question: "Hình ảnh \"Biển cho ta cá như lòng mẹ\" thể hiện tình cảm gì của người ngư dân?",
                options: ["Sự sợ hãi trước thiên nhiên", "Sự chinh phục thiên nhiên", "Lòng biết ơn và sự gắn bó với biển cả", "Sự thờ ơ với biển cả"],
                answer: 2
            },
            {
                question: "Âm thanh nào đóng vai trò giữ nhịp cho bài ca gọi cá vào?",
                options: ["Tiếng sóng vỗ bờ", "Tiếng gió thổi", "Nhịp trăng cao gõ thuyền", "Tiếng mái chèo khua nước"],
                answer: 2
            },
            {
                question: "Đoàn thuyền đánh cá trở về vào thời điểm nào?",
                options: ["Khi mặt trời đứng bóng", "Khi trăng lên cao", "Khi sao mờ, trời sắp sáng (rạng đông)", "Khi màn đêm buông xuống"],
                answer: 2
            },
            {
                question: "Hình ảnh \"Ta kéo xoăn tay chùm cá nặng\" gợi tả điều gì?",
                options: ["Người dân chài đang tập thể dục", "Vẻ đẹp khỏe khoắn của người lao động và mẻ lưới bội thu", "Sự vất vả, đau đớn của người dân chài", "Sự vội vã vì sợ bão"],
                answer: 1
            },
            {
                question: "Màu sắc nào được nhắc đến khi mô tả vẻ đẹp của cá và cảnh rạng đông trong khổ 4?",
                options: ["Vảy bạc", "Đuôi vàng", "Nắng hồng", "Tất cả các màu trên"],
                answer: 3
            },
            {
                question: "Hình ảnh \"Đoàn thuyền chạy đua cùng mặt trời\" ở khổ cuối có ý nghĩa gì?",
                options: ["Thuyền cố gắng chạy trốn ánh nắng gay gắt", "Tư thế hào hùng, khẩn trương của người lao động tranh thủ thời gian với thiên nhiên", "Cuộc thi thể thao trên biển", "Thuyền bị mặt trời đuổi theo"],
                answer: 1
            },
            {
                question: "Theo nội dung bài đọc, bài thơ ca ngợi vẻ đẹp nào?",
                options: ["Vẻ đẹp của những con thuyền hiện đại", "Vẻ đẹp của con người yêu lao động và sự huy hoàng của biển cả", "Vẻ đẹp hoang sơ và đáng sợ của biển đêm", "Vẻ đẹp của bầu trời đầy sao"],
                answer: 1
            },
            {
                question: "Cảm hứng chủ đạo xuyên suốt bài thơ là gì?",
                options: ["Nỗi buồn man mác của người đi biển", "Sự lo lắng trước những hiểm nguy của biển cả", "Niềm vui, sự lạc quan và hăng say trong lao động", "Sự cô đơn giữa biển trời mênh mông"],
                answer: 2
            }
        ];

        /* QUIZ LOGIC */
        let currentQuestion = 0;
        let score = 0;
        let selectedOption = null;
        let timeLeft = 1200; // 20 minutes
        let timerInterval;
        let userData = {};

        function startTimer() {
            userData.startTime = new Date().toISOString();
            timerInterval = setInterval(() => {
                timeLeft--;
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                document.getElementById('timer').innerText =
                    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showResults();
                }
            }, 1000);
        }

        const regForm = document.getElementById('regForm');
        regForm.onsubmit = (e) => {
            e.preventDefault();
            const schoolSelect = document.getElementById('schoolSelect');
            userData = {
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                school: schoolSelect.value === 'other' ? document.getElementById('otherSchool').value : schoolSelect.value
            };
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            loadQuestion();
            startTimer();
        };

        function checkSchool(select) {
            const otherSchool = document.getElementById('otherSchool');
            if (select.value === 'other') {
                otherSchool.classList.remove('hidden');
                otherSchool.required = true;
            } else {
                otherSchool.classList.add('hidden');
                otherSchool.required = false;
            }
        }

        function loadQuestion() {
            const q = quizData[currentQuestion];
            document.getElementById('questionNum').innerText = currentQuestion + 1;
            document.getElementById('progressText').innerText = `Đang thực hiện: ${currentQuestion + 1}/${quizData.length}`;
            document.getElementById('questionText').innerText = q.question;

            const optionsArea = document.getElementById('optionsArea');
            optionsArea.innerHTML = '';

            q.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option w-full p-4 rounded-2xl text-left font-bold transition-all flex items-center';
                btn.innerHTML = `
                    <span class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 text-gray-500">${String.fromCharCode(65 + index)}</span>
                    <span class="flex-1">${opt}</span>
                `;
                btn.onclick = () => selectOption(index, btn);
                optionsArea.appendChild(btn);
            });

            document.getElementById('nextBtn').disabled = true;
            selectedOption = null;
        }

        function selectOption(index, btn) {
            selectedOption = index;
            document.querySelectorAll('.quiz-option').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById('nextBtn').disabled = false;
        }

        document.getElementById('nextBtn').onclick = () => {
            if (selectedOption === quizData[currentQuestion].answer) {
                score += (100 / quizData.length);
            }

            currentQuestion++;
            if (currentQuestion < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        };

        function showResults() {
            clearInterval(timerInterval);
            userData.endTime = new Date().toISOString();
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');

            const finalScore = Math.round(score);
            document.getElementById('scoreText').innerText = finalScore;
            document.getElementById('scoreCircle').style.strokeDasharray = `${finalScore}, 100`;

            if (finalScore >= 80) {
                document.getElementById('resultTitle').innerText = "Xuất sắc!";
                document.getElementById('resultMsg').innerText = "Em đã hiểu bài rất tốt, chúc mừng em!";
            } else if (finalScore >= 50) {
                document.getElementById('resultTitle').innerText = "Làm tốt lắm!";
                document.getElementById('resultMsg').innerText = "Em đã nắm được nội dung bài đọc rồi.";
            } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên!";
                document.getElementById('resultMsg').innerText = "Em hãy đọc lại bài và thử lại nhé.";
            }
        }

        async function submitResults(e) {
            try {
                const finalScore = Math.round(score);
                await db.collection("diem_tieng_viet_lop5").add({
                    studentName: userData.studentName,
                    className: userData.studentClass,
                    school: userData.school,
                    score: finalScore,
                    lessonTitle: "Đoàn thuyền đánh cá",
                    startTime: userData.startTime,
                    endTime: userData.endTime,
                    submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert(`Chúc mừng em ${userData.studentName}!\nKết quả của em đã được gửi thành công đến thầy cô.\nĐiểm: ${finalScore}/100`);
                // Reset Quiz UI for next time
                document.getElementById('quiz-results').classList.add('hidden');
                document.getElementById('quiz-registration').classList.remove('hidden');
                switchTab('lesson');
            } catch (error) {
                console.error("Error submitting results:", error);
                alert("Có lỗi khi nộp bài. Em hãy thử lại nhé.");
            }
        }

        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            timeLeft = 1200;
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-registration').classList.remove('hidden');
            document.getElementById('regForm').reset();
            document.getElementById('otherSchool').classList.add('hidden');
        }
    </script>
</body>

</html>