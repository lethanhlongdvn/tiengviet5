<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thư của bố - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- SheetJS for Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --accent: #f59e0b;
            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        .hidden {
            display: none !important;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
        }

        .bg-paper {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .tab-btn.active {
            color: var(--primary);
            background: white;
            box-shadow: inset 0 -3px 0 var(--primary);
        }

        .tab-content {
            display: none !important;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content.active {
            display: block !important;
        }

        #tab-quiz.active {
            display: flex !important;
        }

        /* Compact Quiz styles */
        #quiz-container {
            height: calc(100vh - 180px);
            /* Adjust based on header/footer */
            max-height: 600px;
        }

        .option-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1.5px solid #e2e8f0;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateX(4px);
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Accordion Custom */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .accordion-open .accordion-content {
            max-height: 500px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: 1rem;
        }

        .modal.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .reading-content p {
            text-indent: 2rem;
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        /* Success Modal Styles */
        .success-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 200;
            padding: 1rem;
            animation: fadeIn 0.3s ease-out;
        }

        .success-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success-card {
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .success-modal.active .success-card {
            transform: scale(1);
            opacity: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="sticky top-0 z-50 px-4 py-2">
        <nav class="container mx-auto glass-card rounded-xl px-5 py-2 flex justify-between items-center shadow-lg">
            <div class="flex items-center space-x-3">
                <div
                    class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-lg flex items-center justify-center text-white shadow-xl transform hover:rotate-6 transition-transform">
                    <span class="text-lg font-black">E</span>
                </div>
                <div class="flex flex-col md:flex-row md:items-center md:space-x-4">
                    <div class="flex items-center space-x-2">
                        <span
                            class="text-base font-black bg-gradient-to-r from-blue-600 to-indigo-800 bg-clip-text text-transparent hidden md:block">EduRobot</span>
                        <span
                            class="text-[11px] font-black px-2.5 py-0.5 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 text-white shadow-sm shadow-amber-200 animate-pulse">TIẾNG
                            VIỆT 5</span>
                    </div>
                    <div class="h-4 w-px bg-gray-200 hidden md:block"></div>
                    <div class="flex items-center space-x-2 overflow-hidden">
                        <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Chủ điểm:</span>
                        <span
                            class="text-sm font-black uppercase tracking-wider text-blue-800 truncate max-w-[180px] md:max-w-none">Vẻ
                            Đẹp Cuộc Sống</span>
                    </div>
                </div>
            </div>
            <ul class="flex space-x-6 text-xs font-bold items-center">
                <li><a href="cd5-ve-dep-cuoc-song.html"
                        class="flex items-center text-blue-600 hover:text-blue-700 transition-colors">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Quay lại
                    </a></li>
                <li class="border-l border-gray-200 pl-6"><a href="index.html"
                        class="text-gray-500 hover:text-blue-600 transition-colors">Trang chủ</a></li>
                <li><button onclick="openTeacherStats()"
                        class="bg-blue-50 text-blue-600 px-3 py-1.5 rounded-lg hover:bg-blue-100 transition-all">Giáo
                        viên</button></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-2">

        <!-- Tab & Audio Header -->
        <div class="glass-card mb-4 rounded-2xl overflow-hidden flex flex-col md:flex-row items-stretch shadow-lg">
            <div class="flex-1 flex bg-white/40">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-4 text-center font-black text-base text-gray-400 transition-all border-r border-gray-100/50 uppercase tracking-wider">
                    1. Bài học
                </button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-4 text-center font-black text-base text-gray-400 transition-all uppercase tracking-wider">
                    2. Luyện tập
                </button>
            </div>

            <div id="audio-container"
                class="p-2 md:px-4 flex items-center bg-blue-50/20 border-t md:border-t-0 md:border-l border-gray-100/50">
                <div
                    class="flex items-center space-x-3 bg-white/60 backdrop-blur-md rounded-xl p-1.5 pr-4 border border-white shadow-inner">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-9 h-9 bg-gradient-to-br from-blue-500 to-blue-700 rounded-lg flex items-center justify-center text-white hover:scale-105 active:scale-95 transition-all shadow-md shadow-blue-200">
                        <svg id="playIcon" class="w-5 h-5 ml-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg>
                    </button>
                    <div class="flex flex-col">
                        <span
                            class="text-[9px] font-black text-blue-600 uppercase tracking-widest leading-none mb-0.5 whitespace-nowrap">ĐỌC
                            MẪU</span>
                        <span id="audioStatus"
                            class="text-[10px] text-gray-400 font-bold italic leading-none whitespace-nowrap">Đang
                            dừng...</span>
                    </div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/thuguibo.wav" type="audio/wav">
                </audio>
            </div>
        </div>

        <!-- TAB 1: BÀI HỌC -->
        <div id="tab-lesson" class="tab-content active">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%]">
                    <div class="glass-card rounded-[40px] p-6 md:p-10 shadow-2xl">
                        <div
                            class="bg-paper rounded-[32px] p-8 md:p-12 shadow-inner border border-white/50 relative overflow-hidden">
                            <!-- Trang trí góc -->
                            <div class="absolute -top-10 -left-10 w-32 h-32 bg-blue-100/30 rounded-full blur-3xl"></div>
                            <div class="absolute -bottom-10 -right-10 w-32 h-32 bg-amber-100/30 rounded-full blur-3xl">
                            </div>

                            <h1
                                class="text-4xl font-black mb-12 text-blue-950 text-center uppercase tracking-tighter leading-tight relative">
                                <span
                                    class="bg-blue-600 w-12 h-1.5 absolute -bottom-4 left-1/2 -translate-x-1/2 rounded-full"></span>
                                Thư của bố
                            </h1>

                            <div
                                class="serif-font text-gray-800 text-xl leading-relaxed relative text-left max-w-4xl mx-auto px-4 md:px-10">
                                <div class="space-y-8">
                                    <div>
                                        Bố đi tiến ra đảo<br>
                                        Chiếc thư về rất nhanh<br>
                                        Chắc là nhờ gió biển<br>
                                        Thổi mái chèo cho thuyền.
                                    </div>
                                    <div>
                                        Thư bố thêm mùi nắng<br>
                                        Của đảo xa vợi vợi<br>
                                        Thư bố thêm mùi muối<br>
                                        Của biển cả mặn mòi.
                                    </div>
                                    <div>
                                        Bố gửi cho con cả<br>
                                        Cái nghìn dặm khơi xa<br>
                                        Kèm theo một con sò<br>
                                        Và viên đá cuội lạ.
                                    </div>
                                    <div>
                                        Bố kể nơi bố ở<br>
                                        Có rất nhiều loài chim<br>
                                        Hè về, tiếng lích chích<br>
                                        In lên nền trời im.
                                    </div>
                                    <div>
                                        Khổ thơ cuối bài<br>
                                        Bố nhắc con ở nhà<br>
                                        Chăm ngoan và học giỏi<br>
                                        Đợi ngày bố về nha.
                                    </div>
                                </div>
                                <p class="text-right italic font-bold text-gray-600 mt-12 text-base">---</p>
                            </div>
                        </div>

                        <!-- Nội dung chính -->
                        <div
                            class="mt-8 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[32px] p-8 text-white relative overflow-hidden shadow-xl transform hover:scale-[1.01] transition-transform">
                            <div
                                class="absolute right-0 top-0 w-64 h-64 bg-white/10 rounded-full -translate-y-1/2 translate-x-1/2 blur-2xl">
                            </div>
                            <div class="flex flex-col md:flex-row items-center gap-8 relative z-10">
                                <div
                                    class="bg-white/20 backdrop-blur-md p-6 rounded-2xl border border-white/30 shadow-lg shrink-0 text-center min-w-[160px]">
                                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-100 mb-1">
                                        Thông điệp</p>
                                    <h3 class="text-2xl font-black uppercase tracking-tight">Ý NGHĨA</h3>
                                </div>
                                <div class="flex-grow">
                                    <p class="text-lg font-bold leading-relaxed text-blue-50">
                                        Bài thơ là lời của người bố đang đi công tác ở đảo xa gửi về cho con, thể hiện
                                        tình yêu thương sâu nặng, nỗi nhớ da diết và niềm tin tưởng, hy vọng vào con ở
                                        nơi quê nhà.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="glass-card rounded-[40px] p-6 sticky top-28 shadow-xl border-amber-100/50">
                        <!-- Ảnh minh họa -->
                        <div class="mb-6 -mt-2">
                            <img src="hinh_anh/thuguibo_minhhoa.png" alt="Minh họa"
                                class="w-full h-auto rounded-3xl object-contain drop-shadow-xl transform hover:scale-105 transition-transform duration-500">
                        </div>

                        <div class="flex items-center space-x-4 mb-8">
                            <div
                                class="w-12 h-12 bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg shadow-amber-200">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </div>
                            <h2 class="text-2xl font-black text-gray-800 tracking-tight">Tìm hiểu bài</h2>
                        </div>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">1.
                                        Chiếc thư của bố có những đặc điểm gì?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                            <span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span>
                                        </div>
                                        <p class="font-medium">Thế thư của bố gửi về rất nhanh, chắc nhờ "gió biển thổi
                                            mái chèo". Trong thư không chỉ có lời lẽ mà còn có cả "mùi nắng", "mùi muối"
                                            của biển đảo xa xôi.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">2.
                                        Quà của bố gửi về cho con có những gì?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                            <span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span>
                                        </div>
                                        <p class="font-medium">Bố gửi về cho con cả "nghìn dặm khơi xa", kèm theo một
                                            con sò và viên đá cuội lạ.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">3.
                                        Vì sao bố lại gửi những món quà đó cho con?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                            <span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span>
                                        </div>
                                        <p class="font-medium">Bố muốn con cảm nhận được vẻ đẹp của biển đảo quê hương,
                                            nơi bố đang ngày đêm canh giữ, đồng thời gửi gắm tình yêu thương bao la từ
                                            nơi xa gửi về.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">4.
                                        Tình cảm của bố dành cho con thể hiện qua những từ ngữ, hình ảnh nào?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                            <span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span>
                                        </div>
                                        <p class="font-medium">Tình cảm thể hiện qua việc bố viết thư gửi về rất nhanh,
                                            bố gửi những món quà đặc biệt của biển cả, bố kể về nơi bố ở với muôn loài
                                            chim và quan trọng nhất là những lời dặn dò con chăm ngoan, học giỏi.</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white/50 rounded-[24px] border border-white shadow-sm transition-all hover:shadow-md overflow-hidden">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors">5.
                                        Khổ thơ cuối bài muốn nói điều gì?</span>
                                    <div
                                        class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center group-hover:bg-blue-50 transition-colors">
                                        <svg class="w-4 h-4 text-gray-400 group-hover:text-blue-500 transition-transform"
                                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-6 pb-6 text-gray-600 leading-relaxed border-t border-white/50 pt-4 bg-blue-50/30">
                                        <div class="flex items-center space-x-2 mb-2">
                                            <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                                            <span
                                                class="text-[11px] font-black uppercase tracking-widest text-green-600">Gợi
                                                ý trả lời</span>
                                        </div>
                                        <p class="font-medium">Khổ thơ cuối khẳng định tình yêu thương vô bờ bến và sự
                                            hy vọng, tin tưởng của bố dành cho con. Bố mong con ở nhà ngoan ngoãn, học
                                            tốt để làm bố yên tâm công tác.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- TAB 2: LUYỆN TẬP -->
        <div id="tab-quiz" class="tab-content">
            <div
                class="max-w-4xl mx-auto glass-card rounded-[40px] shadow-2xl overflow-hidden flex flex-col min-h-[500px]">
                <!-- Registration -->
                <div id="quiz-registration" class="p-4 md:p-8 flex-grow flex flex-col justify-center overflow-auto">
                    <div class="text-center mb-6">
                        <div
                            class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl shadow-blue-200 mx-auto transform -rotate-3">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                </path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-black text-gray-800 mb-1 tracking-tight">Đăng ký luyện tập</h2>
                        <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Thư của bố</p>
                    </div>

                    <form onsubmit="startQuiz(event)" class="w-full max-w-sm mx-auto space-y-4">
                        <div class="relative group">
                            <input type="text" id="studentName" required placeholder="Họ và tên của em"
                                class="w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold placeholder:text-gray-300 shadow-sm">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <select id="studentClass" required
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                <option value="">Chọn Lớp</option>
                                <option value="5/1">5/1</option>
                                <option value="5/2">5/2</option>
                                <option value="5/3">5/3</option>
                                <option value="5/4">5/4</option>
                                <option value="5/5">5/5</option>
                            </select>

                            <select id="schoolSelect" required onchange="checkSchool()"
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm appearance-none cursor-pointer">
                                <option value="Tiểu học Đỗ Văn Nại">TH Đỗ Văn Nại</option>
                                <option value="Khác">Trường khác...</option>
                            </select>
                        </div>

                        <input type="text" id="otherSchool" placeholder="Tên trường của em"
                            class="hidden w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white transition-all font-bold shadow-sm">

                        <button type="submit"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-base uppercase tracking-wider">
                            Bắt đầu luyện tập
                        </button>
                    </form>
                </div>

                <!-- Quiz Engine - COMPACT VERSION -->
                <div id="quiz-container" class="hidden flex-grow flex flex-col">
                    <div class="bg-blue-600/5 px-6 py-4 flex justify-between items-center border-b border-blue-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black mr-4 shadow-lg shadow-blue-200"
                                id="questionNum">1</div>
                            <div class="flex flex-col">
                                <span
                                    class="text-[10px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1"
                                    id="progressText">CÂU TRẮC NGHIỆM: 1/5</span>
                                <span class="text-xs text-gray-400 font-bold leading-none">Thư của bố</span>
                            </div>
                        </div>
                    </div>

                    <div class="p-6 flex-grow flex flex-col justify-center overflow-auto">
                        <h3 class="text-xl md:text-2xl font-black text-gray-800 mb-6 leading-tight transition-all"
                            id="questionText">Nội dung câu hỏi?</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="optionsArea">
                            <!-- Options rendered by JS -->
                        </div>
                    </div>

                    <div class="px-6 py-4 border-t border-gray-50 flex justify-between items-center bg-gray-50/50">
                        <span class="text-xs font-bold text-gray-400 italic">* Chọn đáp án đúng nhất</span>
                        <button id="nextBtn" disabled
                            class="bg-blue-600 disabled:opacity-30 hover:bg-blue-700 text-white font-black py-3 px-10 rounded-2xl shadow-lg shadow-blue-100 transition-all active:scale-95 uppercase text-sm tracking-widest">
                            Câu tiếp theo
                        </button>
                    </div>
                </div>

                <!-- Results -->
                <div id="quiz-results"
                    class="hidden p-8 flex-grow flex flex-col items-center justify-center text-center">
                    <div class="relative w-40 h-40 mb-8">
                        <svg class="w-full h-full transform -rotate-90">
                            <circle cx="80" cy="80" r="74" stroke="currentColor" stroke-width="12" fill="transparent"
                                class="text-gray-100" />
                            <circle id="scoreCircle" cx="80" cy="80" r="74" stroke="url(#scoreGrad)" stroke-width="12"
                                fill="transparent" class="transition-all duration-1000 ease-out"
                                stroke-dasharray="0, 465" stroke-linecap="round" />
                            <defs>
                                <linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#3b82f6" />
                                    <stop offset="100%" stop-color="#818cf8" />
                                </linearGradient>
                            </defs>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-black text-gray-800" id="scoreText">0</span>
                            <span class="text-[10px] text-gray-400 font-black uppercase tracking-[0.2em] mt-1">Điểm
                                số</span>
                        </div>
                    </div>

                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành bài tập!</h2>
                    <p class="text-gray-500 mb-10 max-w-sm font-bold" id="resultMsg">Em đã nỗ lực hết mình rồi đấy!</p>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md">
                        <button onclick="restartQuiz()"
                            class="bg-white hover:bg-gray-50 text-gray-700 font-black py-4 rounded-2xl border-2 border-gray-100 transition-all shadow-sm">LÀM
                            LẠI</button>
                        <button onclick="submitResults(event)"
                            class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all">NỘP
                            KẾT QUẢ</button>
                    </div>
                </div>
            </div>
        </div>


    </main>

    <!-- Modal Teacher Stats -->
    <div id="statsModal" class="modal">
        <div
            class="bg-white rounded-[40px] w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl m-4 transform transition-all">
            <div class="p-8 border-b flex justify-between items-center bg-gray-50/50 backdrop-blur-xl">
                <div class="flex items-center space-x-4">
                    <div
                        class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-black text-gray-800 tracking-tight">Bảng kết quả học tập</h2>
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-1">Dành riêng cho giáo
                            viên</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="exportToExcel()"
                        class="bg-green-600 hover:bg-green-700 text-white font-black py-3 px-6 rounded-2xl text-sm flex items-center shadow-lg shadow-green-100 transition-all active:scale-95">
                        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg> XUẤT EXCEL
                    </button>
                    <button onclick="closeModal()"
                        class="w-12 h-12 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-2xl transition-all">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex-grow overflow-auto p-8 bg-gray-50/30">
                <table class="w-full">
                    <thead>
                        <tr
                            class="text-left text-gray-400 uppercase text-[10px] font-black tracking-[0.2em] border-b-2 border-gray-100 pb-4">
                            <th class="px-6 py-4">STT</th>
                            <th class="px-6 py-4">Họ và Tên</th>
                            <th class="px-6 py-4">Lớp</th>
                            <th class="px-6 py-4">Trường</th>
                            <th class="px-6 py-4 text-center">Điểm</th>
                            <th class="px-6 py-4 text-center">Lần</th>
                            <th class="px-6 py-4 text-center">Thời gian</th>
                            <th class="px-6 py-4 text-right">Hoàn thành</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody" class="divide-y divide-gray-100">
                        <!-- Data rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="success-modal">
        <div class="glass-card success-card rounded-[40px] p-10 max-w-sm w-full text-center shadow-3xl border-white/50">
            <div
                class="w-24 h-24 bg-gradient-to-br from-green-400 to-emerald-600 rounded-3xl flex items-center justify-center text-white mx-auto mb-8 shadow-xl shadow-green-100 transform rotate-6 scale-110">
                <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h2 class="text-3xl font-black text-gray-800 mb-2 tracking-tight">Nộp bài thành công!</h2>
            <p class="text-gray-500 mb-10 font-bold leading-relaxed">Chúc mừng em đã hoàn thành thử thách kiến thức!</p>
            <button onclick="closeSuccessModal()"
                class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 uppercase tracking-widest text-sm">
                Trở về bài học
            </button>
        </div>
    </div>

    <footer class="py-5 px-4 mt-12 bg-white/30 backdrop-blur-md border-t border-white/50">
        <div class="container mx-auto text-center">
            <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">@ 2026 EduRobot - Hệ thống học
                tập thông minh</p>
            <p class="text-xs font-bold text-blue-600 mt-2">Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        // --- 1. CONFIG & DATA ---
        const firebaseConfig = {
            databaseURL: "https://gamhoctap-default-rtdb.firebaseio.com/",
            projectId: "gamhoctap",
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const allQuestions = [
            { q: "Bài thơ là lời của ai gửi cho ai?", a: ["Con gửi cho bố", "Bố gửi cho con", "Bố gửi cho mẹ", "Mẹ gửi cho con"], c: 1 },
            { q: "Bố đang làm nhiệm vụ ở đâu?", a: ["Ở biên giới", "Ở vùng núi cao", "Ở đảo xa", "Ở nước ngoài"], c: 2 },
            { q: "Tại sao thư của bố lại về 'rất nhanh'?", a: ["Nhờ máy bay", "Nhờ bưu điện", "Nhờ gió biển thổi mái chèo cho thuyền", "Nhờ người quen mang hộ"], c: 2 },
            { q: "Thư của bố có những mùi vị đặc biệt gì?", a: ["Mùi giấy mới", "Mùi mực viết", "Mùi nắng, mùi muối của đảo xa", "Mùi hoa biển"], c: 2 },
            { q: "Bố gửi cho con những món quà gì từ khơi xa?", a: ["Quần áo mới", "Đồ chơi điện tử", "Con sò và viên đá cuội lạ", "Sách vở"], c: 2 },
            { q: "Bố kể ở nơi bố ở có loài sinh vật nào rất nhiều?", a: ["Các loài cá", "Các loài chim", "Các loài cây", "Các loài hoa"], c: 1 },
            { q: "Hè về, tiếng chim lích chích được miêu tả như thế nào?", a: ["Rất ồn ào", "Rất vui tai", "In lên nền trời im", "Làm bố mất ngủ"], c: 2 },
            { q: "Bố nhắc nhở con điều gì ở nhà?", a: ["Giúp việc nhà cho mẹ", "Đi chơi với bạn bè", "Chăm ngoan và học giỏi", "Tiết kiệm tiền"], c: 2 },
            { q: "Tình cảm của bố dành cho con như thế nào qua bài thơ?", a: ["Nghiêm khắc", "Hờ hững", "Yêu thương sâu nặng và luôn nhớ về con", "Hay trách móc"], c: 2 },
            { q: "Từ 'vợi vợi' trong câu 'Của đảo xa vợi vợi' có nghĩa là gì?", a: ["Rất gần", "Rất xa, gợi cảm giác mênh mông", "Rất cao", "Rất sâu"], c: 1 },
            { q: "Từ 'mặn mòi' thường dùng để chỉ đặc điểm của gì?", a: ["Nước ngọt", "Muối biển", "Đường", "Ớt"], c: 1 },
            { q: "Câu thơ 'Chiếc thư về rất nhanh' sử dụng từ loại nào để chỉ 'rất'?", a: ["Danh từ", "Động từ", "Tính từ", "Phó từ"], c: 3 },
            { q: "Biện pháp nghệ thuật nào được sử dụng trong câu 'Chắc là nhờ gió biển / Thổi mái chèo cho thuyền'?", a: ["So sánh", "Nhân hóa", "Điển tích", "Ẩn dụ"], c: 1 },
            { q: "Nội dung chính của khổ thơ cuối là gì?", a: ["Lời dặn dò và niềm hy vọng của bố", "Kể về các loài chim", "Tả về con sò", "Tả về gió biển"], c: 0 },
            { q: "Từ nào đồng nghĩa với từ 'chăm ngoan'?", a: ["Lười biếng", "Ngoan ngoãn", "Nghịch ngợm", "Cố chấp"], c: 1 }
        ];

        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let startTime;
        let endTime;

        // --- 2. UI LOGIC ---
        function toggleAccordion(btn) {
            const item = btn.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(i => i.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.add('text-blue-600');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.remove('text-blue-600');
            }
        }

        audio.onended = () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đã phát xong";
        };

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            document.getElementById('btn-' + tab).classList.add('active');
        }

        // --- 3. QUIZ ENGINE ---
        function checkSchool() {
            const select = document.getElementById('schoolSelect');
            const otherInput = document.getElementById('otherSchool');
            if (select.value === 'Khác') {
                otherInput.classList.remove('hidden');
                otherInput.required = true;
            } else {
                otherInput.classList.add('hidden');
                otherInput.required = false;
            }
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        function startQuiz(e) {
            e.preventDefault();
            startTime = new Date();
            currentQuestions = shuffle([...allQuestions]).slice(0, 5);
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const q = currentQuestions[currentQuestionIndex];
            document.getElementById('questionNum').innerText = currentQuestionIndex + 1;
            document.getElementById('progressText').innerText = `CÂU TRẮC NGHIỆM: ${currentQuestionIndex + 1}/5`;
            document.getElementById('questionText').innerText = q.q;
            const area = document.getElementById('optionsArea');
            area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn p-4 rounded-xl text-left font-bold text-gray-700 bg-white hover:bg-blue-50 transition-all flex items-center group';
                btn.innerHTML = `
                    <span class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 text-xs font-black group-hover:bg-blue-600 group-hover:text-white transition-all">${String.fromCharCode(65 + i)}</span>
                    <span class="flex-1">${opt}</span>
                `;
                btn.onclick = () => selectOption(i);
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('nextBtn').onclick = nextQuestion;
        }

        function selectOption(index) {
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(b => b.classList.remove('selected', 'bg-blue-50', 'border-blue-500'));
            btns[index].classList.add('selected', 'bg-blue-50', 'border-blue-500');
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('nextBtn').dataset.selected = index;
        }

        function nextQuestion() {
            const selected = parseInt(document.getElementById('nextBtn').dataset.selected);
            if (selected === currentQuestions[currentQuestionIndex].c) score += 20;

            currentQuestionIndex++;
            if (currentQuestionIndex < 5) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            endTime = new Date();
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = score;

            const circle = document.getElementById('scoreCircle');
            const pct = (score / 100) * 465;
            circle.style.strokeDasharray = `${pct}, 465`;

            if (score >= 80) {
                document.getElementById('resultTitle').innerText = "Xuất sắc quá!";
                document.getElementById('resultMsg').innerText = "Em đã nắm rất vững nội dung bài tập này.";
            } else if (score >= 50) {
                document.getElementById('resultTitle').innerText = "Làm tốt lắm!";
                document.getElementById('resultMsg').innerText = "Em chỉ cần chú ý thêm một chút nữa thôi.";
            } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên nhé!";
                document.getElementById('resultMsg').innerText = "Em nên luyện tập thêm một lần nữa.";
            }
        }

        function restartQuiz() {
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-registration').classList.remove('hidden');
            document.getElementById('studentName').value = '';
        }

        // --- 4. FIREBASE & STATS ---
        async function submitResults(e) {
            e.target.disabled = true;
            e.target.innerText = "ĐANG NỘP...";

            const name = document.getElementById('studentName').value;
            const studentClass = document.getElementById('studentClass').value;
            const school = document.getElementById('schoolSelect').value === 'Khác' ?
                document.getElementById('otherSchool').value : document.getElementById('schoolSelect').value;

            const duration = Math.floor((endTime - startTime) / 1000);

            const resultData = {
                name,
                studentClass,
                school,
                score,
                duration,
                lessonTitle: "Thư của bố",
                submittedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            try {
                await db.collection("diem_tieng_viet_lop5").add(resultData);
                document.getElementById('successModal').classList.add('active');
            } catch (err) {
                console.error(err);
                alert("Có lỗi khi nộp bài. Em hãy thử lại nhé!");
                e.target.disabled = false;
                e.target.innerText = "NỘP KẾT QUẢ";
            }
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
            restartQuiz();
            switchTab('lesson');
        }

        function openTeacherStats() {
            const pin = prompt("Nhập mã pin giáo viên:");
            if (pin === "dvn") {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else {
                alert("Mã pin không đúng!");
            }
        }

        function closeModal() {
            document.getElementById('statsModal').classList.remove('active');
        }

        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '<tr><td colspan="8" class="text-center py-10 font-bold text-gray-400 italic">Đang tải dữ liệu...</td></tr>';

            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5")
                    .where("lessonTitle", "==", "Thư của bố")
                    .limit(100)
                    .get();

                const docs = [];
                snapshot.forEach(doc => docs.push(doc.data()));
                docs.sort((a, b) => {
                    const tA = a.submittedAt ? a.submittedAt.toMillis() : 0;
                    const tB = b.submittedAt ? b.submittedAt.toMillis() : 0;
                    return tB - tA;
                });

                tbody.innerHTML = '';
                let index = 1;
                docs.forEach(data => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';
                    const dur = data.duration ? `${Math.floor(data.duration / 60)}p ${data.duration % 60}s` : '---';

                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50/50 transition-colors";
                    tr.innerHTML = `
                        <td class="px-6 py-4 font-black text-gray-400 text-xs">${index++}</td>
                        <td class="px-6 py-4 font-bold text-gray-800">${data.name}</td>
                        <td class="px-6 py-4 font-bold text-blue-600">${data.studentClass}</td>
                        <td class="px-6 py-4 font-medium text-gray-500 text-sm">${data.school}</td>
                        <td class="px-6 py-4 text-center">
                            <span class="px-3 py-1 rounded-lg ${data.score >= 80 ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'} font-black text-sm">${data.score}</span>
                        </td>
                        <td class="px-6 py-4 text-center font-bold text-gray-400">1</td>
                        <td class="px-6 py-4 text-center font-bold text-gray-600 text-xs">${dur}</td>
                        <td class="px-6 py-4 text-right font-bold text-gray-400 text-[10px]">${date}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error(err);
                tbody.innerHTML = '<tr><td colspan="8" class="text-center py-10 font-bold text-red-400">Lỗi khi tải dữ liệu.</td></tr>';
            }
        }

        function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            const ws = XLSX.utils.table_to_sheet(table);

            // Ensure Class column is text
            Object.keys(ws).forEach(key => {
                if (key.startsWith('C')) { // Column C is Class
                    ws[key].t = 's';
                }
            });

            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "KetQua");
            XLSX.writeFile(wb, "KetQua_ThuCuaBo.xlsx");
        }
    </script>
</body>

</html>