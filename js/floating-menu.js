// Curriculum Data - Fixed version with proper single-line strings
const curriculumData = {
    "Học kỳ 1": [
        {
            "theme": "Chủ điểm 1: Thế giới tuổi thơ",
            "weeks": [
                {
                    "id": 1, "name": "Tuần 1",
                    "lessons": [
                        {
                            "title": "Bài 1: Thanh âm của gió", "sections": [
                                { "title": "Đọc: Thanh âm của gió", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về danh từ, động từ, tính từ", "url": "#" },
                                { "title": "Viết: Cách viết bài văn kể chuyện sáng tạo", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 2: Cánh đồng hoa", "sections": [
                                { "title": "Đọc: Cánh đồng hoa", "url": "#" },
                                { "title": "Viết: Cách viết văn kể chuyện sáng tạo (tiếp)", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 2, "name": "Tuần 2",
                    "lessons": [
                        {
                            "title": "Bài 3: Tuổi Ngựa", "sections": [
                                { "title": "Đọc: Tuổi Ngựa", "url": "#" },
                                { "title": "Luyện từ & Câu: Đại từ", "url": "#" },
                                { "title": "Viết: Lập dàn ý văn kể chuyện sáng tạo", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 4: Bến sông tuổi thơ", "sections": [
                                { "title": "Đọc: Bến sông tuổi thơ", "url": "#" },
                                { "title": "Viết: Viết bài văn kể chuyện sáng tạo", "url": "#" },
                                { "title": "Nói & nghe: Những câu chuyện thú vị", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 3, "name": "Tuần 3",
                    "lessons": [
                        {
                            "title": "Bài 5: Tiếng hạt nảy mầm", "sections": [
                                { "title": "Đọc: Tiếng hạt nảy mầm", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về đại từ", "url": "#" },
                                { "title": "Viết: Chỉnh sửa bài văn kể chuyện sáng tạo", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 6: Ngôi sao sân cỏ", "sections": [
                                { "title": "Đọc: Ngôi sao sân cỏ", "url": "#" },
                                { "title": "Viết: Tìm hiểu cách viết báo cáo công việc", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 4, "name": "Tuần 4",
                    "lessons": [
                        {
                            "title": "Bài 7: Bộ sưu tập độc đáo", "sections": [
                                { "title": "Đọc: Bộ sưu tập độc đáo", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về đại từ (tiếp)", "url": "#" },
                                { "title": "Viết: Viết báo cáo công việc", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 8: Hành tinh kì lạ", "sections": [
                                { "title": "Đọc: Hành tinh kì lạ", "url": "#" },
                                { "title": "Viết: Chỉnh sửa báo cáo công việc", "url": "#" },
                                { "title": "Nói & nghe: Những điểm vui chơi lí thú", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Chủ điểm 2: Thiên nhiên kì thú",
            "weeks": [
                {
                    "id": 5, "name": "Tuần 5",
                    "lessons": [
                        {
                            "title": "Bài 9: Trước cổng trời", "sections": [
                                { "title": "Đọc: Trước cổng trời", "url": "#" },
                                { "title": "Luyện từ & Câu: Từ đồng nghĩa", "url": "#" },
                                { "title": "Viết: Cách viết bài văn tả phong cảnh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 10: Kì diệu rừng xanh", "sections": [
                                { "title": "Đọc: Kì diệu rừng xanh", "url": "#" },
                                { "title": "Viết: Cách viết văn tả phong cảnh (tiếp)", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 6, "name": "Tuần 6",
                    "lessons": [
                        {
                            "title": "Bài 11: Hang Sơn Đoòng – những điều kì thú", "sections": [
                                { "title": "Đọc: Hang Sơn Đoòng – những điều kì thú", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về từ đồng nghĩa", "url": "#" },
                                { "title": "Viết: Viết mở bài và kết bài văn tả phong cảnh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 12: Những hòn đảo trên vịnh Hạ Long", "sections": [
                                { "title": "Đọc: Những hòn đảo trên vịnh Hạ Long", "url": "#" },
                                { "title": "Viết: Quan sát phong cảnh", "url": "#" },
                                { "title": "Nói & nghe: Bảo tồn động vật hoang dã", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 7, "name": "Tuần 7",
                    "lessons": [
                        {
                            "title": "Bài 13: Mầm non", "sections": [
                                { "title": "Đọc: Mầm non", "url": "#" },
                                { "title": "Luyện từ & Câu: Từ đa nghĩa", "url": "#" },
                                { "title": "Viết: Lập dàn ý bài văn tả phong cảnh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 14: Những ngọn núi nóng rẫy", "sections": [
                                { "title": "Đọc: Những ngọn núi nóng rẫy", "url": "#" },
                                { "title": "Viết: Viết đoạn văn tả phong cảnh", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 8, "name": "Tuần 8",
                    "lessons": [
                        {
                            "title": "Bài 15: Bài ca về mặt trời", "sections": [
                                { "title": "Đọc: Bài ca về mặt trời", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về từ đa nghĩa", "url": "#" },
                                { "title": "Viết: Bài văn tả phong cảnh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 16: Xin chào, Xa-ha-ra", "sections": [
                                { "title": "Đọc: Xin chào, Xa-ha-ra", "url": "#" },
                                { "title": "Viết: Chỉnh sửa bài văn tả phong cảnh", "url": "#" },
                                { "title": "Nói & nghe: Cảnh đẹp thiên nhiên", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Ôn tập giữa học kỳ 1",
            "weeks": [
                {
                    "id": 9, "name": "Tuần 9: Ôn tập", "lessons": [
                        { "title": "Ôn tập tiết 1-7", "url": "#" }
                    ]
                }
            ]
        },
        {
            "theme": "Chủ điểm 3: Trên con đường học tập",
            "weeks": [
                {
                    "id": 10, "name": "Tuần 10",
                    "lessons": [
                        {
                            "title": "Bài 17: Cuốn sách của em", "sections": [
                                { "title": "Đọc: Cuốn sách của em", "url": "#" },
                                { "title": "Luyện từ & Câu: Đại từ nghi vấn", "url": "#" },
                                { "title": "Viết: Cách viết đoạn văn giới thiệu sách", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 18: Thư gửi các học sinh", "sections": [
                                { "title": "Đọc: Thư gửi các học sinh", "url": "#" },
                                { "title": "Nói & Nghe: Trao đổi: Em đọc sách", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 11, "name": "Tuần 11",
                    "lessons": [
                        {
                            "title": "Bài 19: Trải nghiệm để sáng tạo", "sections": [
                                { "title": "Đọc: Trải nghiệm để sáng tạo", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về đại từ nghi vấn", "url": "#" },
                                { "title": "Viết: Viết đoạn văn giới thiệu một cuốn sách", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 20: Khổ luyện thành tài", "sections": [
                                { "title": "Đọc: Khổ luyện thành tài", "url": "#" },
                                { "title": "Viết: Chỉnh sửa đoạn văn giới thiệu sách", "url": "#" },
                                { "title": "Nói & Nghe: Trao đổi: Cuốn sách tôi yêu", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 12, "name": "Tuần 12",
                    "lessons": [
                        {
                            "title": "Bài 21: Thế giới trong trang sách", "sections": [
                                { "title": "Đọc: Thế giới trong trang sách", "url": "#" },
                                { "title": "Luyện từ & Câu: Dấu gạch ngang", "url": "#" },
                                { "title": "Viết: Đoạn văn thể hiện cảm xúc về bài thơ", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 22: Giới thiệu sách Dế Mèn phiêu lưu kí", "sections": [
                                { "title": "Đọc: Giới thiệu sách Dế Mèn phiêu lưu kí", "url": "#" },
                                { "title": "Viết: Cách viết đoạn văn thể hiện tình cảm", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 13, "name": "Tuần 13",
                    "lessons": [
                        {
                            "title": "Bài 23: Tên là gì?", "sections": [
                                { "title": "Đọc: Tên là gì?", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về dấu gạch ngang", "url": "#" },
                                { "title": "Viết: Lập dàn ý đoạn văn thể hiện tình cảm", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 24: Tinh thần học tập của nhà Phi-lít", "sections": [
                                { "title": "Đọc: Tinh thần học tập của nhà Phi-lít", "url": "#" },
                                { "title": "Viết: Viết đoạn văn thể hiện tình cảm về câu chuyện", "url": "#" },
                                { "title": "Nói & Nghe: Nói và nghe về một tấm gương vượt khó", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Chủ điểm 4: Nghệ thuật muôn màu",
            "weeks": [
                {
                    "id": 14, "name": "Tuần 14",
                    "lessons": [
                        {
                            "title": "Bài 25: Tiếng đàn ba-la-lai-ca trên sông Đà", "sections": [
                                { "title": "Đọc: Tiếng đàn ba-la-lai-ca trên sông Đà", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về từ đồng nghĩa", "url": "#" },
                                { "title": "Viết: Luyện tập viết đoạn văn thể hiện tình cảm", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 26: Trí tưởng tượng phong phú", "sections": [
                                { "title": "Đọc: Trí tưởng tượng phong phú", "url": "#" },
                                { "title": "Nói & Nghe: Kể chuyện: Những bức chân dung", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 15, "name": "Tuần 15",
                    "lessons": [
                        {
                            "title": "Bài 27: Tranh làng Hồ", "sections": [
                                { "title": "Đọc: Tranh làng Hồ", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về từ trái nghĩa", "url": "#" },
                                { "title": "Viết: Tìm ý cho bài văn tả cảnh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 28: Tập hát quan họ", "sections": [
                                { "title": "Đọc: Tập hát quan họ", "url": "#" },
                                { "title": "Viết: Lập dàn ý cho bài văn tả cảnh", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 16, "name": "Tuần 16",
                    "lessons": [
                        {
                            "title": "Bài 29: Phim hoạt hình Chú ốc sên bay", "sections": [
                                { "title": "Đọc: Phim hoạt hình Chú ốc sên bay", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về từ đa nghĩa", "url": "#" },
                                { "title": "Viết: Viết bài văn tả một cảnh đẹp", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 30: Nghệ thuật múa ba lê", "sections": [
                                { "title": "Đọc: Nghệ thuật múa ba lê", "url": "#" },
                                { "title": "Nói & Nghe: Trao đổi: Nghệ thuật quanh ta", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 17, "name": "Tuần 17",
                    "lessons": [
                        {
                            "title": "Bài 31: Một ngôi chùa độc đáo", "sections": [
                                { "title": "Đọc: Một ngôi chùa độc đáo", "url": "#" },
                                { "title": "Luyện từ & Câu: Luyện tập về từ đồng âm", "url": "#" },
                                { "title": "Viết: Chỉnh sửa bài văn tả cảnh đẹp", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 32: Sự tích chú Tễu", "sections": [
                                { "title": "Đọc: Sự tích chú Tễu", "url": "#" },
                                { "title": "Viết: Luyện tập viết chương trình hoạt động", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Ôn tập cuối học kỳ 1",
            "weeks": [
                {
                    "id": 18, "name": "Tuần 18: Ôn tập", "lessons": [
                        { "title": "Ôn tập và kiểm tra HK1", "url": "#" }
                    ]
                }
            ]
        }
    ],
    "Học kỳ 2": [
        {
            "theme": "Chủ điểm 5: Vẻ đẹp cuộc sống",
            "weeks": [
                {
                    "id": 19, "name": "Tuần 19",
                    "lessons": [
                        {
                            "title": "Bài 1: Tiếng hát của người đá", "sections": [
                                { "title": "Đọc: Tiếng hát của người đá", "url": "191-tieng-hat-nguoi-da.html" },
                                { "title": "Luyện từ & Câu: Câu đơn và câu ghép", "url": "#" },
                                { "title": "Viết: Tìm hiểu cách viết bài văn tả người", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 2: Khúc hát ru những em bé lớn trên lưng mẹ", "sections": [
                                { "title": "Đọc: Khúc hát ru những em bé lớn trên lưng mẹ", "url": "192-khuc-hat-ru-nhung-em-be-tren-lung-me.html" },
                                { "title": "Viết: Viết mở bài và kết bài cho bài văn tả người", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 20, "name": "Tuần 20",
                    "lessons": [
                        {
                            "title": "Bài 3: Hạt gạo làng ta", "sections": [
                                { "title": "Đọc: Hạt gạo làng ta", "url": "201-hat-gao-lang-ta.html" },
                                { "title": "Luyện từ & Câu: Cách nối các vế câu ghép", "url": "#" },
                                { "title": "Viết: Quan sát để viết bài văn tả người", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 4: Hộp quà màu thiên thanh", "sections": [
                                { "title": "Đọc: Hộp quà màu thiên thanh", "url": "202-hop-qua-mau-thien-thanh.html" },
                                { "title": "Viết: Lập dàn ý cho bài văn tả người", "url": "#" },
                                { "title": "Nói và nghe: Nét đẹp học đường", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 21, "name": "Tuần 21",
                    "lessons": [
                        {
                            "title": "Bài 5: Giỏ hoa tháng Năm", "sections": [
                                { "title": "Đọc: Giỏ hoa tháng Năm", "url": "211-gio-hoa-thang-nam.html" },
                                { "title": "Luyện từ & Câu: Cách nối các vế câu ghép (Tiếp theo)", "url": "211-ltvc-gio-hoa-thang-nam.html" },
                                { "title": "Viết: Viết đoạn văn tả người", "url": "211-viet-doan-van-ta-nguoi.html" }
                            ]
                        },
                        {
                            "title": "Bài 6: Thư của bố", "sections": [
                                { "title": "Đọc: Thư của bố", "url": "212-thu-cua-bo.html" },
                                { "title": "Viết: Viết bài văn tả người (Bài viết số 1)", "url": "212-viet-bai-van-ta-nguoi.html" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 22, "name": "Tuần 22",
                    "lessons": [
                        {
                            "title": "Bài 7: Đoàn thuyền đánh cá", "sections": [
                                { "title": "Đọc: Đoàn thuyền đánh cá", "url": "221-doan-thuyen-danh-ca.html" },
                                { "title": "Luyện từ & Câu: Luyện tập về câu ghép", "url": "221-LTVC-Luyen-tap-cau-ghep.html" },
                                { "title": "Viết: Đánh giá, chỉnh sửa bài văn tả người", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 8: Khu rừng của Mát", "sections": [
                                { "title": "Đọc: Khu rừng của Mát", "url": "222-khu-rung-cua-mat.html" },
                                { "title": "Viết: Viết bài văn tả người (Bài viết số 2)", "url": "#" },
                                { "title": "Nói và nghe: Những ý kiến khác biệt", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Chủ điểm 6: Hương sắc trăm miền",
            "weeks": [
                {
                    "id": 23, "name": "Tuần 23",
                    "lessons": [
                        {
                            "title": "Bài 9: Hội thổi cơm thi ở Đồng Vân", "sections": [
                                { "title": "Đọc: Hội thổi cơm thi ở Đồng Vân", "url": "231-hoi-thoi-com-thi-o-dong-van.html" },
                                { "title": "Luyện từ & Câu: Liên kết câu bằng cách lặp từ ngữ", "url": "#" },
                                { "title": "Viết: Tìm hiểu cách viết bài văn thuyết minh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 10: Những búp chè trên cây cổ thụ", "sections": [
                                { "title": "Đọc: Những búp chè trên cây cổ thụ", "url": "232-nhung-bup-che-tren-cay-co-thu.html" },
                                { "title": "Viết: Viết mở bài và kết bài cho bài văn thuyết minh", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 24, "name": "Tuần 24",
                    "lessons": [
                        {
                            "title": "Bài 11: Hương cốm mùa thu", "sections": [
                                { "title": "Đọc: Hương cốm mùa thu", "url": "241-huong-com-mua-thu.html" },
                                { "title": "Luyện từ & Câu: Liên kết câu bằng cách thay thế từ ngữ", "url": "#" },
                                { "title": "Viết: Lập dàn ý cho bài văn thuyết minh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 12: Vũ điệu trên nền thổ cẩm", "sections": [
                                { "title": "Đọc: Vũ điệu trên nền thổ cẩm", "url": "242-vu-dieu-tren-nen-tho-cam.html" },
                                { "title": "Viết: Viết đoạn văn thuyết minh", "url": "#" },
                                { "title": "Nói và nghe: Thuyết trình: Giới thiệu địa phương em", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 25, "name": "Tuần 25",
                    "lessons": [
                        {
                            "title": "Bài 13: Đàn T'rưng - Tiếng ca đại ngàn", "sections": [
                                { "title": "Đọc: Đàn T'rưng - Tiếng ca đại ngàn", "url": "251-dan-t'rung-tieng-ca-dai-ngan.html" },
                                { "title": "Luyện từ & Câu: Luyện tập liên kết câu", "url": "#" },
                                { "title": "Viết: Viết bài văn thuyết minh", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 14: Đường quê Đồng Tháp Mười", "sections": [
                                { "title": "Đọc: Đường quê Đồng Tháp Mười", "url": "252-duong-que-dong-thap-muoi.html" },
                                { "title": "Viết: Đánh giá, chỉnh sửa bài văn thuyết minh", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 26, "name": "Tuần 26",
                    "lessons": [
                        {
                            "title": "Bài 15: Xưởng Ba La - quê tôi", "sections": [
                                { "title": "Đọc: Xưởng Ba La - quê tôi", "url": "261-xuong-ba-la-que-toi.html" },
                                { "title": "Luyện từ & Câu: Ôn tập về liên kết câu", "url": "#" },
                                { "title": "Viết: Tìm hiểu cách viết báo cáo công việc", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 16: Về thăm đất Mũi", "sections": [
                                { "title": "Đọc: Về thăm đất Mũi", "url": "262-ve-tham-dat-mui.html" },
                                { "title": "Nói và nghe: Kể chuyện: Về thăm đất Mũi", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Ôn tập giữa học kỳ 2",
            "weeks": [
                {
                    "id": 27, "name": "Tuần 27: Ôn tập", "lessons": [
                        { "title": "Ôn tập giữa HK2", "url": "on-tap-hk2-giua.html" }
                    ]
                }
            ]
        },
        {
            "theme": "Chủ điểm 7: Tiếp bước cha ông",
            "weeks": [
                {
                    "id": 28, "name": "Tuần 28",
                    "lessons": [
                        {
                            "title": "Bài 17: Nghìn năm văn hiến", "sections": [
                                { "title": "Đọc: Nghìn năm văn hiến", "url": "281-nghin-nam-van-hien.html" },
                                { "title": "Luyện từ & Câu: Mở rộng vốn từ: Truyền thống", "url": "#" },
                                { "title": "Viết: Tìm hiểu cách viết bài văn tả người", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 18: Người thầy của muôn đời", "sections": [
                                { "title": "Đọc: Người thầy của muôn đời", "url": "282-nguoi-thay-cua-muon-doi.html" },
                                { "title": "Nói & Nghe: Kể chuyện về truyền thống tốt đẹp", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 29, "name": "Tuần 29",
                    "lessons": [
                        {
                            "title": "Bài 19: Danh y Tuệ Tĩnh", "sections": [
                                { "title": "Đọc: Danh y Tuệ Tĩnh", "url": "291-danh-y-tue-tinh.html" },
                                { "title": "Luyện từ & Câu: Thay thế từ ngữ để liên kết câu", "url": "#" },
                                { "title": "Viết: Viết mở bài và kết bài cho bài văn tả người", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 20: Cụ Đồ Chiểu", "sections": [
                                { "title": "Đọc: Cụ Đồ Chiểu", "url": "292-cu-do-chieu.html" },
                                { "title": "Viết: Lập dàn ý cho báo cáo công việc", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 30, "name": "Tuần 30",
                    "lessons": [
                        {
                            "title": "Bài 21: Anh hùng Lao động Trần Đại Nghĩa", "sections": [
                                { "title": "Đọc: Anh hùng Lao động Trần Đại Nghĩa", "url": "301-tran-dai-nghia.html" },
                                { "title": "Luyện từ & Câu: Sử dụng từ nối để liên kết câu", "url": "#" },
                                { "title": "Viết: Viết báo cáo công việc", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 22: Bộ đội về làng", "sections": [
                                { "title": "Đọc: Bộ đội về làng", "url": "302-bo-doi-ve-lang.html" },
                                { "title": "Nói & Nghe: Kể chuyện: Bộ đội về làng", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Chủ điểm 8: Thế giới của chúng ta",
            "weeks": [
                {
                    "id": 31, "name": "Tuần 31",
                    "lessons": [
                        {
                            "title": "Bài 23: Về ngôi nhà đang xây", "sections": [
                                { "title": "Đọc: Về ngôi nhà đang xây", "url": "311-ve-ngoi-nha-dang-xay.html" },
                                { "title": "Luyện từ & Câu: Ôn tập về dấu câu", "url": "#" },
                                { "title": "Viết: Tìm hiểu cách viết biên bản họp", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 24: Việt Nam quê hương ta", "sections": [
                                { "title": "Đọc: Việt Nam quê hương ta", "url": "312-viet-nam-que-huong-ta.html" },
                                { "title": "Viết: Lập dàn ý biên bản họp", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 32, "name": "Tuần 32",
                    "lessons": [
                        {
                            "title": "Bài 25: Bài ca Trái Đất", "sections": [
                                { "title": "Đọc: Bài ca Trái Đất", "url": "321-bai-ca-trai-dat.html" },
                                { "title": "Luyện từ & Câu: Ôn tập về dấu câu (tiếp theo)", "url": "#" },
                                { "title": "Viết: Viết biên bản họp", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 26: Những con hạc giấy", "sections": [
                                { "title": "Đọc: Những con hạc giấy", "url": "322-nhung-con-hac-giay.html" },
                                { "title": "Nói và nghe: Thuyết trình: Bảo vệ môi trường", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 33, "name": "Tuần 33",
                    "lessons": [
                        {
                            "title": "Bài 27: Một người hùng thầm lặng", "sections": [
                                { "title": "Đọc: Một người hùng thầm lặng", "url": "331-mot-nguoi-hung-tham-lang.html" },
                                { "title": "Luyện từ & Câu: Mở rộng vốn từ: Môi trường", "url": "#" },
                                { "title": "Viết: Chỉnh sửa biên bản họp", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 28: Giờ Trái Đất", "sections": [
                                { "title": "Đọc: Giờ Trái Đất", "url": "332-gio-trai-dat.html" },
                                { "title": "Viết: Tìm hiểu cách viết đoạn văn nghị luận", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                },
                {
                    "id": 34, "name": "Tuần 34",
                    "lessons": [
                        {
                            "title": "Bài 29: Điện thoại di động", "sections": [
                                { "title": "Đọc: Điện thoại di động", "url": "341-dien-thoai-di-dong.html" },
                                { "title": "Luyện từ & Câu: Ôn tập về câu ghép", "url": "#" },
                                { "title": "Viết: Viết đoạn văn nghị luận", "url": "#" }
                            ]
                        },
                        {
                            "title": "Bài 30: Thành phố thông minh Mát-xđa", "sections": [
                                { "title": "Đọc: Thành phố thông minh Mát-xđa", "url": "342-thanh-pho-thong-minh-mat-xda.html" },
                                { "title": "Nói và nghe: Thảo luận về công nghệ", "url": "#" },
                                { "title": "Khác: Đọc mở rộng", "url": "#" }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "theme": "Ôn tập cuối học kỳ 2",
            "weeks": [
                {
                    "id": 35, "name": "Tuần 35: Ôn tập", "lessons": [
                        { "title": "Ôn tập và kiểm tra HK2", "url": "on-tap-hk2-cuoi.html" }
                    ]
                }
            ]
        }
    ]
};

// Inject CSS
const style = document.createElement('style');
style.textContent = `
    :root { --sidebar-width: 320px; }
    #floating-menu-btn {
        position: fixed; left: 0; top: 50%;
        transform: translateY(-50%) translateX(0);
        z-index: 10002; width: 45px; height: 90px;
        background: white; border-radius: 0 45px 45px 0;
        box-shadow: 4px 0 20px rgba(37, 99, 235, 0.15);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid #e5e7eb; border-left: none; user-select: none;
    }
    #floating-menu-btn:hover { background: #eff6ff; box-shadow: 4px 0 25px rgba(37, 99, 235, 0.25); }
    #floating-menu-btn.active { transform: translateY(-50%) translateX(var(--sidebar-width)); }
    #floating-menu-btn svg { color: #2563eb; stroke-width: 3; width: 24px; height: 24px; }
    #floating-sidebar {
        position: fixed; left: 0; top: 0;
        width: var(--sidebar-width); height: 100vh;
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        z-index: 10001; transform: translateX(-100%);
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex; flex-direction: column;
        border-right: 1px solid rgba(0,0,0,0.05);
        font-family: 'Nunito', sans-serif;
    }
    #floating-sidebar.active { transform: translateX(0); }
    .menu-header {
        padding: 20px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white; display: flex; align-items: center; justify-content: space-between;
        box-shadow: 0 2px 10px rgba(37, 99, 235, 0.2);
    }
    .close-btn {
        background: rgba(255,255,255,0.2); border: none; color: white;
        width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
        display: flex; align-items: center; justify-content: center; transition: background 0.2s;
    }
    .close-btn:hover { background: rgba(255,255,255,0.4); }
    .menu-content { flex: 1; overflow-y: auto; padding: 10px; }
    .menu-section-title { font-size: 11px; font-weight: 800; text-transform: uppercase; color: #94a3b8; letter-spacing: 0.1em; padding: 15px 10px 5px; }
    .theme-item { margin-bottom: 5px; }
    .theme-btn { width: 100%; text-align: left; padding: 12px 15px; background: transparent; border: none; font-weight: 700; color: #1e293b; cursor: pointer; border-radius: 10px; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; }
    .theme-btn:hover { background: #f1f5f9; color: #2563eb; }
    .theme-btn.active { background: #eff6ff; color: #2563eb; }
    .theme-content { display: none; padding-left: 10px; animation: slideDown 0.3s ease-out; border-left: 1px solid #e2e8f0; margin-left: 15px; }
    .theme-content.open { display: block; }
    .week-item { margin: 2px 0; }
    .week-btn { width: 100%; text-align: left; padding: 8px 10px; font-size: 14px; font-weight: 600; color: #475569; border-radius: 6px; cursor: pointer; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; }
    .week-btn:hover { background: #f8fafc; color: #0f172a; }
    .week-btn.active { color: #2563eb; background: #eff6ff; }
    .week-content { display: none; padding-left: 10px; margin-left: 5px; border-left: 1px solid #e2e8f0; }
    .week-content.open { display: block; }
    .lesson-item { margin: 2px 0; }
    .lesson-btn { width: 100%; text-align: left; padding: 6px 10px; font-size: 13px; font-weight: 500; color: #64748b; border-radius: 6px; cursor: pointer; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; }
    .lesson-btn:hover { color: #2563eb; background: #f1f5f9; }
    .lesson-btn.active { color: #2563eb; font-weight: 600; }
    .lesson-content { display: none; padding-left: 10px; margin-left: 5px; border-left: 1px solid #e2e8f0; }
    .lesson-content.open { display: block; }
    .section-link { display: block; padding: 5px 10px; font-size: 12px; color: #64748b; text-decoration: none; transition: color 0.2s; border-radius: 4px; position: relative; }
    .section-link:hover { color: #2563eb; background: #f8fafc; }
    .section-link.current { color: #2563eb; font-weight: 700; background: #eff6ff; }
    .section-link.current::before { content: ''; position: absolute; left: -16px; top: 50%; transform: translateY(-50%); width: 6px; height: 6px; border-radius: 50%; background: #2563eb; }
    .menu-content::-webkit-scrollbar { width: 4px; }
    .menu-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    .icon-chevron { transition: transform 0.2s; width: 14px; height: 14px; }
`;
document.head.appendChild(style);

// Inject HTML
const floatingBtn = document.createElement('button');
floatingBtn.id = 'floating-menu-btn';
floatingBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`;

const sidebar = document.createElement('div');
sidebar.id = 'floating-sidebar';
sidebar.innerHTML = `
    <div class="menu-header">
        <span class="font-bold text-lg">Mục lục</span>
        <button class="close-btn" onclick="toggleMenu()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>
    <div class="menu-content" id="menu-content"></div>
`;

document.body.appendChild(floatingBtn);
document.body.appendChild(sidebar);

// Toggle Logic
function toggleMenu(forceState) {
    const sidebar = document.getElementById('floating-sidebar');
    const floatingBtn = document.getElementById('floating-menu-btn');
    if (!sidebar || !floatingBtn) return;
    const isActive = forceState !== undefined ? forceState : !sidebar.classList.contains('active');
    if (isActive) {
        sidebar.classList.add('active');
        floatingBtn.classList.add('active');
        floatingBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>`;
    } else {
        sidebar.classList.remove('active');
        floatingBtn.classList.remove('active');
        floatingBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`;
    }
}
window.toggleMenu = toggleMenu;
floatingBtn.addEventListener('click', toggleMenu);

// Render Menu
const menuContent = document.getElementById('menu-content');
const createChevron = () => `<svg class="icon-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>`;

function renderCurriculumTo(container, autoExpand = false) {
    if (!container) return;
    container.innerHTML = '';
    Object.entries(curriculumData).forEach(([semesterName, themes]) => {
        const semTitle = document.createElement('div');
        semTitle.className = 'menu-section-title';
        semTitle.innerText = semesterName;
        container.appendChild(semTitle);

        themes.forEach((theme) => {
            const themeItem = document.createElement('div');
            themeItem.className = 'theme-item';
            const themeBtn = document.createElement('button');
            themeBtn.className = 'theme-btn';
            themeBtn.innerHTML = `<span>${theme.theme}</span>${createChevron()}`;
            const themeContent = document.createElement('div');
            themeContent.className = 'theme-content';

            theme.weeks.forEach(week => {
                const weekItem = document.createElement('div');
                weekItem.className = 'week-item';
                const weekBtn = document.createElement('button');
                weekBtn.className = 'week-btn';
                weekBtn.innerHTML = `<span>${week.name}</span>${createChevron()}`;
                const weekContent = document.createElement('div');
                weekContent.className = 'week-content';
                let isCurrentInWeek = false;

                if (week.lessons && week.lessons.length > 0) {
                    week.lessons.forEach(lesson => {
                        const lessonItem = document.createElement('div');
                        lessonItem.className = 'lesson-item';
                        const lessonBtn = document.createElement('button');
                        lessonBtn.className = 'lesson-btn';
                        lessonBtn.innerHTML = `<span>${lesson.title}</span>${createChevron()}`;
                        const lessonContentDiv = document.createElement('div');
                        lessonContentDiv.className = 'lesson-content';
                        let isCurrentInLesson = false;
                        const sections = lesson.sections || [{ title: "Vào bài học", url: lesson.url }];

                        sections.forEach(section => {
                            const sectionLink = document.createElement('a');
                            sectionLink.className = 'section-link';
                            sectionLink.href = section.url;
                            const titleParts = section.title.split(':');
                            if (titleParts.length > 1) {
                                sectionLink.innerHTML = `<strong>${titleParts[0]}:</strong> ${titleParts.slice(1).join(':')}`;
                            } else {
                                sectionLink.innerText = section.title;
                            }
                            const isCurrent = window.location.pathname.endsWith(section.url) || (section.url !== '#' && window.location.href.includes(section.url));
                            if (isCurrent) {
                                sectionLink.classList.add('current');
                                isCurrentInLesson = true;
                                isCurrentInWeek = true;
                            }
                            lessonContentDiv.appendChild(sectionLink);
                        });

                        lessonItem.appendChild(lessonBtn);
                        lessonItem.appendChild(lessonContentDiv);
                        weekContent.appendChild(lessonItem);

                        if (isCurrentInLesson) {
                            lessonContentDiv.classList.add('open');
                            lessonBtn.classList.add('active');
                            lessonBtn.querySelector('svg').style.transform = 'rotate(180deg)';
                        }
                        lessonBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const isOpen = lessonContentDiv.classList.contains('open');
                            lessonContentDiv.classList.toggle('open');
                            lessonBtn.classList.toggle('active');
                            lessonBtn.querySelector('svg').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
                        });
                    });
                } else {
                    weekContent.innerHTML = `<div class="lesson-link italic text-xs">Đang cập nhật...</div>`;
                }

                weekItem.appendChild(weekBtn);
                weekItem.appendChild(weekContent);
                themeContent.appendChild(weekItem);

                if (isCurrentInWeek) {
                    weekContent.classList.add('open');
                    weekBtn.classList.add('active');
                    weekBtn.querySelector('svg').style.transform = 'rotate(180deg)';
                }
                weekBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = weekContent.classList.contains('open');
                    weekContent.classList.toggle('open');
                    weekBtn.classList.toggle('active');
                    weekBtn.querySelector('svg').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
                });
            });

            themeItem.appendChild(themeBtn);
            themeItem.appendChild(themeContent);
            container.appendChild(themeItem);

            if (themeContent.querySelector('.week-content.open')) {
                themeContent.classList.add('open');
                themeBtn.classList.add('active');
                themeBtn.querySelector('svg').style.transform = 'rotate(180deg)';
                if (autoExpand) toggleMenu(true);
            }
            themeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = themeContent.classList.contains('open');
                themeContent.classList.toggle('open');
                themeBtn.classList.toggle('active');
                themeBtn.querySelector('svg').style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
            });
        });
    });
}

renderCurriculumTo(menuContent, false);

const topMenuDropdown = document.getElementById('top-menu-lessons-dropdown');
if (topMenuDropdown) {
    renderCurriculumTo(topMenuDropdown, false);
    const topMenuBtn = document.getElementById('top-menu-lesson-btn');
    const topMenuChevron = document.getElementById('top-menu-chevron');
    if (topMenuBtn) {
        topMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const isHidden = topMenuDropdown.classList.contains('hidden');
            if (isHidden) {
                topMenuDropdown.classList.remove('hidden');
                if (topMenuChevron) topMenuChevron.style.transform = 'rotate(180deg)';
            } else {
                topMenuDropdown.classList.add('hidden');
                if (topMenuChevron) topMenuChevron.style.transform = 'rotate(0deg)';
            }
        });
    }
}

document.addEventListener('click', (e) => {
    if (sidebar && !sidebar.contains(e.target) && !floatingBtn.contains(e.target) && sidebar.classList.contains('active')) {
        toggleMenu();
    }
    const topMenuDropdown = document.getElementById('top-menu-lessons-dropdown');
    const topMenuBtn = document.getElementById('top-menu-lesson-btn');
    const topMenuChevron = document.getElementById('top-menu-chevron');
    if (topMenuDropdown && topMenuBtn && !topMenuDropdown.contains(e.target) && !topMenuBtn.contains(e.target) && !topMenuDropdown.classList.contains('hidden')) {
        topMenuDropdown.classList.add('hidden');
        if (topMenuChevron) topMenuChevron.style.transform = 'rotate(0deg)';
    }
});
