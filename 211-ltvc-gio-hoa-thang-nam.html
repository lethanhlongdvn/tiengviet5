<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduRobot - Luyá»‡n tá»« vÃ  cÃ¢u lá»›p 5</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --primary: #4A90E2; --secondary: #F39C12; --correct: #2ED573; --wrong: #FF4757; --bg: #F0F7FF;
        }
        body { font-family: 'Quicksand', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .master-container { max-width: 900px; margin: 20px auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* Header & Navigation */
        .header { background: var(--primary); color: white; padding: 25px; text-align: center; }
        .header h1 { margin: 0; font-size: 1.6rem; text-transform: uppercase; }
        
        .tab-bar { display: flex; background: #f8f9fa; border-bottom: 1px solid #eee; }
        .tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; font-weight: bold; transition: 0.3s; color: #666; }
        .tab.active { background: white; color: var(--primary); border-top: 4px solid var(--primary); }

        .content-section { padding: 30px; display: none; min-height: 400px; }
        .content-section.active { display: block; }

        /* UI Components */
        .question-row { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 20px; margin-bottom: 20px; border-left: 5px solid var(--primary); position: relative; }
        .instruction { font-size: 0.95rem; color: #666; margin-bottom: 15px; font-style: italic; }

        /* BÃ i 1: Word selection */
        .sentence-content { font-size: 1.2rem; line-height: 2.2; margin-bottom: 15px; }
        .word { display: inline-block; padding: 0 6px; cursor: pointer; border-radius: 5px; transition: 0.2s; border-bottom: 2px solid transparent; }
        .word:hover { background: #f0f0f0; }
        .word.selected { background: #fff3cd; border-bottom-color: var(--secondary); }
        .word.is-correct { background: var(--correct) !important; color: white; }
        .word.is-wrong { background: var(--wrong) !important; color: white; }

        /* BÃ i 2: Dropdown & Slots */
        .slot { color: var(--secondary); font-weight: bold; border-bottom: 2px dashed var(--secondary); padding: 0 10px; transition: 0.3s; }
        select { padding: 8px; border-radius: 8px; border: 1px solid #ddd; font-family: inherit; margin: 0 10px; }

        /* BÃ i 3 & 4: Inputs */
        textarea, input[type="text"] { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-family: inherit; font-size: 1rem; margin-top: 10px; box-sizing: border-box; }
        .ai-feedback { margin-top: 15px; padding: 15px; border-radius: 10px; background: #f9f9f9; display: none; border-left: 4px solid var(--primary); }

        /* Buttons */
        .btn-group { display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; font-family: inherit; }
        .btn-check { background: var(--primary); color: white; }
        .btn-reset { background: #eee; color: #666; }
        .btn:active { transform: scale(0.95); }
        .status-msg { font-weight: bold; font-size: 0.9rem; margin-right: auto; align-self: center; }
    </style>
</head>
<body>

<div class="master-container">
    <div class="header">
        <h1>ğŸ¤– EduRobot: CÃ¡ch ná»‘i cÃ¡c váº¿ cÃ¢u ghÃ©p</h1>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="openTab(0)">BÃ i 1</div>
        <div class="tab" onclick="openTab(1)">BÃ i 2</div>
        <div class="tab" onclick="openTab(2)">BÃ i 3</div>
        <div class="tab" onclick="openTab(3)">BÃ i 4</div>
    </div>

    <div class="content-section active" id="sec-0">
        <p class="instruction">HÆ°á»›ng dáº«n: Em hÃ£y nháº¥n chá»n cÃ¡c cáº·p káº¿t tá»« trong má»—i cÃ¢u sau.</p>
        
        <div class="question-row" id="q1a" data-ans="Bá»Ÿi,nÃªn">
            <div class="sentence-content"><b>a.</b> <span>Bá»Ÿi</span> <span>tÃ´i</span> <span>Äƒn</span> <span>uá»‘ng</span> <span>Ä‘iá»u</span> <span>Ä‘á»™</span> <span>vÃ </span> <span>lÃ m</span> <span>viá»‡c</span> <span>cÃ³</span> <span>chá»«ng</span> <span>má»±c</span> <span>nÃªn</span> <span>tÃ´i</span> <span>chÃ³ng</span> <span>lá»›n</span> <span>láº¯m.</span></div>
            <div class="btn-group"><span class="status-msg"></span><button class="btn btn-reset" onclick="reset1('q1a')">LÃ m láº¡i</button><button class="btn btn-check" onclick="check1('q1a')">Kiá»ƒm tra</button></div>
        </div>

        <div class="question-row" id="q1b" data-ans="Máº·c dÃ¹,nhÆ°ng">
            <div class="sentence-content"><b>b.</b> <span>Máº·c dÃ¹</span> <span>chÃºng</span> <span>tÃ´i</span> <span>váº«n</span> <span>chÆ¡i</span> <span>vá»›i</span> <span>nhau</span> <span>nhÆ°ng</span> <span>thá»i</span> <span>gian</span> <span>Pam</span> <span>dÃ nh</span> <span>cho</span> <span>tÃ´i</span> <span>khÃ´ng</span> <span>cÃ²n</span> <span>nhiá»u.</span></div>
            <div class="btn-group"><span class="status-msg"></span><button class="btn btn-reset" onclick="reset1('q1b')">LÃ m láº¡i</button><button class="btn btn-check" onclick="check1('q1b')">Kiá»ƒm tra</button></div>
        </div>

        <div class="question-row" id="q1c" data-ans="Náº¿u,thÃ¬">
            <div class="sentence-content"><b>c.</b> <span>Náº¿u</span> <span>hoa</span> <span>mua</span> <span>cÃ³</span> <span>mÃ u</span> <span>tÃ­m</span> <span>há»“ng</span> <span>thÃ¬</span> <span>hoa</span> <span>sim</span> <span>tÃ­m</span> <span>nháº¡t,</span> <span>phÆ¡n</span> <span>phá»›t</span> <span>nhÆ°</span> <span>mÃ¡</span> <span>con</span> <span>gÃ¡i.</span></div>
            <div class="btn-group"><span class="status-msg"></span><button class="btn btn-reset" onclick="reset1('q1c')">LÃ m láº¡i</button><button class="btn btn-check" onclick="check1('q1c')">Kiá»ƒm tra</button></div>
        </div>
    </div>

    <div class="content-section" id="sec-1">
        <p class="instruction">HÆ°á»›ng dáº«n: Chá»n cáº·p tá»« hÃ´ á»©ng phÃ¹ há»£p Ä‘iá»n vÃ o bÃ´ng hoa.</p>
        
        <div class="question-row" id="q2a" data-ans="chÆ°a-Ä‘Ã£">
            <div class="sentence-content">a. NgÃ y <span class="slot">...</span> táº¯t háº³n, trÄƒng <span class="slot">...</span> lÃªn rá»“i.</div>
            <div class="btn-group">
                <select onchange="update2('q2a', this.value)">
                    <option value="">-- Chá»n cáº·p tá»« --</option>
                    <option value="Ä‘Ã¢u-Ä‘Ã³">Ä‘Ã¢u... Ä‘Ã³</option>
                    <option value="chÆ°a-Ä‘Ã£">chÆ°a... Ä‘Ã£</option>
                    <option value="bao nhiÃªu-báº¥y nhiÃªu">bao nhiÃªu... báº¥y nhiÃªu</option>
                </select>
                <button class="btn btn-check" onclick="check2('q2a')">Kiá»ƒm tra</button>
            </div>
        </div>

        <div class="question-row" id="q2b" data-ans="Ä‘Ã¢u-Ä‘Ã³">
            <div class="sentence-content">b. TrÄƒng Ä‘i Ä‘áº¿n <span class="slot">...</span>, lÅ©y tre Ä‘Æ°á»£c táº¯m Ä‘áº«m mÃ u sá»¯a Ä‘áº¿n <span class="slot">...</span>.</div>
            <div class="btn-group">
                <select onchange="update2('q2b', this.value)">
                    <option value="">-- Chá»n cáº·p tá»« --</option>
                    <option value="Ä‘Ã¢u-Ä‘Ã³">Ä‘Ã¢u... Ä‘Ã³</option>
                    <option value="chÆ°a-Ä‘Ã£">chÆ°a... Ä‘Ã£</option>
                    <option value="bao nhiÃªu-báº¥y nhiÃªu">bao nhiÃªu... báº¥y nhiÃªu</option>
                </select>
                <button class="btn btn-check" onclick="check2('q2b')">Kiá»ƒm tra</button>
            </div>
        </div>

        <div class="question-row" id="q2c" data-ans="bao nhiÃªu-báº¥y nhiÃªu">
            <div class="sentence-content">c. NÆ°á»›c dÃ¢ng lÃªn cao <span class="slot">...</span>, SÆ¡n Tinh láº¡i lÃ m cho Ä‘á»“i, nÃºi má»c cao lÃªn <span class="slot">...</span>.</div>
            <div class="btn-group">
                <select onchange="update2('q2c', this.value)">
                    <option value="">-- Chá»n cáº·p tá»« --</option>
                    <option value="Ä‘Ã¢u-Ä‘Ã³">Ä‘Ã¢u... Ä‘Ã³</option>
                    <option value="chÆ°a-Ä‘Ã£">chÆ°a... Ä‘Ã£</option>
                    <option value="bao nhiÃªu-báº¥y nhiÃªu">bao nhiÃªu... báº¥y nhiÃªu</option>
                </select>
                <button class="btn btn-check" onclick="check2('q2c')">Kiá»ƒm tra</button>
            </div>
        </div>
    </div>

    <div class="content-section" id="sec-2">
        <p class="instruction">HÆ°á»›ng dáº«n: Em hÃ£y viáº¿t tiáº¿p váº¿ cÃ¢u cÃ²n thiáº¿u Ä‘á»ƒ táº¡o thÃ nh cÃ¢u ghÃ©p.</p>
        <div class="question-box">
            <div class="question-row">
                <p><b>a.</b> VÃ o dá»‹p lá»… Má»«ng xuÃ¢n, cháº³ng nhá»¯ng tráº» em Ä‘Æ°á»£c vui Ä‘Ã¹a thoáº£ thÃ­ch mÃ ...</p>
                <input type="text" id="ai-3a" placeholder="Viáº¿t tiáº¿p vÃ o Ä‘Ã¢y...">
                <div class="btn-group"><button class="btn btn-check" onclick="askAI('3a')">EduRobot Cháº¥m BÃ i</button></div>
                <div class="ai-feedback" id="fb-3a"></div>
            </div>
            <div class="question-row">
                <p><b>b.</b> Máº·c dÃ¹ thiÃªn nhiÃªn kháº¯c nghiá»‡t nhÆ°ng...</p>
                <input type="text" id="ai-3b" placeholder="Viáº¿t tiáº¿p vÃ o Ä‘Ã¢y...">
                <div class="btn-group"><button class="btn btn-check" onclick="askAI('3b')">EduRobot Cháº¥m BÃ i</button></div>
                <div class="ai-feedback" id="fb-3b"></div>
            </div>
        </div>
    </div>

    <div class="content-section" id="sec-3">
        <p class="instruction">HÆ°á»›ng dáº«n: Em hÃ£y tá»± Ä‘áº·t cÃ¢u ghÃ©p theo cÃ¡c yÃªu cáº§u bÃªn dÆ°á»›i.</p>
        <div class="question-row">
            <p><b>a.</b> Sá»­ dá»¥ng cáº·p káº¿t tá»«: <b>VÃ¬... nÃªn...</b> (hoáº·c Bá»Ÿi... nÃªn..., Nhá»... mÃ ...)</p>
            <textarea id="ai-4a" rows="2" placeholder="Nháº­p cÃ¢u cá»§a em..."></textarea>
            <div class="btn-group"><button class="btn btn-check" onclick="askAI('4a')">EduRobot Cháº¥m BÃ i</button></div>
            <div class="ai-feedback" id="fb-4a"></div>
        </div>
        <div class="question-row">
            <p><b>c.</b> Sá»­ dá»¥ng cáº·p tá»« hÃ´ á»©ng: <b>vá»«a... Ä‘Ã£...</b>, <b>cÃ ng... cÃ ng...</b></p>
            <textarea id="ai-4c" rows="2" placeholder="Nháº­p cÃ¢u cá»§a em..."></textarea>
            <div class="btn-group"><button class="btn btn-check" onclick="askAI('4c')">EduRobot Cháº¥m BÃ i</button></div>
            <div class="ai-feedback" id="fb-4c"></div>
        </div>
    </div>
</div>

<script>
    // PhÃ³ng phÃ¡o hoa
    function celebrate() {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    // Chuyá»ƒn Tab
    function openTab(n) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === n));
        document.querySelectorAll('.content-section').forEach((s, i) => s.classList.toggle('active', i === n));
    }

    // Khá»Ÿi táº¡o BÃ i 1
    document.querySelectorAll('#sec-0 span').forEach(s => {
        s.classList.add('word');
        s.onclick = function() { 
            if(!this.closest('.question-row').classList.contains('locked')) this.classList.toggle('selected');
        }
    });

    function check1(id) {
        const row = document.getElementById(id);
        const ans = row.getAttribute('data-ans').split(',');
        const words = row.querySelectorAll('.word');
        let right = 0, totalAns = ans.length, error = false;

        words.forEach(w => {
            const txt = w.innerText.replace(/[.,]/g,"");
            if(w.classList.contains('selected')) {
                if(ans.includes(txt)) { w.classList.add('is-correct'); right++; }
                else { w.classList.add('is-wrong'); error = true; }
            } else if(ans.includes(txt)) { error = true; }
        });

        if(!error && right === totalAns) { celebrate(); row.classList.add('locked'); }
    }

    function reset1(id) {
        const row = document.getElementById(id);
        row.classList.remove('locked');
        row.querySelectorAll('.word').forEach(w => w.classList.remove('selected','is-correct','is-wrong'));
    }

    // BÃ i 2
    function update2(id, val) {
        const slots = document.getElementById(id).querySelectorAll('.slot');
        if(!val) { slots[0].innerText = "..."; slots[1].innerText = "..."; return; }
        const p = val.split('-');
        slots[0].innerText = p[0]; slots[1].innerText = p[1];
        slots.forEach(s => { s.style.color = "var(--secondary)"; s.style.borderBottomColor = "var(--secondary)"; });
    }

    function check2(id) {
        const row = document.getElementById(id);
        const sel = row.querySelector('select').value;
        const slots = row.querySelectorAll('.slot');
        if(sel === row.getAttribute('data-ans')) {
            slots.forEach(s => { s.style.color = "var(--correct)"; s.style.borderBottomColor = "var(--correct)"; });
            celebrate();
        } else {
            slots.forEach(s => { s.style.color = "var(--wrong)"; s.style.borderBottomColor = "var(--wrong)"; });
        }
    }

    // Giáº£ láº­p AI (Káº¿t ná»‘i backend sau)
    async function askAI(id) {
    const inputElem = document.getElementById('ai-' + id);
    const fbElem = document.getElementById('fb-' + id);
    const val = inputElem.value;
    
    // Tá»± Ä‘á»™ng láº¥y ná»™i dung yÃªu cáº§u Ä‘á» bÃ i tá»« tháº» <p> hoáº·c <b> phÃ­a trÃªn
    const promptText = inputElem.parentElement.querySelector('p').innerText;

    if(!val) return alert("Em hÃ£y viáº¿t cÃ¢u trÆ°á»›c khi nhá» EduRobot cháº¥m bÃ i nhÃ©!");

    fbElem.style.display = "block";
    fbElem.innerHTML = "âŒ› <b>EduRobot:</b> Äang Ä‘á»c bÃ i cá»§a em...";

    try {
        // Gá»i Ä‘áº¿n Netlify Function Ä‘Ã£ táº¡o á»Ÿ trÃªn
        const response = await fetch('/.netlify/functions/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                prompt: promptText,
                studentInput: val 
            })
        });
        
        const data = await response.json();
        
        if (data.feedback) {
            fbElem.innerHTML = `ğŸ¤– <b>EduRobot nháº­n xÃ©t:</b> ${data.feedback}`;
        } else {
            fbElem.innerHTML = `ğŸ¤– <b>EduRobot:</b> CÃ³ chÃºt trá»¥c tráº·c, em thá»­ láº¡i sau nhÃ©!`;
        }
    } catch (error) {
        console.error("Lá»—i:", error);
        fbElem.innerHTML = "ğŸ¤– <b>EduRobot:</b> KhÃ´ng thá»ƒ káº¿t ná»‘i vá»›i mÃ¡y chá»§ AI rá»“i!";
    }
}
</script>
</body>
</html>