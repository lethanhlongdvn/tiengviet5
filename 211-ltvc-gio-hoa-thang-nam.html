<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cách nối các vế câu ghép - EduRobot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --accent: #f59e0b;
            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        .hidden {
            display: none !important;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
        }

        .bg-paper {
            background-color: #fdfbf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .tab-btn.active {
            color: var(--primary);
            background: white;
            box-shadow: inset 0 -3px 0 var(--primary);
        }

        .tab-content {
            display: none !important;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content.active {
            display: block !important;
        }

        #tab-quiz.active {
            display: flex !important;
        }

        #quiz-container {
            height: calc(100vh - 180px);
            max-height: 600px;
        }

        .option-btn:hover:not(:disabled) {
            transform: translateX(4px);
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .accordion-open .accordion-content {
            max-height: 1000px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(8px);
            z-index: 1000;
            padding: 1rem;
        }

        .modal.active {
            display: flex !important;
            align-items: center;
            justify-content: center;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .word {
            display: inline-block;
            padding: 2px 8px;
            margin: 0 2px;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .word:hover {
            background-color: #e0f2fe;
        }

        .word.selected {
            background-color: #fef3c7;
            border-color: #f59e0b;
        }

        .word.is-correct {
            background-color: #86efac !important;
            color: #064e3b;
            border-color: #22c55e;
        }

        .word.is-wrong {
            background-color: #fca5a5 !important;
            color: #7f1d1d;
            border-color: #ef4444;
        }

        .slot {
            border-bottom: 2px dashed #f59e0b;
            color: #f59e0b;
            font-weight: bold;
            padding: 0 5px;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">
    <header class="sticky top-0 z-50 px-4 py-2">
        <nav class="container mx-auto glass-card rounded-xl px-5 py-2 flex justify-between items-center shadow-lg">
            <div class="flex items-center space-x-4">
                <div
                    class="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200 shrink-0">
                    <span class="text-xl font-black">E</span>
                </div>
                <div class="flex flex-col md:flex-row md:items-center md:space-x-6">
                    <div class="flex items-center space-x-3"><span
                            class="text-2xl font-black text-blue-700">EduRobot</span><span
                            class="text-[11px] font-bold px-3 py-1 rounded-full bg-orange-500 text-white shadow-sm shadow-orange-200 tracking-wide whitespace-nowrap">TIẾNG
                            VIỆT 5</span></div>
                    <div class="flex items-center space-x-2 overflow-hidden"><span
                            class="text-[11px] font-black uppercase tracking-widest text-gray-400 whitespace-nowrap">CHỦ
                            ĐIỂM:</span><span
                            class="text-sm font-black uppercase tracking-wider text-blue-800 truncate max-w-[180px] md:max-w-none">GIÓ
                            HÒA THÁNG NĂM</span></div>
                </div>
            </div>
            <ul class="flex space-x-2 md:space-x-6 text-xs font-bold items-center relative">
                <li><a href="index.html"
                        class="flex items-center text-gray-500 hover:text-blue-600 transition-colors py-2">Trang chủ</a>
                </li>
                <li class="relative group">
                    <button id="top-menu-lesson-btn"
                        class="flex items-center text-gray-500 hover:text-blue-600 transition-colors focus:outline-none py-2">Bài
                        học <svg class="w-4 h-4 ml-1 transition-transform duration-200" id="top-menu-chevron"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg></button>
                    <div id="top-menu-lessons-dropdown"
                        class="absolute top-full right-[-100px] md:right-auto md:left-1/2 md:-translate-x-1/2 mt-4 w-[320px] bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/50 hidden max-h-[70vh] overflow-y-auto z-[60] p-2">
                    </div>
                </li>
                <li><button onclick="openTeacherStats()"
                        class="text-gray-500 hover:text-blue-600 transition-colors py-2">Giáo viên</button></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-2">
        <div class="glass-card mb-4 rounded-2xl overflow-hidden flex flex-col md:flex-row items-stretch shadow-lg">
            <div class="flex-1 flex bg-white/40">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-4 text-center font-black text-base text-gray-400 transition-all border-r border-gray-100/50 uppercase tracking-wider">1.
                    Bài học & Vận dụng</button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-4 text-center font-black text-base text-gray-400 transition-all uppercase tracking-wider">2.
                    Trắc nghiệm</button>
            </div>
        </div>

        <!-- TAB 1: BÀI HỌC -->
        <div id="tab-lesson" class="tab-content active">
            <div class="max-w-5xl mx-auto space-y-4">
                <!-- Theory & Instruction -->
                <section class="w-full space-y-4">
                    <!-- Ghi nhớ Section -->
                    <div
                        class="glass-card rounded-[24px] p-6 bg-orange-50/50 border-l-8 border-orange-400 relative overflow-hidden shadow-lg">
                        <div class="absolute -top-2 left-4 text-gray-400">
                            <svg class="w-10 h-10 transform rotate-12" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13">
                                </path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-black text-orange-700 mb-4 ml-8">Ghi nhớ</h2>
                        <div class="serif-font text-gray-800 text-lg leading-relaxed space-y-4">
                            <p>Các vế của câu ghép có thể nối với nhau bằng các cặp từ:</p>
                            <ul class="list-none space-y-3 pl-4">
                                <li class="flex items-start">
                                    <span class="mr-2">–</span>
                                    <span>Các cặp kết từ: <em>vì ... nên ..., bởi ... nên ..., nhờ ... nên (mà) ..., nếu
                                            ... thì ..., hễ ... thì ..., giá ... thì ..., tuy ... nhưng ..., mặc dù ...
                                            nhưng ..., dù ... nhưng ..., chẳng những ... mà ..., không chỉ ... mà
                                            ...,...</em></span>
                                </li>
                                <li class="flex items-start">
                                    <span class="mr-2">–</span>
                                    <span>Các cặp từ hô ứng: <em>vừa ... đã ..., chưa ... đã ..., càng ... càng ..., đâu
                                            ... đó ..., bao nhiêu ... bấy nhiêu ...,...</em></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Interactive Exercise 1 -->
                <div class="glass-card rounded-[24px] p-4 shadow-lg border-l-8 border-blue-500">
                    <h3 class="font-black text-xl text-gray-800 mb-2 flex items-center"><span
                            class="bg-blue-100 text-blue-600 rounded-lg px-3 py-1 text-sm mr-3">Bài 1</span> Tìm cặp
                        kết từ (Quan hệ từ)</h3>
                    <p class="text-sm text-gray-500 mb-4 italic">Em hãy bấm chọn vào các từ nối trong câu.</p>

                    <div class="space-y-2">
                        <div class="p-4 bg-white/60 rounded-xl flex items-start sm:items-center justify-between gap-4"
                            id="q1a" data-ans="Bởi,nên">
                            <p class="text-lg leading-loose font-medium select-none sentence-content flex-1">
                                <span>a.</span> <span class="word">Bởi</span> <span class="word">tôi</span> <span
                                    class="word">ăn</span> <span class="word">uống</span> <span class="word">điều</span>
                                <span class="word">độ</span> <span class="word">và</span> <span class="word">làm</span>
                                <span class="word">việc</span> <span class="word">có</span> <span
                                    class="word">chừng</span> <span class="word">mực</span> <span
                                    class="word">nên</span> <span class="word">tôi</span> <span
                                    class="word">chóng</span> <span class="word">lớn</span> <span
                                    class="word">lắm.</span>
                            </p>
                            <div class="flex gap-2 shrink-0">
                                <button onclick="check1('q1a')"
                                    class="bg-blue-600 hover:bg-blue-700 text-white w-9 h-9 rounded-lg flex items-center justify-center shadow-md transition-all"
                                    title="Kiểm tra">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </button>
                                <button onclick="reset1('q1a')"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-600 w-9 h-9 rounded-lg flex items-center justify-center transition-all"
                                    title="Làm lại">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="p-4 bg-white/60 rounded-xl flex items-start sm:items-center justify-between gap-4"
                            id="q1b" data-ans="Mặc dù,nhưng">
                            <p class="text-lg leading-loose font-medium select-none sentence-content flex-1">
                                <span>b.</span> <span class="word">Mặc dù</span> <span class="word">chúng</span>
                                <span class="word">tôi</span> <span class="word">vẫn</span> <span
                                    class="word">chơi</span> <span class="word">với</span> <span
                                    class="word">nhau</span> <span class="word">nhưng</span> <span
                                    class="word">thời</span> <span class="word">gian</span> <span
                                    class="word">Pam</span> <span class="word">dành</span> <span class="word">cho</span>
                                <span class="word">tôi</span> <span class="word">không</span> <span
                                    class="word">còn</span> <span class="word">nhiều.</span>
                            </p>
                            <div class="flex gap-2 shrink-0">
                                <button onclick="check1('q1b')"
                                    class="bg-blue-600 hover:bg-blue-700 text-white w-9 h-9 rounded-lg flex items-center justify-center shadow-md transition-all"
                                    title="Kiểm tra">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </button>
                                <button onclick="reset1('q1b')"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-600 w-9 h-9 rounded-lg flex items-center justify-center transition-all"
                                    title="Làm lại">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="p-4 bg-white/60 rounded-xl flex items-start sm:items-center justify-between gap-4"
                            id="q1c" data-ans="Nếu,thì">
                            <p class="text-lg leading-loose font-medium select-none sentence-content flex-1">
                                <span>c.</span> <span class="word">Nếu</span> <span class="word">hoa</span> <span
                                    class="word">mua</span> <span class="word">có</span> <span class="word">màu</span>
                                <span class="word">tím</span> <span class="word">hồng</span> <span
                                    class="word">thì</span> <span class="word">hoa</span> <span class="word">sim</span>
                                <span class="word">tím</span> <span class="word">nhạt,</span> <span
                                    class="word">phơn</span> <span class="word">phớt</span> <span
                                    class="word">như</span> <span class="word">má</span> <span class="word">con</span>
                                <span class="word">gái.</span>
                            </p>
                            <div class="flex gap-2 shrink-0">
                                <button onclick="check1('q1c')"
                                    class="bg-blue-600 hover:bg-blue-700 text-white w-9 h-9 rounded-lg flex items-center justify-center shadow-md transition-all"
                                    title="Kiểm tra">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </button>
                                <button onclick="reset1('q1c')"
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-600 w-9 h-9 rounded-lg flex items-center justify-center transition-all"
                                    title="Làm lại">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                </section>

                <!-- Exercise 2, 3, 4 -->
                <section class="w-full space-y-4">
                    <!-- Execercise 2 -->
                    <div class="glass-card rounded-[24px] p-4 shadow-lg border-l-8 border-orange-400">
                        <h3 class="font-black text-xl text-gray-800 mb-3 flex items-center"><span
                                class="bg-orange-100 text-orange-600 rounded-lg px-3 py-1 text-sm mr-3">Bài 2</span>
                            Điền từ hô ứng</h3>

                        <div class="space-y-3 text-gray-700">
                            <div class="p-4 border border-orange-100 rounded-xl bg-orange-50/50 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"
                                id="q2a" data-ans="chưa-đã">
                                <p class="flex-1 text-lg">a. Ngày <span class="slot mx-1">...</span> tắt hẳn, trăng
                                    <span class="slot mx-1">...</span> lên rồi.
                                </p>
                                <div class="flex gap-2 shrink-0 w-full sm:w-auto">
                                    <select
                                        class="flex-1 sm:w-48 p-3 rounded-lg border border-gray-200 text-base font-bold bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"
                                        onchange="update2('q2a', this.value)">
                                        <option value="">-- Chọn --</option>
                                        <option value="đâu-đó">đâu... đó</option>
                                        <option value="chưa-đã">chưa... đã</option>
                                        <option value="bao nhiêu-bấy nhiêu">bao nhiêu... bấy nhiêu</option>
                                    </select>
                                    <button onclick="check2('q2a')"
                                        class="bg-orange-500 text-white w-12 h-12 flex items-center justify-center rounded-lg font-black shadow hover:bg-orange-600 transition-all">✓</button>
                                </div>
                            </div>

                            <div class="p-4 border border-orange-100 rounded-xl bg-orange-50/50 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"
                                id="q2b" data-ans="đâu-đó">
                                <p class="flex-1 text-lg">b. Trăng đi đến <span class="slot mx-1">...</span>, lũy tre
                                    được tắm
                                    đẫm màu sữa đến <span class="slot mx-1">...</span>.</p>
                                <div class="flex gap-2 shrink-0 w-full sm:w-auto">
                                    <select
                                        class="flex-1 sm:w-48 p-3 rounded-lg border border-gray-200 text-base font-bold bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"
                                        onchange="update2('q2b', this.value)">
                                        <option value="">-- Chọn --</option>
                                        <option value="đâu-đó">đâu... đó</option>
                                        <option value="chưa-đã">chưa... đã</option>
                                        <option value="bao nhiêu-bấy nhiêu">bao nhiêu... bấy nhiêu</option>
                                    </select>
                                    <button onclick="check2('q2b')"
                                        class="bg-orange-500 text-white w-12 h-12 flex items-center justify-center rounded-lg font-black shadow hover:bg-orange-600 transition-all">✓</button>
                                </div>
                            </div>

                            <div class="p-4 border border-orange-100 rounded-xl bg-orange-50/50 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4"
                                id="q2c" data-ans="bao nhiêu-bấy nhiêu">
                                <p class="flex-1 text-lg">c. Nước dâng lên cao <span class="slot mx-1">...</span>, Sơn
                                    Tinh lại
                                    làm cho đồi, núi mọc cao lên <span class="slot mx-1">...</span>.</p>
                                <div class="flex gap-2 shrink-0 w-full sm:w-auto">
                                    <select
                                        class="flex-1 sm:w-48 p-3 rounded-lg border border-gray-200 text-base font-bold bg-white focus:ring-2 focus:ring-orange-400 focus:outline-none"
                                        onchange="update2('q2c', this.value)">
                                        <option value="">-- Chọn --</option>
                                        <option value="đâu-đó">đâu... đó</option>
                                        <option value="chưa-đã">chưa... đã</option>
                                        <option value="bao nhiêu-bấy nhiêu">bao nhiêu... bấy nhiêu</option>
                                    </select>
                                    <button onclick="check2('q2c')"
                                        class="bg-orange-500 text-white w-12 h-12 flex items-center justify-center rounded-lg font-black shadow hover:bg-orange-600 transition-all">✓</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise 3 -->
                    <div class="glass-card rounded-[24px] p-4 shadow-lg border-l-8 border-purple-500 API-box">
                        <h3 class="font-black text-xl text-gray-800 mb-3 flex items-center"><span
                                class="bg-purple-100 text-purple-600 rounded-lg px-3 py-1 text-sm mr-3">Bài 3</span>
                            Viết tiếp vế câu</h3>
                        <div class="space-y-3">
                            <div class="p-4 bg-white/60 rounded-xl flex flex-col gap-4">
                                <div
                                    class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                    <p class="text-lg font-bold text-gray-700 flex-1">a. Vào dịp lễ Mừng xuân, chẳng
                                        những
                                        trẻ em được vui đùa thoả thích mà...</p>
                                    <div class="flex gap-2 w-full sm:w-auto items-center">
                                        <input type="text" id="ai-3a" placeholder="Viết tiếp..."
                                            class="flex-1 sm:w-72 px-5 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-purple-500 focus:outline-none text-base">
                                        <button
                                            onclick="askAI('3a', 'Vào dịp lễ Mừng xuân, chẳng những trẻ em được vui đùa thoả thích mà')"
                                            class="bg-purple-600 text-white w-12 h-12 flex items-center justify-center rounded-lg text-sm hover:bg-purple-700 transition-all font-black shadow-md">✓</button>
                                    </div>
                                </div>
                                <div class="ai-feedback hidden p-4 bg-purple-50 text-purple-800 text-base rounded-lg"
                                    id="fb-3a"></div>
                            </div>
                            <div class="p-4 bg-white/60 rounded-xl flex flex-col gap-4">
                                <div
                                    class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                    <p class="text-lg font-bold text-gray-700 flex-1">b. Mặc dù thiên nhiên khắc nghiệt
                                        nhưng...</p>
                                    <div class="flex gap-2 w-full sm:w-auto items-center">
                                        <input type="text" id="ai-3b" placeholder="Viết tiếp..."
                                            class="flex-1 sm:w-72 px-5 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-purple-500 focus:outline-none text-base">
                                        <button onclick="askAI('3b', 'Mặc dù thiên nhiên khắc nghiệt nhưng')"
                                            class="bg-purple-600 text-white w-12 h-12 flex items-center justify-center rounded-lg text-sm hover:bg-purple-700 transition-all font-black shadow-md">✓</button>
                                    </div>
                                </div>
                                <div class="ai-feedback hidden p-4 bg-purple-50 text-purple-800 text-base rounded-lg"
                                    id="fb-3b"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Exercise 4 (New) -->
                    <div class="glass-card rounded-[24px] p-4 shadow-lg border-l-8 border-green-500 API-box">
                        <h3 class="font-black text-xl text-gray-800 mb-3 flex items-center"><span
                                class="bg-green-100 text-green-600 rounded-lg px-3 py-1 text-sm mr-3">Bài 4</span> Đặt
                            câu ghép</h3>
                        <div class="space-y-3">
                            <div class="p-4 bg-white/60 rounded-xl flex flex-col gap-4">
                                <div
                                    class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                    <p class="text-lg font-bold text-gray-700 flex-1">a. Sử dụng cặp kết từ: <b>Vì...
                                            nên...</b> (hoặc Bởi... nên..., Nhờ... mà...)</p>
                                    <div class="flex gap-2 w-full sm:w-auto items-center">
                                        <input type="text" id="ai-4a" placeholder="Đặt câu..."
                                            class="flex-1 sm:w-72 px-5 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:outline-none text-base">
                                        <button onclick="askAI('4a')"
                                            class="bg-green-600 text-white w-12 h-12 flex items-center justify-center rounded-lg text-sm hover:bg-green-700 transition-all font-black shadow-md">✓</button>
                                    </div>
                                </div>
                                <div class="ai-feedback hidden p-4 bg-green-50 text-green-800 text-base rounded-lg"
                                    id="fb-4a"></div>
                            </div>
                            <div class="p-4 bg-white/60 rounded-xl flex flex-col gap-4">
                                <div
                                    class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                                    <p class="text-lg font-bold text-gray-700 flex-1">c. Sử dụng cặp từ hô ứng:
                                        <b>vừa...
                                            đã...</b>, <b>càng... càng...</b>
                                    </p>
                                    <div class="flex gap-2 w-full sm:w-auto items-center">
                                        <input type="text" id="ai-4c" placeholder="Đặt câu..."
                                            class="flex-1 sm:w-72 px-5 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-green-500 focus:outline-none text-base">
                                        <button onclick="askAI('4c')"
                                            class="bg-green-600 text-white w-12 h-12 flex items-center justify-center rounded-lg text-sm hover:bg-green-700 transition-all font-black shadow-md">✓</button>
                                    </div>
                                </div>
                                <div class="ai-feedback hidden p-4 bg-green-50 text-green-800 text-base rounded-lg"
                                    id="fb-4c"></div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- TAB 2: TRẮC NGHIỆM -->
        <div id="tab-quiz" class="tab-content">
            <div
                class="max-w-4xl mx-auto glass-card rounded-[40px] shadow-2xl overflow-hidden flex flex-col min-h-[500px] w-full">
                <!-- Registration -->
                <div id="quiz-registration" class="p-4 md:p-8 flex-grow flex flex-col justify-center overflow-auto">
                    <div class="text-center mb-6">
                        <div
                            class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center text-white mb-4 shadow-xl shadow-blue-200 mx-auto transform -rotate-3">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                </path>
                            </svg>
                        </div>
                        <h2 class="text-2xl font-black text-gray-800 mb-1 tracking-tight">Đăng ký luyện tập</h2>
                        <p class="text-xs text-gray-400 font-bold uppercase tracking-widest">Cách nối các vế câu ghép
                        </p>
                    </div>
                    <form onsubmit="startQuiz(event)" class="w-full max-w-sm mx-auto space-y-4">
                        <input type="text" id="studentName" required placeholder="Họ và tên của em"
                            class="w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold placeholder:text-gray-300 shadow-sm">
                        <div class="grid grid-cols-2 gap-4">
                            <select id="studentClass" required
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm cursor-pointer">
                                <option value="">Chọn Lớp</option>
                                <option value="5/1">5/1</option>
                                <option value="5/2">5/2</option>
                                <option value="5/3">5/3</option>
                                <option value="5/4">5/4</option>
                                <option value="5/5">5/5</option>
                            </select>
                            <select id="schoolSelect" required onchange="checkSchool()"
                                class="px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white focus:outline-none transition-all font-bold text-gray-700 shadow-sm cursor-pointer">
                                <option value="Tiểu học Đỗ Văn Nại">TH Đỗ Văn Nại</option>
                                <option value="Khác">Trường khác...</option>
                            </select>
                        </div>
                        <input type="text" id="otherSchool" placeholder="Tên trường của em"
                            class="hidden w-full px-6 py-4 rounded-2xl bg-gray-50 border-2 border-transparent focus:border-blue-500 focus:bg-white transition-all font-bold shadow-sm">
                        <button type="submit"
                            class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-base uppercase tracking-wider">Bắt
                            đầu luyện tập</button>
                    </form>
                </div>

                <!-- Quiz Engine -->
                <div id="quiz-container" class="hidden flex-grow flex flex-col">
                    <div class="bg-blue-600/5 px-6 py-4 flex justify-between items-center border-b border-blue-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black mr-4 shadow-lg shadow-blue-200"
                                id="questionNum">1</div>
                            <div class="flex flex-col"><span
                                    class="text-[10px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1"
                                    id="progressText">CÂU TRẮC NGHIỆM: 1/5</span><span
                                    class="text-xs text-gray-400 font-bold leading-none">Cách nối các vế câu ghép</span>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 flex-grow flex flex-col justify-center overflow-auto">
                        <h3 class="text-xl md:text-2xl font-black text-gray-800 mb-6 leading-tight transition-all"
                            id="questionText">Nội dung?</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="optionsArea"></div>
                    </div>
                    <div class="px-6 py-4 border-t border-gray-50 flex justify-between items-center bg-gray-50/50">
                        <span class="text-xs font-bold text-gray-400 italic">* Chọn đáp án đúng nhất</span>
                        <button id="nextBtn" disabled
                            class="bg-blue-600 disabled:opacity-30 hover:bg-blue-700 text-white font-black py-3 px-10 rounded-2xl shadow-lg shadow-blue-100 transition-all active:scale-95 uppercase text-sm tracking-widest">Câu
                            tiếp theo</button>
                    </div>
                </div>

                <!-- Results -->
                <div id="quiz-results"
                    class="hidden p-8 flex-grow flex flex-col items-center justify-center text-center">
                    <div class="relative w-40 h-40 mb-8"><svg class="w-full h-full transform -rotate-90">
                            <circle cx="80" cy="80" r="74" stroke="currentColor" stroke-width="12" fill="transparent"
                                class="text-gray-100" />
                            <circle id="scoreCircle" cx="80" cy="80" r="74" stroke="blue" stroke-width="12"
                                fill="transparent" class="transition-all duration-1000 ease-out"
                                stroke-dasharray="0, 465" stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center"><span
                                class="text-5xl font-black text-gray-800" id="scoreText">0</span><span
                                class="text-[10px] text-gray-400 font-black uppercase tracking-[0.2em] mt-1">Điểm
                                số</span></div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10 max-w-sm font-bold" id="resultMsg">Em đã nỗ lực hết mình!</p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-md"><button onclick="restartQuiz()"
                            class="bg-white hover:bg-gray-50 text-gray-700 font-black py-4 rounded-2xl border-2 border-gray-100 transition-all shadow-sm">LÀM
                            LẠI</button><button onclick="submitResults(event)"
                            class="bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-100 transition-all">NỘP
                            KẾT QUẢ</button></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Teacher Stats -->
    <div id="statsModal" class="modal">
        <div
            class="bg-white rounded-[40px] w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl m-4 transform transition-all">
            <div class="p-8 border-b flex justify-between items-center bg-gray-50/50 backdrop-blur-xl">
                <div class="flex items-center space-x-4">
                    <div
                        class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-blue-200">
                        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                            </path>
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-2xl font-black text-gray-800 tracking-tight">Bảng kết quả</h2>
                        <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-1">Dành riêng cho giáo
                            viên</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3"><button onclick="exportToExcel()"
                        class="bg-green-600 hover:bg-green-700 text-white font-black py-3 px-6 rounded-2xl text-sm flex items-center shadow-lg shadow-green-100 transition-all active:scale-95">XUẤT
                        EXCEL</button><button onclick="closeModal()"
                        class="w-12 h-12 flex items-center justify-center text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-2xl transition-all">X</button>
                </div>
            </div>
            <div class="flex-grow overflow-auto p-8 bg-gray-50/30">
                <table class="w-full">
                    <thead>
                        <tr
                            class="text-left text-gray-400 uppercase text-[10px] font-black tracking-[0.2em] border-b-2 border-gray-100 pb-4">
                            <th class="px-6 py-4">STT</th>
                            <th class="px-6 py-4">Họ và Tên</th>
                            <th class="px-6 py-4">Lớp</th>
                            <th class="px-6 py-4">Trường</th>
                            <th class="px-6 py-4 text-center">Điểm</th>
                            <th class="px-6 py-4 text-center">Lần</th>
                            <th class="px-6 py-4 text-center">Thời gian</th>
                            <th class="px-6 py-4 text-right">Hoàn thành</th>
                        </tr>
                    </thead>
                    <tbody id="statsTableBody" class="divide-y divide-gray-100"></tbody>
                    <!-- Success Modal -->
                    <div id="successModal"
                        class="success-modal hidden fixed inset-0 z-[200] flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4">
                        <div
                            class="success-card glass-card rounded-[40px] p-10 max-w-sm w-full text-center shadow-3xl border-white/50 relative">
                            <div
                                class="w-24 h-24 bg-gradient-to-br from-green-400 to-emerald-600 rounded-3xl flex items-center justify-center text-white mx-auto mb-8 shadow-xl shadow-green-100 transform rotate-6 scale-110">
                                <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                        d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <h2 class="text-3xl font-black text-gray-800 mb-2 tracking-tight">Thành công!</h2>
                            <p class="text-gray-500 mb-10 font-bold leading-relaxed">Em đã hoàn thành xuất sắc!</p>
                            <button onclick="closeSuccessModal()"
                                class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-black py-4 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 uppercase tracking-widest text-sm">Đóng</button>
                        </div>
                    </div>

                </table>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-3 px-4 bg-white/30 backdrop-blur-md border-t border-white/50 w-full z-10 flex-none mt-6">
        <div class="container mx-auto text-center">
            <p class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em] mb-2">@ 2026 EduRobot - Hệ thống
                học tập thông minh</p>
            <p class="text-xs font-bold text-blue-600 flex items-center justify-center">
                Phát triển bởi Lê Thành Long
            </p>
        </div>
    </footer>

    <script src="js/floating-menu.js"></script>
    <script src="js/ai-grader.js?v=2"></script>
    <script>
        function celebrate() { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } }); }
        function switchTab(t) { document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active')); document.getElementById('btn-' + t).classList.add('active'); document.getElementById('tab-' + t).classList.add('active'); }

        // Exercise 1 Logic
        document.querySelectorAll('.word').forEach(s => {
            s.onclick = function () { if (!this.closest('.locked')) this.classList.toggle('selected'); }
        });
        function check1(id) {
            const row = document.getElementById(id);
            const ans = row.getAttribute('data-ans').split(',');
            const words = row.querySelectorAll('.word');
            let right = 0, error = false;
            words.forEach(w => {
                const txt = w.innerText.replace(/[.,]/g, "");
                if (w.classList.contains('selected')) { if (ans.includes(txt)) { w.classList.add('is-correct'); right++; } else { w.classList.add('is-wrong'); error = true; } }
            });
            if (!error && right === ans.length) { celebrate(); row.classList.add('locked'); }
        }
        function reset1(id) {
            const row = document.getElementById(id);
            row.classList.remove('locked');
            row.querySelectorAll('.word').forEach(w => w.classList.remove('selected', 'is-correct', 'is-wrong'));
        }

        // Exercise 2 Logic
        function update2(id, val) {
            const slots = document.getElementById(id).querySelectorAll('.slot');
            if (!val) { slots[0].innerText = "..."; slots[1].innerText = "..."; return; }
            const p = val.split('-');
            slots[0].innerText = p[0]; slots[1].innerText = p[1];
            slots.forEach(s => { s.style.color = "#f59e0b"; s.style.borderBottomColor = "#f59e0b"; });
        }
        function check2(id) {
            const row = document.getElementById(id);
            const sel = row.querySelector('select').value;
            const slots = row.querySelectorAll('.slot');
            if (sel === row.getAttribute('data-ans')) {
                slots.forEach(s => { s.style.color = "#22c55e"; s.style.borderBottomColor = "#22c55e"; });
                celebrate();
            } else {
                slots.forEach(s => { s.style.color = "#ef4444"; s.style.borderBottomColor = "#ef4444"; });
            }
        }

        // Quiz Logic
        const quizBank = {
            cat1: [
                { q: "Cặp quan hệ từ trong câu: 'Bởi tôi ăn uống điều độ nên tôi chóng lớn lắm.' là?", a: ["Bởi... nên...", "Vì... nên...", "Nếu... thì...", "Tuy... nhưng..."], c: 0 },
                { q: "Câu 'Mặc dù chúng tôi vẫn chơi với nhau nhưng thời gian dành cho nhau không còn nhiều' có cặp từ nối nào?", a: ["Mặc dù... nhưng...", "Vì... nên...", "Tuy... nhưng...", "Chẳng những... mà còn..."], c: 0 },
                { q: "Tìm cặp quan hệ từ trong: 'Nếu hoa mua có màu tím hồng thì hoa sim tím nhạt.'", a: ["Nếu... thì...", "Vì... nên...", "Hễ... thì...", "Nhờ... mà..."], c: 0 },
                { q: "Cặp quan hệ từ 'Tuy... nhưng...' xuất hiện trong câu nào?", a: ["Tuy rét nhưng Lan vẫn đi học.", "Lan đi học vì trời không mưa.", "Hễ trời mưa thì Lan nghỉ.", "Lan và Huệ đi học."], c: 0 },
                { q: "Trong câu 'Chẳng những bạn Lan học giỏi mà bạn ấy còn hát hay', cặp từ nối là gì?", a: ["Chẳng những... mà còn...", "Không những... mà còn...", "Vì... nên...", "Nhờ... mà..."], c: 0 }
            ],
            cat2: [
                { q: "Điền cặp từ hô ứng: 'Ngày ____ tắt hẳn, trăng ____ lên rồi.'", a: ["chưa... đã...", "vừa... đã...", "mới... đã...", "đâu... đấy..."], c: 0 },
                { q: "Điền cặp từ: 'Trăng đi đến ____, lũy tre được tắm đẫm màu sữa đến ____.'", a: ["đâu... đó...", "đâu... đấy...", "nào... ấy...", "bao nhiêu... bấy nhiêu..."], c: 0 },
                { q: "Điền cặp từ: 'Nước dâng lên cao ____, Sơn Tinh lại làm cho đồi, núi mọc cao lên ____.'", a: ["bao nhiêu... bấy nhiêu...", "vừa... đã...", "càng... càng...", "đâu... đấy..."], c: 0 },
                { q: "Điền cặp từ: 'Trời ____ hửng sáng, nông dân ____ ra đồng.'", a: ["vừa... đã...", "mới... đã...", "càng... càng...", "đâu... đấy..."], c: 0 },
                { q: "Điền cặp từ: 'Gió ____ to, con thuyền ____ lướt nhanh trên mặt biển.'", a: ["càng... càng...", "bao nhiêu... bấy nhiêu...", "đâu... đấy...", "vừa... đã..."], c: 0 }
            ],
            cat3: [
                { q: "Hoàn thành câu: 'Vào dịp lễ Mừng xuân, chẳng những trẻ em được vui đùa thoả thích mà...'", a: ["người già cũng thấy ấm lòng.", "các em đi học.", "hoa mai nở rộ.", "trời nắng to."], c: 0 },
                { q: "Hoàn thành câu: 'Mặc dù thiên nhiên khắc nghiệt nhưng...'", a: ["cây cối vẫn xanh tươi.", "bão sắp đến.", "trời mưa to.", "đất đai khô cằn."], c: 0 },
                { q: "Hoàn thành câu: 'Nếu chúng ta không bảo vệ môi trường thì...'", a: ["cuộc sống sẽ bị ảnh hưởng nghiêm trọng.", "cây cối sẽ xanh tươi.", "không khí trong lành.", "chim chóc ca hát."], c: 0 },
                { q: "Hoàn thành câu: 'Tuy Lan không thông minh bằng các bạn nhưng...'", a: ["Lan rất cần cù, chịu khó.", "Lan học rất giỏi.", "Lan đi học muộn.", "Lan thích vẽ tranh."], c: 0 },
                { q: "Hoàn thành câu: 'Vì bạn Nam tích cực luyện tập nên...'", a: ["bạn ấy đã giành giải nhất.", "bạn ấy bị mệt.", "bạn ấy đi ngủ sớm.", "bạn ấy không đi học."], c: 0 }
            ],
            cat4: [
                { q: "Câu ghép 'Trăng lên, gió mơn man cây cỏ' được nối bằng cách nào?", a: ["Nối trực tiếp (dấu phẩy)", "Quan hệ từ", "Cặp từ hô ứng", "Cặp quan hệ từ"], c: 0 },
                { q: "Câu 'Mặt biển càng rộng, con tàu càng nhỏ bé' biểu thị quan hệ gì?", a: ["Tăng tiến (Tương ứng)", "Nguyên nhân", "Tương phản", "Giả thiết"], c: 0 },
                { q: "Trong câu ghép, các vế câu phải có quan hệ như thế nào?", a: ["Chặt chẽ về ý nghĩa", "Không liên quan gì nhau", "Chỉ cần nối bằng dấu câu", "Chỉ cần có từ nối"], c: 0 },
                { q: "Câu nào dưới đây là câu ghép nối bằng quan hệ từ?", a: ["Mưa to nên đường trơn.", "Đường trơn như đổ mỡ.", "Trời mưa, đường trơn.", "Mưa rơi tí tách."], c: 0 },
                { q: "Cặp từ 'bao nhiêu... bấy nhiêu' thuộc loại từ gì?", a: ["Cặp từ hô ứng", "Quan hệ từ đơn", "Cặp quan hệ từ", "Tính từ"], c: 0 }
            ]
        };
        let selectedQuestions = [], score = 0, currentIdx = 0;
        function shuffle(array) { return array.sort(() => Math.random() - 0.5); }
        function checkSchool() { document.getElementById('otherSchool').classList.toggle('hidden', document.getElementById('schoolSelect').value !== 'Khác'); }
        function startQuiz(e) {
            e.preventDefault();
            // Pick 2 random questions from each category
            selectedQuestions = [
                ...shuffle([...quizBank.cat1]).slice(0, 2),
                ...shuffle([...quizBank.cat2]).slice(0, 2),
                ...shuffle([...quizBank.cat3]).slice(0, 2),
                ...shuffle([...quizBank.cat4]).slice(0, 2)
            ];
            shuffle(selectedQuestions); // Shuffle the combined list
            currentIdx = 0; score = 0;
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            showQuestion();
        }
        function showQuestion() {
            const q = selectedQuestions[currentIdx];
            document.getElementById('questionNum').innerText = currentIdx + 1;
            document.getElementById('progressText').innerText = `CÂU TRẮC NGHIỆM: ${currentIdx + 1}/8`;
            document.getElementById('questionText').innerText = q.q;
            const area = document.getElementById('optionsArea'); area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-4 text-left bg-white rounded-2xl font-bold flex items-center group shadow-sm border border-gray-100";
                btn.innerHTML = `<div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 group-hover:bg-blue-600 group-hover:text-white transition-all text-xs font-black shadow-inner">${String.fromCharCode(65 + i)}</div><span class="flex-1 text-sm md:text-base text-gray-700">${opt}</span>`;
                btn.onclick = () => selectOption(i, btn);
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true; document.getElementById('nextBtn').onclick = nextQuestion;
        }
        function selectOption(i, btn) {
            document.querySelectorAll('#optionsArea button').forEach(b => { b.classList.remove('selected'); b.querySelector('div').classList.remove('bg-blue-600', 'text-white'); });
            btn.classList.add('selected'); btn.querySelector('div').classList.add('bg-blue-600', 'text-white');
            document.getElementById('nextBtn').disabled = false; document.getElementById('nextBtn').dataset.selected = i;
        }
        function nextQuestion() {
            if (parseInt(document.getElementById('nextBtn').dataset.selected) === selectedQuestions[currentIdx].c) score += 12.5;
            currentIdx++; (currentIdx < 8) ? showQuestion() : showResults();
        }
        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden'); document.getElementById('quiz-results').classList.remove('hidden');
            const circle = document.getElementById('scoreCircle'); const offset = 465 - (465 * score) / 100; circle.style.strokeDashoffset = offset;
            document.getElementById('scoreText').innerText = score;
        }
        function restartQuiz() { document.getElementById('quiz-results').classList.add('hidden'); document.getElementById('quiz-registration').classList.remove('hidden'); }

        // Firestore Config (Placeholder) and Functions
        const firebaseConfig = { apiKey: "API_KEY", authDomain: "projectId.firebaseapp.com", projectId: "projectId", storageBucket: "projectId.appspot.com", messagingSenderId: "SENDER_ID", appId: "APP_ID" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function submitResults(e) {
            e.preventDefault();
            const btn = e.target; btn.innerHTML = "Đang nộp..."; btn.disabled = true;
            const data = {
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                school: document.getElementById('schoolSelect').value === 'Khác' ? document.getElementById('otherSchool').value : document.getElementById('schoolSelect').value,
                lessonTitle: "Cách nối các vế câu ghép",
                score: score,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            db.collection("quiz_results").add(data).then(() => {
                document.getElementById('successModal').classList.remove('hidden');
                btn.innerHTML = "NỘP KẾT QUẢ"; btn.disabled = false;
            }).catch((err) => { console.error(err); alert("Lỗi khi nộp bài. Vui lòng thử lại!"); btn.innerHTML = "NỘP KẾT QUẢ"; btn.disabled = false; });
        }
        function closeSuccessModal() { document.getElementById('successModal').classList.add('hidden'); restartQuiz(); }
        // Teacher Stats functions - Simplified for length
        function openTeacherStats() { const p = prompt("Nhập mật khẩu giáo viên:"); if (p === '123456') { document.getElementById('statsModal').classList.add('active'); loadStats(); } else alert("Sai mật khẩu!"); }
        function closeModal() { document.getElementById('statsModal').classList.remove('active'); }
        function loadStats() {
            db.collection("quiz_results").where("lessonTitle", "==", "Cách nối các vế câu ghép").orderBy("timestamp", "desc").limit(50).get().then((q) => {
                const b = document.getElementById('statsTableBody'); b.innerHTML = "";
                q.forEach((doc, i) => {
                    const d = doc.data();
                    b.innerHTML += `<tr class="hover:bg-blue-50/50 transition-colors"><td class="px-6 py-4 font-bold text-gray-400">${i + 1}</td><td class="px-6 py-4 font-bold text-gray-800">${d.studentName}</td><td class="px-6 py-4 font-bold text-blue-600">${d.studentClass}</td><td class="px-6 py-4 font-bold text-gray-500">${d.school}</td><td class="px-6 py-4 text-center"><span class="inline-block px-3 py-1 rounded-lg font-black ${d.score >= 80 ? 'bg-green-100 text-green-600' : d.score >= 50 ? 'bg-yellow-100 text-yellow-600' : 'bg-red-100 text-red-600'}">${d.score}</span></td><td class="px-6 py-4 text-center font-bold text-gray-400">1</td><td class="px-6 py-4 text-center font-bold text-gray-400 text-xs">${d.timestamp ? new Date(d.timestamp.toDate()).toLocaleDateString('vi-VN') : ''}</td><td class="px-6 py-4 text-right"><span class="text-green-500 font-bold">✓</span></td></tr>`;
                });
            });
        }
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.table_to_sheet(document.querySelector("table"));
            XLSX.utils.book_append_sheet(wb, ws, "KetQua");
            XLSX.writeFile(wb, "KetQua_LTVC_CachNoiCacVeCauGhep.xlsx");
        }
    </script>
</body>

</html>