<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hoa tháng Năm - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Nunito & Merriweather -->
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            font-size: 18px;
            line-height: 1.8;
        }

        .serif-font p {
            text-indent: 2em;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-open .accordion-content {
            max-height: 1000px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .bg-paper {
            background-color: #fdfcf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        /* Tab Styles */
        .tab-btn.active {
            border-bottom: 4px solid #1d4ed8;
            color: #1d4ed8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }

        .quiz-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .quiz-option.selected {
            border-color: #2563eb;
            background-color: #dbeafe;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <a href="index.html" class="flex items-center space-x-2">
                    <div
                        class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white text-lg font-bold">
                        E</div>
                    <span class="text-lg font-extrabold text-blue-600 tracking-tight">EduRobot - <span
                            class="text-yellow-500">Tiếng Việt 5</span></span>
                </a>
            </div>

            <ul class="hidden md:flex space-x-6 font-semibold text-gray-600 text-sm">
                <li><a href="index.html" class="hover:text-blue-500 transition-colors">Trang chủ</a></li>
                <li><a href="ve-dep-cuoc-song.html"
                        class="hover:text-blue-500 transition-colors font-bold text-blue-600 border-b-2 border-blue-600">Bài
                        học</a></li>
                <li><a href="#" onclick="openTeacherStats()" class="hover:text-blue-500 transition-colors">Thống kê</a>
                </li>
                <li><a href="#" class="hover:text-blue-500 transition-colors">Liên hệ</a></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-4">

        <!-- Navigation & Audio Player Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
            <div>
                <a href="ve-dep-cuoc-song.html?week=21"
                    class="flex items-center text-gray-600 hover:text-blue-600 font-bold transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                </a>
            </div>
        </div>

        <div class="flex border-b border-gray-200 mb-6 bg-white rounded-t-2xl overflow-hidden shadow-sm">
            <button onclick="switchTab('lesson')" id="btn-lesson"
                class="tab-btn active flex-1 py-4 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                1. Bài học
            </button>
            <button onclick="switchTab('quiz')" id="btn-quiz"
                class="tab-btn flex-1 py-4 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                2. Luyện tập
            </button>
        </div>

        <div id="tab-lesson" class="tab-content active">
            <div class="flex justify-end mb-4">
                <div
                    class="flex items-center space-x-4 bg-white rounded-full p-2 pr-6 shadow-sm border border-blue-100">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-lg shadow-blue-200">
                        <svg id="playIcon" class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    <div>
                        <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Nghe đọc mẫu</p>
                        <p id="audioStatus" class="text-xs text-gray-400 font-bold italic">Đang dừng...</p>
                    </div>
                    <audio id="lessonAudio">
                        <source src="am_thanh/giohoathangnam.wav" type="audio/wav">
                    </audio>
                </div>
            </div>
            <div class="flex flex-col lg:flex-row gap-8">

                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%] text-center">
                    <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-2 md:p-3">

                        <div class="p-6 md:p-10 bg-paper rounded-2xl shadow-inner border border-gray-50">
                            <div class="serif-font text-gray-800 text-justify">
                                <h1 class="text-3xl font-black mb-6 text-blue-900 text-center uppercase tracking-tight">
                                    Giỏ hoa tháng năm</h1>

                                <p class="mb-4">
                                    Với bọn trẻ chúng tôi, ngày lễ Mừng xuân vào tháng Năm luôn đáng mong chờ, bởi đó là
                                    dịp
                                    chúng tôi được vui đùa thoả thích. Chúng tôi thường bí mật làm những giỏ hoa rực rỡ,
                                    đặt
                                    lên bậc thềm nhà người quen hoặc bạn bè, gõ cửa rồi ba chân bốn cẳng chạy trốn thật
                                    nhanh. Từ xa, chúng tôi hồi hộp theo dõi chủ nhà mở cửa, cầm món quà lên với vẻ ngạc
                                    nhiên, thích thú.
                                </p>
                                <p class="mb-4">
                                    Tôi còn nhớ lễ Mừng xuân năm tôi học lớp Năm. Lúc đó, tôi đang giận Pam, cô bạn thân
                                    nhất của mình. Từ nhỏ Pam và tôi đã thân nhau như hình với bóng. Gần đây, một gia
                                    đình
                                    mới dọn đến thị trấn của chúng tôi và Pam đã kết thân với con gái của họ. Mặc dù
                                    chúng
                                    tôi vẫn chơi với nhau, nhưng thời gian Pam dành cho tôi không còn nhiều như trước.
                                    Tôi
                                    cảm thấy như bị bỏ rơi. Giận Pam, tôi không chơi với bạn mấy ngày.
                                </p>
                                <p class="mb-4">
                                    Khi mẹ hỏi tôi có mang hoa cho Pam không, tôi trả lời: "Không bao giờ, mẹ ạ!". Mẹ
                                    dừng
                                    tay làm bếp, ôm tôi và an ủi. Cơn tủi thân bỗng dâng lên và tôi oà khóc nức nở. Mẹ
                                    dịu
                                    dàng vuốt tóc và lau nước mắt cho tôi. Mẹ bảo càng lớn, chúng tôi sẽ càng có nhiều
                                    bạn.
                                    Những người bạn không thể chỉ chơi với một mình tôi. Và ngay cả tôi cũng không thể
                                    chỉ
                                    chơi với một người bạn.
                                </p>
                                <p class="mb-4">
                                    Cuối cùng, tôi cũng quyết định tặng Pam một giỏ hoa. Tôi chọn thật nhiều hoa màu
                                    vàng mà
                                    Pam yêu thích, rồi nhờ chị tôi đem đến nhà bạn. Từ chỗ nấp, tôi thấy Pam nâng giỏ
                                    hoa
                                    lên, dịu dàng áp mặt vào những bông hoa và nói to như để tôi nghe được: "Cảm ơn
                                    Xu-di,
                                    hi vọng cậu không còn giận mình!". Lần ấy tôi học được rằng là bạn bè đích thực, ta
                                    sẽ
                                    đặt bạn trong tim nhưng không buộc họ luôn ở bên mình.
                                </p>
                                <p class="text-right italic font-bold text-gray-600 mt-6">(Theo Minh Hương)</p>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span class="w-10 h-10 bg-yellow-400 rounded-xl flex items-center justify-center mr-3">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">1.
                                        Ngày lễ nào trong năm được các bạn nhỏ mong chờ? Việc làm nào trong ngày đó
                                        khiến
                                        các bạn thấy thú vị?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Ngày lễ được các bạn nhỏ mong chờ là <span class="font-bold text-blue-600">ngày
                                            lễ
                                            mừng xuân vào tháng năm</span>. Các bạn thường bí mật làm những giỏ hoa rực
                                        rỡ,
                                        đặt lên bậc thềm nhà người quen hoặc bạn bè, gõ cửa rồi ba chân bốn cẳng chạy
                                        trốn
                                        thật nhanh, hồi hộp theo dõi chủ nhà có cảm xúc như thế nào trước món quà đó.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">2.
                                        Bạn thân của Xu-di là ai? Vì sao Xu-di lại giận người bạn thân của mình?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Bạn thân của Xu-di là <span class="font-bold text-blue-600">Pam</span>. Xu-di
                                        giận
                                        người bạn thân của mình vì có một gia đình mới dọn đến thị trấn của hai người và
                                        Pam
                                        đã kết thân với con gái của gia đình đó, thời gian Pam dành cho Xu-di không còn
                                        nhiều như trước, Xu-di cảm thấy như bị bỏ rơi.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">3.
                                        Việc Xu-di vẫn quyết định tặng bạn giỏ hoa với nhiều bông màu vàng mà bạn yêu
                                        thích
                                        thể hiện điều gì?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Việc đó cho thấy <span class="font-bold text-blue-600">Xu-di rất yêu quý Pam và
                                            hiểu
                                            sở thích của bạn</span>.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">4.
                                        Người bạn của Xu-di đón nhận giỏ hoa như thế nào? Theo em, Xu-di có cảm nghĩ gì
                                        trước cử chỉ, lời nói của bạn lúc nhận giỏ hoa?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Pam nâng giỏ hoa lên, dịu dàng áp mặt vào những bông hoa và nói to như để Xu-di
                                        nghe
                                        được: <span class="font-bold text-blue-600">"Cảm ơn Xu-di, hi vọng cậu không còn
                                            giận mình!"</span>. Chắc hẳn là Xu-di rất cảm động trước cử chỉ, lời nói của
                                        Pam
                                        lúc nhận hoa.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">5.
                                        Đoạn kết của câu chuyện muốn nói điều gì?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Đã là bạn bè đích thực luôn có sự <span class="font-bold text-blue-600">gắn bó
                                            thân
                                            thiết, chân thành</span>, luôn ở bên nhau, quan tâm đến nhau dù không ở cạnh
                                        nhau thường xuyên nhưng tấm lòng luôn hướng về nhau, luôn trân trọng và có vị
                                        trí
                                        nhất định trong lòng mỗi người.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

        </div>
        </div>

        <!-- Quiz Tab Content -->
        <div id="tab-quiz" class="tab-content">
            <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10 max-w-4xl mx-auto">
                <div id="quiz-registration">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-black text-blue-900 mb-2">THÔNG TIN HỌC SINH</h2>
                        <p class="text-gray-500">Vui lòng nhập thông tin để bắt đầu luyện tập: <b>Giỏ hoa tháng Năm</b>
                        </p>
                    </div>
                    <form id="regForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Họ và tên:</label>
                            <input type="text" id="studentName" required
                                class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                placeholder="Nhập đầy đủ họ tên của em">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Lớp:</label>
                                <select id="studentClass" required
                                    class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                    <option value="">-- Chọn lớp --</option>
                                    <option value="5/1">Lớp 5/1</option>
                                    <option value="5/2">Lớp 5/2</option>
                                    <option value="5/3">Lớp 5/3</option>
                                    <option value="5/4">Lớp 5/4</option>
                                    <option value="5/5">Lớp 5/5</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Trường:</label>
                                <div class="relative">
                                    <select id="schoolSelect" onchange="checkSchool(this)"
                                        class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                        <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                        <option value="other">Trường khác...</option>
                                    </select>
                                    <input type="text" id="otherSchool"
                                        class="hidden mt-4 w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                        placeholder="Nhập tên trường của em">
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-lg uppercase tracking-wider">
                            Bắt đầu làm bài
                        </button>
                    </form>
                </div>

                <div id="quiz-container" class="hidden">
                    <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <span id="questionNum"
                                class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black text-xl">1</span>
                            <div>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Câu hỏi</p>
                                <p class="text-xs text-gray-400 font-bold" id="progressText">Đang thực hiện: 1/5</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Thời gian còn lại
                            </p>
                            <p id="timer" class="text-lg font-black text-blue-900">20:00</p>
                        </div>
                    </div>

                    <div id="questionArea" class="mb-8">
                        <h3 id="questionText" class="text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h3>
                        <div id="optionsArea" class="grid grid-cols-1 gap-4"></div>
                    </div>

                    <div class="flex justify-end pt-6 border-t border-gray-100">
                        <button id="nextBtn" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center">
                            Tiếp theo
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="quiz-results" class="hidden text-center py-12">
                    <div class="mb-8 relative inline-block">
                        <svg class="w-48 h-48 mx-auto" viewBox="0 0 36 36">
                            <path class="text-gray-100" stroke-width="3" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path id="scoreCircle" class="text-green-500" stroke-width="3" stroke-dasharray="0, 100"
                                stroke-linecap="round" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="scoreText" class="text-5xl font-black text-blue-900">0</span>
                            <span class="text-sm font-bold text-gray-400 uppercase">Điểm</span>
                        </div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10" id="resultMsg">Chúc mừng em đã hoàn thành bài luyện tập.</p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="restartQuiz()"
                            class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-4 px-10 rounded-2xl transition-all active:scale-95">Làm
                            lại</button>
                        <button onclick="submitResults()"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95">Nộp
                            bài</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Statistics Modal -->
        <div id="statsModal" class="modal">
            <div
                class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col m-4">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-blue-600 text-white">
                    <h2 class="text-2xl font-black">THỐNG KÊ KẾT QUẢ HỌC TẬP</h2>
                    <button onclick="closeModal()" class="hover:bg-blue-700 p-2 rounded-full transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="p-6 overflow-x-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-xs font-bold tracking-widest">
                                <th class="p-4 border-b">STT</th>
                                <th class="p-4 border-b">Họ và tên</th>
                                <th class="p-4 border-b">Lớp</th>
                                <th class="p-4 border-b">Trường</th>
                                <th class="p-4 border-b text-center">Điểm số</th>
                                <th class="p-4 border-b text-center">Thời gian làm</th>
                                <th class="p-4 border-b text-right">Thời gian nộp</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody" class="text-sm"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-zinc-900 text-zinc-400 py-2 px-4 mt-2">
        <div class="container mx-auto text-center text-xs">
            <p>@ 2026 EduRobot - Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    /* FIREBASE CONFIG */
    const firebaseConfig = {
    apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
    authDomain: "gamhoctap.firebaseapp.com",
    databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "gamhoctap",
    storageBucket: "gamhoctap.firebasestorage.app",
    messagingSenderId: "833329613932",
    appId: "1:833329613932:web:0d8574827bcfe50b535c49",
    measurementId: "G-YT1PKCYS67"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    /* TEACHER STATS LOGIC */
    function openTeacherStats() {
    const pin = prompt("Vui lòng nhập mã PIN giáo viên:");
    if (pin === 'dvn') {
    document.getElementById('statsModal').classList.add('active');
    loadStats();
    } else if (pin !== null) {
    alert("Mã PIN không chính xác!");
    }
    }

    function closeModal() {
    document.getElementById('statsModal').classList.remove('active');
    }

    async function loadStats() {
    const tbody = document.getElementById('statsTableBody');
    tbody.innerHTML = '<tr>
        <td colspan="6" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td>
    </tr>';
    try {
    const snapshot = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Giỏ hoa tháng Năm").get();
    tbody.innerHTML = '';
    if (snapshot.empty) {
    tbody.innerHTML = '<tr>
        <td colspan="6" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td>
        <td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td>
    </tr>';
    return;
    }
    const results = [];
    snapshot.forEach(doc => results.push(doc.data()));
    results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));
    results.forEach((data, index) => {
    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';

    // Tính thời gian làm bài
    let duration = '---';
    if (data.startTime && data.endTime) {
    const start = new Date(data.startTime);
    const end = new Date(data.endTime);
    const diffMs = end - start;
    const mins = Math.floor(diffMs / 60000);
    const secs = Math.floor((diffMs % 60000) / 1000);
    duration = `${mins} phút ${secs} giây`;
    }

    const tr = document.createElement('tr');
    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50";
    tr.innerHTML = `
    <td class="p-4 font-bold text-gray-400">${index + 1}</td>
    <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
    <td class="p-4 text-gray-600">${data.className}</td>
    <td class="p-4 text-gray-600">${data.school}</td>
    <td class="p-4 text-center">
        <span
            class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 50 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">
            ${data.score}/100
        </span>
    </td>
    <td class="p-4 text-center text-gray-600 font-bold">${duration}</td>
    <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
    `;
    tbody.appendChild(tr);
    });
    } catch (error) {
    console.error("Error loading stats:", error);
    tbody.innerHTML = '<tr>
        <td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu.</td>
    </tr>';
    }
    }

    /* TAB LOGIC */
    function switchTab(tabId) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'text-blue-600'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    document.getElementById('btn-' + tabId).classList.add('active', 'text-blue-600');
    document.getElementById('tab-' + tabId).classList.add('active');
    }

    /* REGISTRATION LOGIC */
    const otherSchoolInput = document.getElementById('otherSchool');
    function checkSchool(select) {
    if (select.value === 'other') {
    otherSchoolInput.classList.remove('hidden');
    otherSchoolInput.required = true;
    } else {
    otherSchoolInput.classList.add('hidden');
    otherSchoolInput.required = false;
    }
    }
    let studentData = {};
    document.getElementById('regForm').onsubmit = function (e) {
    e.preventDefault();
    studentData = {
    name: document.getElementById('studentName').value,
    className: document.getElementById('studentClass').value,
    school: document.getElementById('schoolSelect').value === 'other' ? document.getElementById('otherSchool').value :
    document.getElementById('schoolSelect').value,
    startTime: new Date().toISOString()
    };
    document.getElementById('quiz-registration').classList.add('hidden');
    document.getElementById('quiz-container').classList.remove('hidden');
    startQuiz();
    };

    /* QUIZ ENGINE */
    const allQuestions = [
    { q: "Ngày lễ Mừng xuân được nhắc đến trong bài diễn ra vào tháng mấy?", a: ["Tháng Giêng", "Tháng Ba", "Tháng Năm",
    "Tháng Chạp"], c: 2 },
    { q: "Vào ngày lễ Mừng xuân, các bạn nhỏ thường có hoạt động thú vị nào?", a: ["Đi hái hoa trong rừng", "Bí mật đặt
    giỏ hoa trước cửa nhà bạn bè rồi chạy trốn", "Tổ chức tiệc trà trong vườn", "Viết thư tay gửi cho nhau"], c: 1 },
    { q: "Cụm từ \"ba chân bốn cẳng\" trong câu \"gõ cửa rồi ba chân bốn cẳng chạy trốn thật nhanh\" gợi tả điều gì?",
    a: ["Sự sợ hãi tột độ", "Sự vấp ngã khi chạy", "Sự vội vã, nhanh nhẹn và tinh nghịch", "Sự chậm chạp, từ tốn"], c: 2
    },
    { q: "Nhân vật \"tôi\" (Xu-di) và Pam có mối quan hệ như thế nào từ nhỏ?", a: ["Là chị em ruột", "Là hàng xóm mới
    quen", "Thân nhau như hình với bóng", "Là bạn học cùng lớp nhưng ít chơi chung"], c: 2 },
    { q: "Vì sao Xu-di lại cảm thấy giận Pam?", a: ["Vì Pam quên sinh nhật của Xu-di", "Vì Pam kết thân với một người
    bạn mới và dành ít thời gian cho Xu-di", "Vì Pam làm hỏng đồ chơi của Xu-di", "Vì Pam không chịu làm giỏ hoa cùng
    Xu-di"], c: 1 },
    { q: "Khi mẹ hỏi có mang hoa cho Pam không, phản ứng đầu tiên của Xu-di là gì?", a: ["Đồng ý ngay lập tức", "Im lặng
    không nói gì", "Trả lời \"Không bao giờ\" và òa khóc nức nở", "Tức giận bỏ đi ra ngoài"], c: 2 },
    { q: "Mẹ đã an ủi và khuyên Xu-di điều gì về tình bạn?", a: ["Nên tìm một người bạn tốt hơn Pam", "Chúng ta không
    thể bắt bạn chỉ chơi với một mình mình", "Không nên chơi với những người bạn mới đến", "Nên nghỉ chơi với Pam để bạn
    ấy hối hận"], c: 1 },
    { q: "Cuối cùng, Xu-di đã quyết định làm gì?", a: ["Tiếp tục giận Pam", "Viết một lá thư xin lỗi Pam", "Tặng Pam một
    giỏ hoa", "Mời Pam sang nhà ăn tối"], c: 2 },
    { q: "Xu-di đã chọn loại hoa màu gì để tặng Pam và vì sao?", a: ["Màu đỏ, vì đó là màu rực rỡ nhất", "Màu vàng, vì
    đó là màu Pam yêu thích", "Màu tím, vì đó là màu của sự thủy chung", "Màu trắng, vì đó là màu có sẵn trong vườn"],
    c: 1 },
    { q: "Ai là người đã giúp Xu-di mang giỏ hoa đến nhà Pam?", a: ["Xu-di tự mang đến", "Mẹ của Xu-di", "Chị của
    Xu-di", "Người bạn hàng xóm mới"], c: 2 },
    { q: "Khi nhận được giỏ hoa, Pam đã có cử chỉ như thế nào?", a: ["Ngạc nhiên và chạy đi tìm người tặng", "Nâng giỏ
    hoa lên, dịu dàng áp mặt vào những bông hoa", "Đặt giỏ hoa xuống và đóng cửa lại", "Gọi điện thoại ngay cho Xu-di"],
    c: 1 },
    { q: "Pam đã nói to câu gì khi nhận được hoa?", a: ["\"Ai đã tặng mình giỏ hoa đẹp thế này?\"", "\"Cảm ơn bạn, mình
    rất thích!\"", "\"Cảm ơn Xu-di, hi vọng cậu không còn giận mình!\"", "\"Xu-di ơi, ra đây chơi với mình đi!\""], c: 2
    },
    { q: "Chi tiết Pam nói to lời cảm ơn \"như để tôi nghe được\" cho thấy điều gì?", a: ["Pam biết Xu-di đang nấp gần
    đó và muốn làm hòa", "Pam có thói quen nói to một mình", "Pam muốn khoe với mọi người xung quanh", "Pam nhầm chị của
    Xu-di là Xu-di"], c: 0 },
    { q: "Qua câu chuyện này, nhân vật Xu-di đã rút ra bài học gì về tình bạn đích thực?", a: ["Bạn bè phải luôn ở cạnh
    nhau mọi lúc mọi nơi", "Không bao giờ được chia sẻ bạn thân với người khác", "Đặt bạn trong tim nhưng không buộc họ
    luôn ở bên mình", "Chỉ nên chơi với những người bạn cũ"], c: 2 },
    { q: "Theo nội dung bài đọc, một tình bạn đẹp là tình bạn như thế nào?", a: ["Luôn tặng quà cho nhau vào các dịp
    lễ", "Dựa trên sự chân thành, thấu hiểu và sẻ chia", "Chỉ cần vui chơi thỏa thích cùng nhau", "Không bao giờ có sự
    giận dỗi hay hiểu lầm"], c: 1 }
    ];

    let currentQuizQuestions = [];
    let currentQuestionIdx = 0;
    let score = 0;
    let selectedOption = null;
    let timeLeft = 1200; // 20 minutes
    let timerInterval;

    function startTimer() {
    timerInterval = setInterval(() => {
    timeLeft--;
    const mins = Math.floor(timeLeft / 60);
    const secs = timeLeft % 60;
    document.getElementById('timer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2,
    document.getElementById('timer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2,
    '0')}`;
    if (timeLeft <= 0) { clearInterval(timerInterval); showResults(); } }, 1000); } function startQuiz() {
        currentQuizQuestions=[...allQuestions].sort(()=> Math.random() - 0.5);
        currentQuestionIdx = 0;
        score = 0;
        startTimer();
        showQuestion();
        }

        function showQuestion() {
        const q = currentQuizQuestions[currentQuestionIdx];
        document.getElementById('questionNum').innerText = currentQuestionIdx + 1;
        document.getElementById('progressText').innerText = `Đang thực hiện: ${currentQuestionIdx +
        1}/${currentQuizQuestions.length}`;
        document.getElementById('questionText').innerText = q.q;
        const optionsArea = document.getElementById('optionsArea');
        optionsArea.innerHTML = '';
        q.a.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'quiz-option w-full p-4 rounded-2xl text-left font-bold text-gray-700 flex items-center group';
        btn.innerHTML = `<span
            class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 group-hover:bg-blue-100">${String.fromCharCode(65
            + idx)}</span><span class="flex-1">${opt}</span>`;
        btn.onclick = () => selectOption(idx, btn);
        optionsArea.appendChild(btn);
        });
        document.getElementById('nextBtn').disabled = true;
        selectedOption = null;
        }

        function selectOption(idx, btn) {
        document.querySelectorAll('.quiz-option').forEach(b => b.classList.remove('selected', 'border-blue-500'));
        btn.classList.add('selected', 'border-blue-500');
        selectedOption = idx;
        document.getElementById('nextBtn').disabled = false;
        }

        document.getElementById('nextBtn').onclick = function () {
        if (selectedOption === currentQuizQuestions[currentQuestionIdx].c) {
        score += (100 / currentQuizQuestions.length);
        }
        currentQuestionIdx++;
        if (currentQuestionIdx < currentQuizQuestions.length) { showQuestion(); } else { showResults(); } }; function
            showResults() { clearInterval(timerInterval);
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText=Math.round(score); const
            circle=document.getElementById('scoreCircle'); circle.setAttribute('stroke-dasharray',
            `${Math.round(score)}, 100`); if (score>= 80) {
            document.getElementById('resultTitle').innerText = "Thật tuyệt vời!";
            document.getElementById('resultMsg').innerText = "Em hiểu rất rõ về ý nghĩa của tình bạn.";
            } else if (score >= 50) {
            document.getElementById('resultTitle').innerText = "Rất tốt!";
            document.getElementById('resultMsg').innerText = "Em đã cảm nhận được tình cảm chân thành trong bài học.";
            } else {
            document.getElementById('resultTitle').innerText = "Cố gắng lên!";
            document.getElementById('resultMsg').innerText = "Em hãy đọc lại câu chuyện và thử lại nhé.";
            }
            }

            function restartQuiz() {
            clearInterval(timerInterval);
            timeLeft = 1200;
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            startQuiz();
            }

            async function submitResults() {
            const finalData = {
            studentName: studentData.name,
            className: studentData.className,
            school: studentData.school,
            lessonTitle: "Giỏ hoa tháng Năm",
            score: score,
            startTime: studentData.startTime,
            endTime: new Date().toISOString(),
            submittedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            const btn = event.target;
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "Đang gửi...";
            try {
            await db.collection("diem_tieng_viet_lop5").add(finalData);
            alert(`Chúc mừng em ${studentData.name}!\nKết quả của em đã được gửi thành công.\nĐiểm: ${score}/100`);
            switchTab('lesson');
            } catch (error) {
            console.error("Error submitting quiz:", error);
            alert("Lỗi khi nộp bài. Kiểm tra lại mạng nhé!");
            } finally {
            btn.disabled = false;
            btn.innerText = originalText;
            }
            }

            function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
            }

            const audio = document.getElementById('lessonAudio');
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            const audioStatus = document.getElementById('audioStatus');

            function toggleAudio() {
            if (audio.paused) {
            audio.play();
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            audioStatus.innerText = "Đang phát...";
            audioStatus.classList.remove('text-gray-400');
            audioStatus.classList.add('text-green-500');
            } else {
            audio.pause();
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.remove('text-green-500');
            audioStatus.classList.add('text-gray-400');
            }
            }

            function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Kết quả", raw: true });
            XLSX.writeFile(wb, "ThongKe_GiaoVien_EduRobot.xlsx");
            }

            audio.onended = function () {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.remove('text-green-500');
            audioStatus.classList.add('text-gray-400');
            };
            </script>
</body>

</html>