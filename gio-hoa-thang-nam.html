<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hoa tháng Năm - Giáo án điện tử Tiếng Việt 5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
            scroll-behavior: smooth;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            line-height: 2;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0, 1, 0, 1);
        }

        .accordion-open .accordion-content {
            max-height: 1000px;
            transition: all 0.5s cubic-bezier(1, 0, 1, 0);
        }

        .bg-paper {
            background: #fdfcf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 24px 24px;
        }

        .tab-btn.active {
            background: #eff6ff;
            color: #2563eb;
            border-color: #2563eb;
        }

        .tab-content {
            display: none;
            transition: all 0.3s ease;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .quiz-option.selected {
            background: #eff6ff;
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px #3b82f6;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-100">
        <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="index.html" class="flex items-center group">
                <div
                    class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200 group-hover:rotate-12 transition-transform">
                    <span class="text-xl font-black">D</span>
                </div>
                <div class="ml-3">
                    <h1 class="text-lg font-black text-slate-800 leading-none">EduRobot</h1>
                    <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest mt-1">Tiếng Việt 5</p>
                </div>
            </a>
            <div class="flex items-center space-x-6">
                <a href="index.html" class="text-sm font-bold text-gray-500 hover:text-blue-600 transition-colors">Trang
                    chủ</a>
                <a href="#" onclick="openTeacherStats()"
                    class="bg-slate-800 text-white px-5 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-700 transition-all shadow-lg active:scale-95">Dành
                    cho Giáo viên</a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-1">


        <!-- Tab & Audio Header -->
        <div
            class="flex flex-col md:flex-row md:items-center justify-between border-b border-gray-200 mb-4 bg-white rounded-t-2xl overflow-hidden shadow-sm">
            <div class="flex-1 flex">
                <button onclick="switchTab('lesson')" id="btn-lesson"
                    class="tab-btn active flex-1 py-3 text-center font-bold text-gray-500 transition-all hover:bg-blue-50 border-r border-gray-100">
                    1. Bài học
                </button>
                <button onclick="switchTab('quiz')" id="btn-quiz"
                    class="tab-btn flex-1 py-3 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                    2. Luyện tập
                </button>
            </div>

            <div id="audio-container" class="p-2 md:pr-4">
                <div
                    class="flex items-center space-x-3 bg-blue-50/50 rounded-full p-1 pr-6 border border-blue-100 shadow-sm transition-all hover:bg-blue-50">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-11 h-11 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-md active:scale-95">
                        <svg id="playIcon" class="w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M6 4h4v16H6zm8 0h4v16h-4z"></path>
                        </svg>
                    </button>
                    <div class="flex flex-col">
                        <p class="text-[11px] font-black text-blue-600 uppercase tracking-widest leading-none mb-1">NGHE
                            ĐỌC MẪU</p>
                        <p id="audioStatus" class="text-[12px] text-gray-400 font-bold italic leading-none">Đang dừng...
                        </p>
                    </div>
                </div>
                <audio id="lessonAudio">
                    <source src="am_thanh/giohoathangnam.mp3" type="audio/mpeg">
                </audio>
            </div>
        </div>

        <div id="tab-lesson" class="tab-content active">

            <div class="flex flex-col lg:flex-row gap-8">

                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%] text-center">
                    <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-2 md:p-3">

                        <div class="p-6 md:p-10 bg-paper rounded-2xl shadow-inner border border-gray-50">
                            <div class="serif-font text-gray-800 text-justify">
                                <h1 class="text-3xl font-black mb-6 text-blue-900 text-center uppercase tracking-tight">
                                    Giỏ hoa tháng năm</h1>

                                <p class="mb-4">
                                    Với bọn trẻ chúng tôi, ngày lễ Mừng xuân vào tháng Năm luôn đáng mong chờ, bởi đó là
                                    dịp
                                    chúng tôi được vui đùa thoả thích. Chúng tôi thường bí mật làm những giỏ hoa rực rỡ,
                                    đặt
                                    lên bậc thềm nhà người quen hoặc bạn bè, gõ cửa rồi ba chân bốn cẳng chạy trốn thật
                                    nhanh. Từ xa, chúng tôi hồi hộp theo dõi chủ nhà mở cửa, cầm món quà lên với vẻ ngạc
                                    nhiên, thích thú.
                                </p>
                                <p class="mb-4">
                                    Tôi còn nhớ lễ Mừng xuân năm tôi học lớp Năm. Lúc đó, tôi đang giận Pam, cô bạn thân
                                    nhất của mình. Từ nhỏ Pam và tôi đã thân nhau như hình với bóng. Gần đây, một gia
                                    đình
                                    mới dọn đến thị trấn của chúng tôi và Pam đã kết thân với con gái của họ. Mặc dù
                                    chúng
                                    tôi vẫn chơi với nhau, nhưng thời gian Pam dành cho tôi không còn nhiều như trước.
                                    Tôi
                                    cảm thấy như bị bỏ rơi. Giận Pam, tôi không chơi với bạn mấy ngày.
                                </p>
                                <p class="mb-4">
                                    Khi mẹ hỏi tôi có mang hoa cho Pam không, tôi trả lời: "Không bao giờ, mẹ ạ!". Mẹ
                                    dừng
                                    tay làm bếp, ôm tôi và an ủi. Cơn tủi thân bỗng dâng lên và tôi oà khóc nức nở. Mẹ
                                    dịu
                                    dàng vuốt tóc và lau nước mắt cho tôi. Mẹ bảo càng lớn, chúng tôi sẽ càng có nhiều
                                    bạn.
                                    Những người bạn không thể chỉ chơi với một mình tôi. Và ngay cả tôi cũng không thể
                                    chỉ
                                    chơi với một người bạn.
                                </p>
                                <p class="mb-4">
                                    Cuối cùng, tôi cũng quyết định tặng Pam một giỏ hoa. Tôi chọn thật nhiều hoa màu
                                    vàng mà
                                    Pam yêu thích, rồi nhờ chị tôi đem đến nhà bạn. Từ chỗ nấp, tôi thấy Pam nâng giỏ
                                    hoa
                                    lên, dịu dàng áp mặt vào những bông hoa và nói to như để tôi nghe được: "Cảm ơn
                                    Xu-di,
                                    hi vọng cậu không còn giận mình!". Lần ấy tôi học được rằng là bạn bè đích thực, ta
                                    sẽ
                                    đặt bạn trong tim nhưng không buộc họ luôn ở bên mình.
                                </p>
                                <p class="text-right italic font-bold text-gray-600 mt-6">(Theo Minh Hương)</p>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <div class="mb-4 overflow-hidden rounded-2xl shadow-md border-4 border-white">
                            <img src="C:/Users/Admin/.gemini/antigravity/brain/cbb865b6-a5f3-4a35-b283-692f4fd0abc3/gio_hoa_thang_nam_illustration_1768924393346.png"
                                alt="Giỏ hoa tháng Năm" class="w-full h-auto">
                        </div>
                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span
                                class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center mr-3 text-white shadow-lg shadow-blue-100">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">1.
                                        Ngày lễ nào trong năm được các bạn nhỏ mong chờ? Việc làm nào trong ngày đó
                                        khiến
                                        các bạn thấy thú vị?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Ngày lễ được các bạn nhỏ mong chờ là <span class="font-bold text-blue-600">ngày
                                            lễ
                                            mừng xuân vào tháng năm</span>. Các bạn thường bí mật làm những giỏ hoa rực
                                        rỡ,
                                        đặt lên bậc thềm nhà người quen hoặc bạn bè, gõ cửa rồi ba chân bốn cẳng chạy
                                        trốn
                                        thật nhanh, hồi hộp theo dõi chủ nhà có cảm xúc như thế nào trước món quà đó.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">2.
                                        Bạn thân của Xu-di là ai? Vì sao Xu-di lại giận người bạn thân của mình?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Bạn thân của Xu-di là <span class="font-bold text-blue-600">Pam</span>. Xu-di
                                        giận
                                        người bạn thân của mình vì có một gia đình mới dọn đến thị trấn của hai người và
                                        Pam
                                        đã kết thân với con gái của gia đình đó, thời gian Pam dành cho Xu-di không còn
                                        nhiều như trước, Xu-di cảm thấy như bị bỏ rơi.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">3.
                                        Việc Xu-di vẫn quyết định tặng bạn giỏ hoa với nhiều bông màu vàng mà bạn yêu
                                        thích
                                        thể hiện điều gì?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Việc đó cho thấy <span class="font-bold text-blue-600">Xu-di rất yêu quý Pam và
                                            hiểu
                                            sở thích của bạn</span>.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">4.
                                        Người bạn của Xu-di đón nhận giỏ hoa như thế nào? Theo em, Xu-di có cảm nghĩ gì
                                        trước cử chỉ, lời nói của bạn lúc nhận giỏ hoa?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Pam nâng giỏ hoa lên, dịu dàng áp mặt vào những bông hoa và nói to như để Xu-di
                                        nghe
                                        được: <span class="font-bold text-blue-600">"Cảm ơn Xu-di, hi vọng cậu không còn
                                            giận mình!"</span>. Chắc hẳn là Xu-di rất cảm động trước cử chỉ, lời nói của
                                        Pam
                                        lúc nhận hoa.
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">5.
                                        Đoạn kết của câu chuyện muốn nói điều gì?</span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1 text-base">Trả lời:</span>
                                        Đã là bạn bè đích thực luôn có sự <span class="font-bold text-blue-600">gắn bó
                                            thân
                                            thiết, chân thành</span>, luôn ở bên nhau, quan tâm đến nhau dù không ở cạnh
                                        nhau thường xuyên nhưng tấm lòng luôn hướng về nhau, luôn trân trọng và có vị
                                        trí
                                        nhất định trong lòng mỗi người.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

        </div>
        </div>

        <!-- Quiz Tab Content -->
        <div id="tab-quiz" class="tab-content">
            <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10 max-w-4xl mx-auto">
                <div id="quiz-registration">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-black text-blue-900 mb-2">THÔNG TIN HỌC SINH</h2>
                        <p class="text-gray-500">Vui lòng nhập thông tin để bắt đầu luyện tập: <b>Giỏ hoa tháng Năm</b>
                        </p>
                    </div>
                    <form id="regForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Họ và tên:</label>
                            <input type="text" id="studentName" required
                                class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                placeholder="Nhập đầy đủ họ tên của em">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Lớp:</label>
                                <select id="studentClass" required
                                    class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                    <option value="">-- Chọn lớp --</option>
                                    <option value="5/1">Lớp 5/1</option>
                                    <option value="5/2">Lớp 5/2</option>
                                    <option value="5/3">Lớp 5/3</option>
                                    <option value="5/4">Lớp 5/4</option>
                                    <option value="5/5">Lớp 5/5</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Trường:</label>
                                <div class="relative">
                                    <select id="schoolSelect" onchange="checkSchool(this)"
                                        class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                        <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                        <option value="other">Trường khác...</option>
                                    </select>
                                    <input type="text" id="otherSchool"
                                        class="hidden mt-4 w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                        placeholder="Nhập tên trường của em">
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-lg uppercase tracking-wider">
                            Bắt đầu làm bài
                        </button>
                    </form>
                </div>

                <div id="quiz-container" class="hidden">
                    <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <span id="questionNum"
                                class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black text-xl">1</span>
                            <div>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Câu hỏi</p>
                                <p class="text-xs text-gray-400 font-bold" id="progressText">Đang thực hiện: 1/5</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Thời gian còn lại
                            </p>
                            <p id="timer" class="text-lg font-black text-blue-900">20:00</p>
                        </div>
                    </div>

                    <div id="questionArea" class="mb-8">
                        <h3 id="questionText" class="text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h3>
                        <div id="optionsArea" class="grid grid-cols-1 gap-4"></div>
                    </div>

                    <div class="flex justify-end pt-6 border-t border-gray-100">
                        <button id="nextBtn" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center">
                            Tiếp theo
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="quiz-results" class="hidden text-center py-12">
                    <div class="mb-8 relative inline-block">
                        <svg class="w-48 h-48 mx-auto" viewBox="0 0 36 36">
                            <path class="text-gray-100" stroke-width="3" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path id="scoreCircle" class="text-green-500" stroke-width="3" stroke-dasharray="0, 100"
                                stroke-linecap="round" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="scoreText" class="text-5xl font-black text-blue-900">0</span>
                            <span class="text-sm font-bold text-gray-400 uppercase">Điểm</span>
                        </div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10" id="resultMsg">Chúc mừng em đã hoàn thành bài luyện tập.</p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="restartQuiz()"
                            class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-4 px-10 rounded-2xl transition-all active:scale-95">Làm
                            lại</button>
                        <button onclick="submitResults(event)"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95">Nộp
                            bài</button>
                    </div>
                </div>
            </div>
        </div>

        <a href="ve-dep-cuoc-song.html?week=21"
            class="fixed bottom-8 right-8 z-[100] group flex items-center space-x-3 bg-white/80 backdrop-blur-xl p-2 pr-6 rounded-2xl shadow-2xl border border-white/50 hover:scale-105 transition-all active:scale-95">
            <div
                class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200 group-hover:rotate-12 transition-transform">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </div>
            <span class="text-sm font-black text-slate-700 uppercase tracking-wider">Trở về</span>
        </a>

        <div id="statsModal" class="modal px-4">
            <div
                class="bg-slate-50 rounded-[40px] shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col animate-modal">
                <div class="p-8 border-b border-gray-100 flex justify-between items-center bg-white">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800 tracking-tight">Thống kê kết quả</h2>
                        <p class="text-blue-600 font-bold mt-1">Lớp 5 - Bài đọc: Giỏ hoa tháng Năm</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <button onclick="exportToExcel()"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-2xl font-black text-sm transition-all hover:shadow-lg active:scale-95 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            XUẤT EXCEL
                        </button>
                        <button onclick="closeModal()"
                            class="w-12 h-12 bg-gray-100 hover:bg-red-50 text-gray-400 hover:text-red-500 rounded-2xl transition-all flex items-center justify-center">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-8 overflow-x-auto">
                    <table class="w-full border-separate border-spacing-y-3">
                        <thead>
                            <tr class="text-gray-400 text-xs font-black uppercase tracking-widest">
                                <th class="px-6 pb-2 text-left">STT</th>
                                <th class="px-6 pb-2 text-left">Học sinh</th>
                                <th class="px-6 pb-2 text-left">Lớp</th>
                                <th class="px-6 pb-2 text-left">Trường</th>
                                <th class="px-6 pb-2 text-center">Điểm số</th>
                                <th class="px-6 pb-2 text-center">Thời gian</th>
                                <th class="px-6 pb-2 text-right">Ngày nộp</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-zinc-900 text-zinc-400 py-2 px-4 mt-2">
        <div class="container mx-auto text-center text-xs">
            <p>@ 2026 EduRobot - Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');

        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.replace('text-gray-400', 'text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.replace('text-green-500', 'text-gray-400');
            }
        }

        audio.onended = () => {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.replace('text-green-500', 'text-gray-400');
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        /* QUIZ ENGINE */
        const allQuestions = [
            { q: "Ngày lễ Mừng xuân được nhắc đến trong bài diễn ra vào tháng mấy?", a: ["Tháng Giêng", "Tháng Ba", "Tháng Năm", "Tháng Chạp"], c: 2 },
            { q: "Vào ngày lễ Mừng xuân, các bạn nhỏ thường có hoạt động thú vị nào?", a: ["Đi hái hoa trong rừng", "Bí mật đặt giỏ hoa trước cửa nhà bạn bè rồi chạy trốn", "Tổ chức tiệc trà trong vườn", "Viết thư tay gửi cho nhau"], c: 1 },
            { q: "Cụm từ \"ba chân bốn cẳng\" trong câu \"gõ cửa rồi ba chân bốn cẳng chạy trốn thật nhanh\" gợi tả điều gì?", a: ["Sự sợ hãi tột độ", "Sự vấp ngã khi chạy", "Sự vội vã, nhanh nhẹn và tinh nghịch", "Sự chậm chạp, từ tốn"], c: 2 },
            { q: "Nhân vật \"tôi\" (Xu-di) và Pam có mối quan hệ như thế nào từ nhỏ?", a: ["Là chị em ruột", "Là hàng xóm mới quen", "Thân nhau như hình với bóng", "Là bạn học cùng lớp nhưng ít chơi chung"], c: 2 },
            { q: "Vì sao Xu-di lại cảm thấy giận Pam?", a: ["Vì Pam quên sinh nhật của Xu-di", "Vì Pam kết thân với một người bạn mới và dành ít thời gian cho Xu-di", "Vì Pam làm hỏng đồ chơi của Xu-di", "Vì Pam không chịu làm giỏ hoa cùng Xu-di"], c: 1 },
            { q: "Khi mẹ hỏi có mang hoa cho Pam không, phản ứng đầu tiên của Xu-di là gì?", a: ["Đồng ý ngay lập tức", "Im lặng không nói gì", "Trả lời \"Không bao giờ\" và òa khóc nức nở", "Tức giận bỏ đi ra ngoài"], c: 2 },
            { q: "Mẹ đã an ủi và khuyên Xu-di điều gì về tình bạn?", a: ["Nên tìm một người bạn tốt hơn Pam", "Chúng ta không thể bắt bạn chỉ chơi với một mình mình", "Không nên chơi với những người bạn mới đến", "Nên nghỉ chơi với Pam để bạn ấy hối hận"], c: 1 },
            { q: "Cuối cùng, Xu-di đã quyết định làm gì?", a: ["Tiếp tục giận Pam", "Viết một lá thư xin lỗi Pam", "Tặng Pam một giỏ hoa", "Mời Pam sang nhà ăn tối"], c: 2 },
            { q: "Xu-di đã chọn loại hoa màu gì để tặng Pam và vì sao?", a: ["Màu đỏ, vì đó là màu rực rỡ nhất", "Màu vàng, vì đó là màu Pam yêu thích", "Màu tím, vì đó là màu của sự thủy chung", "Màu trắng, vì đó là màu có sẵn trong vườn"], c: 1 },
            { q: "Ai là người đã giúp Xu-di mang giỏ hoa đến nhà Pam?", a: ["Xu-di tự mang đến", "Mẹ của Xu-di", "Chị của Xu-di", "Người bạn hàng xóm mới"], c: 2 },
            { q: "Khi nhận được giỏ hoa, Pam đã có cử chỉ như thế nào?", a: ["Ngạc nhiên và chạy đi tìm người tặng", "Nâng giỏ hoa lên, dịu dàng áp mặt vào những bông hoa", "Đặt giỏ hoa xuống và đóng cửa lại", "Gọi điện thoại ngay cho Xu-di"], c: 1 },
            { q: "Pam đã nói to câu gì khi nhận được hoa?", a: ["\"Ai đã tặng mình giỏ hoa đẹp thế này?\"", "\"Cảm ơn bạn, mình rất thích!\"", "\"Cảm ơn Xu-di, hi vọng cậu không còn giận mình!\"", "\"Xu-di ơi, ra đây chơi với mình đi!\""], c: 2 },
            { q: "Chi tiết Pam nói to lời cảm ơn \"như để tôi nghe được\" cho thấy điều gì?", a: ["Pam biết Xu-di đang nấp gần đó và muốn làm hòa", "Pam có thói quen nói to một mình", "Pam muốn khoe với mọi người xung quanh", "Pam nhầm chị của Xu-di là Xu-di"], c: 0 },
            { q: "Qua câu chuyện này, nhân vật Xu-di đã rút ra bài học gì về tình bạn đích thực?", a: ["Bạn bè phải luôn ở cạnh nhau mọi lúc mọi nơi", "Không bao giờ được chia sẻ bạn thân với người khác", "Đặt bạn trong tim nhưng không buộc họ luôn ở bên mình", "Chì nên chơi với những người bạn cũ"], c: 2 },
            { q: "Theo nội dung bài đọc, một tình bạn đẹp là tình bạn như thế nào?", a: ["Luôn tặng quà cho nhau vào các dịp lễ", "Dựa trên sự chân thành, thấu hiểu và sẻ chia", "Chỉ cần vui chơi thỏa thích cùng nhau", "Không bao giờ có sự giận dỗi hay hiểu lầm"], c: 1 }
        ];

        let studentData = {}, currentQuizQuestions = [], currentQuestionIdx = 0, score = 0, selectedOption = null;

        function checkSchool() {
            const select = document.getElementById('schoolSelect');
            const other = document.getElementById('otherSchool');
            if (select.value === 'other' || select.value === 'Khác') {
                other.classList.remove('hidden');
                other.required = true;
            } else {
                other.classList.add('hidden');
                other.required = false;
            }
        }

        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        const regForm = document.getElementById('regForm');
        regForm.onsubmit = (e) => {
            e.preventDefault();
            studentData = {
                studentName: document.getElementById('studentName').value,
                className: document.getElementById('studentClass').value,
                school: document.getElementById('schoolSelect').value === 'other' ? document.getElementById('otherSchool').value : document.getElementById('schoolSelect').value,
                startTime: new Date().toISOString()
            };
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            startQuiz();
        };

        function startQuiz() {
            currentQuizQuestions = [...allQuestions].sort(() => Math.random() - 0.5).slice(0, 5);
            currentQuestionIdx = 0; score = 0; showQuestion();
        }

        function showQuestion() {
            const q = currentQuizQuestions[currentQuestionIdx];
            document.getElementById('questionNum').innerText = currentQuestionIdx + 1;
            document.getElementById('progressText').innerText = `Đang thực hiện: ${currentQuestionIdx + 1}/5`;
            document.getElementById('questionText').innerText = q.q;
            const area = document.getElementById('optionsArea'); area.innerHTML = '';
            q.a.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'w-full p-4 text-left border-2 border-gray-100 rounded-2xl font-bold transition-all hover:border-blue-200 hover:bg-blue-50/50 flex items-center group';
                btn.innerHTML = `<span class="w-8 h-8 rounded-full border-2 border-gray-200 flex items-center justify-center mr-4 group-hover:border-blue-400 group-hover:bg-blue-600 group-hover:text-white transition-all text-sm">${String.fromCharCode(65 + i)}</span><span class="flex-1">${opt}</span>`;
                btn.onclick = () => {
                    document.querySelectorAll('#optionsArea button').forEach(b => {
                        b.classList.remove('border-blue-600', 'bg-blue-50');
                        b.querySelector('span').classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                    });
                    btn.classList.add('border-blue-600', 'bg-blue-50');
                    btn.querySelector('span').classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                    document.getElementById('nextBtn').disabled = false;
                    selectedOption = i;
                };
                area.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true; selectedOption = null;
        }

        document.getElementById('nextBtn').onclick = () => {
            if (selectedOption === currentQuizQuestions[currentQuestionIdx].c) score += 20;
            currentQuestionIdx++;
            if (currentQuestionIdx < 5) showQuestion(); else showResults();
        };

        function showResults() {
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = score;
            const dash = (score / 100) * 100; // Stroke-dasharray format used in this file
            document.getElementById('scoreCircle').style.strokeDasharray = `${dash}, 100`;

            if (score >= 80) {
                document.getElementById('resultTitle').innerText = "Rất tuyệt vời!";
                document.getElementById('resultMsg').innerText = "Em đã hoàn thành bài tập xuất sắc. Tiếp tục phát huy nhé!";
            } else if (score >= 60) {
                document.getElementById('resultTitle').innerText = "Làm tốt lắm!";
                document.getElementById('resultMsg').innerText = "Em đã hiểu bài khá tốt rồi đấy!";
            } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên nhé!";
                document.getElementById('resultMsg').innerText = "Hãy xem lại bài đọc và làm lại bài tập để đạt điểm cao hơn.";
            }
        }

        function restartQuiz() {
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-registration').classList.remove('hidden');
        }

        /* FIREBASE CONFIG */
        const firebaseConfig = {
            apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
            authDomain: "gamhoctap.firebaseapp.com",
            databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gamhoctap",
            storageBucket: "gamhoctap.firebasestorage.app",
            messagingSenderId: "833329613932",
            appId: "1:833329613932:web:0d8574827bcfe50b535c49",
            measurementId: "G-YT1PKCYS67"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function submitResults(e) {
            const btn = e.target; btn.disabled = true; btn.innerText = "Đang gửi...";
            try {
                await db.collection("diem_tieng_viet_lop5").add({
                    ...studentData, lessonTitle: "Giỏ hoa tháng Năm", score: score, endTime: new Date().toISOString(), submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert(`Chúc mừng ${studentData.studentName} đã hoàn thành bài tập!`);
                restartQuiz(); switchTab('lesson');
            } catch (e) { alert("Lỗi khi gửi kết quả."); } finally { btn.disabled = false; btn.innerText = "NỘP KẾT QUẢ"; }
        }

        /* TEACHER STATS */
        function openTeacherStats() {
            const pin = prompt("Vui lòng nhập mã PIN bảo mật:");
            if (pin === "dvn") {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else if (pin !== null) {
                alert("Mã PIN không chính xác!");
            }
        }

        function closeModal() {
            document.getElementById('statsModal').classList.remove('active');
        }

        let currentStatsData = [];
        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td></tr>';
            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Giỏ hoa tháng Năm").get();
                tbody.innerHTML = '';
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td></tr>';
                    return;
                }
                const results = [];
                snapshot.forEach(doc => results.push(doc.data()));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));

                results.forEach((data, index) => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';
                    let duration = '---';
                    if (data.startTime && data.endTime) {
                        const diffMs = new Date(data.endTime) - new Date(data.startTime);
                        duration = `${Math.floor(diffMs / 60000)} phút ${Math.floor((diffMs % 60000) / 1000)} giây`;
                    }
                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50 text-sm bg-white";
                    tr.innerHTML = `
                        <td class="p-4 font-bold text-gray-400">${index + 1}</td>
                        <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
                        <td class="p-4 text-gray-600">${data.className}</td>
                        <td class="p-4 text-gray-600">${data.school}</td>
                        <td class="p-4 text-center">
                            <span class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 50 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">${data.score}/100</span>
                        </td>
                        <td class="p-4 text-center text-gray-600 font-bold">${duration}</td>
                        <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (e) { tbody.innerHTML = '<tr><td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu.</td></tr>'; }
        }

        function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            const wb = XLSX.utils.table_to_book(table, { sheet: "Kết quả", raw: true, cellStyles: true });
            const ws = wb.Sheets["Kết quả"];
            if (ws['!cols']) {
                ws['!cols'][2] = { t: 's' }; // Ensure 'Class' column is text
            } else {
                ws['!cols'] = [{ wch: 10 }, { wch: 25 }, { t: 's', wch: 10 }, { wch: 25 }, { wch: 10 }, { wch: 20 }, { wch: 20 }];
            }
            XLSX.writeFile(wb, "KetQua_GioHoaThangNam.xlsx");
        }
    </script>
    <a href="ve-dep-cuoc-song.html?week=21"
        class="fixed bottom-8 right-8 z-[100] group flex items-center space-x-3 bg-white/80 backdrop-blur-xl p-2 pr-6 rounded-2xl shadow-2xl border border-white/50 hover:scale-105 transition-all active:scale-95">
        <div
            class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200 group-hover:rotate-12 transition-transform">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        </div>
        <span class="text-sm font-black text-slate-700 uppercase tracking-wider">Trở về</span>
    </a>
</body>

</html>