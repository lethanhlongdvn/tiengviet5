<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hạt gạo làng ta - EduRobot</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Nunito & Merriweather -->
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
        }

        .serif-font {
            font-family: 'Merriweather', serif;
            font-size: 19px;
            line-height: 1.8;
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-open .accordion-content {
            max-height: 800px;
        }

        .accordion-open svg {
            transform: rotate(180deg);
        }

        .bg-paper {
            background-color: #fdfcf7;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
        }

        .poem-stanza {
            margin-bottom: 2rem;
        }

        /* Tab Styles */
        .tab-btn.active {
            border-bottom: 4px solid #1d4ed8;
            color: #1d4ed8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Quiz Styles */
        .quiz-option {
            transition: all 0.2s;
            border: 2px solid #e5e7eb;
        }

        .quiz-option:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .quiz-option.selected {
            border-color: #2563eb;
            background-color: #dbeafe;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 py-2 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <a href="index.html" class="flex items-center space-x-2">
                    <div
                        class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center text-white text-lg font-bold">
                        E</div>
                    <span class="text-lg font-extrabold text-blue-600 tracking-tight">EduRobot - <span
                            class="text-yellow-500">Tiếng Việt 5</span></span>
                </a>
            </div>

            <ul class="hidden md:flex space-x-6 font-semibold text-gray-600 text-sm">
                <li><a href="index.html" class="hover:text-blue-500 transition-colors">Trang chủ</a></li>
                <li><a href="ve-dep-cuoc-song.html"
                        class="hover:text-blue-500 transition-colors font-bold text-blue-600 border-b-2 border-blue-600">Bài
                        học</a></li>
                <li><a href="#" onclick="openTeacherStats()" class="hover:text-blue-500 transition-colors">Thống kê</a>
                </li>
                <li><a href="#" class="hover:text-blue-500 transition-colors">Liên hệ</a></li>
            </ul>
        </nav>
    </header>

    <main class="container mx-auto px-4 py-4">

        <!-- Navigation & Audio Player Header -->
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-4">
            <div>
                <a href="ve-dep-cuoc-song.html?week=20"
                    class="flex items-center text-gray-600 hover:text-blue-600 font-bold transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                </a>
            </div>
        </div>

        <div class="flex border-b border-gray-200 mb-6 bg-white rounded-t-2xl overflow-hidden shadow-sm">
            <button onclick="switchTab('lesson')" id="btn-lesson"
                class="tab-btn active flex-1 py-4 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                1. Bài học
            </button>
            <button onclick="switchTab('quiz')" id="btn-quiz"
                class="tab-btn flex-1 py-4 text-center font-bold text-gray-500 transition-all hover:bg-blue-50">
                2. Luyện tập
            </button>
        </div>

        <div id="tab-lesson" class="tab-content active">
            <div class="flex justify-end mb-4">
                <div
                    class="flex items-center space-x-4 bg-white rounded-full p-2 pr-6 shadow-sm border border-blue-100">
                    <button id="audioControl" onclick="toggleAudio()"
                        class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition-all shadow-lg shadow-blue-200">
                        <svg id="playIcon" class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 4l10 6-10 6V4z"></path>
                        </svg>
                        <svg id="pauseIcon" class="w-6 h-6 hidden" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd"
                                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                    <div>
                        <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest">Nghe đọc mẫu</p>
                        <p id="audioStatus" class="text-xs text-gray-400 font-bold italic">Đang dừng...</p>
                    </div>
                    <audio id="lessonAudio">
                        <source src="am_thanh/hatgaolangta.wav" type="audio/wav">
                    </audio>
                </div>
            </div>
            <div class="flex flex-col lg:flex-row gap-8">

                <!-- Cột trái (70%) - Bài đọc -->
                <section class="w-full lg:w-[70%]">
                    <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10">
                        <div class="mb-8 overflow-hidden rounded-2xl shadow-md">
                            <img src="hinh_anh/hat-gao-lang-ta.png" alt="Hạt gạo làng ta header"
                                class="w-full h-auto object-cover transform hover:scale-105 transition-transform duration-500">
                        </div>
                        <div
                            class="p-8 md:p-12 bg-paper rounded-2xl shadow-inner border border-gray-50 max-w-4xl mx-auto">
                            <div class="serif-font text-gray-800 text-left">
                                <h1 class="text-3xl font-black mb-2 text-blue-900 text-center">Hạt gạo làng ta</h1>
                                <p class="text-lg italic mb-8 text-gray-600 font-bold text-center">Trần Đăng Khoa</p>

                                <div class="md:columns-2 gap-12 md:gap-20">
                                    <div class="poem-stanza break-inside-avoid mb-8">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Có vị phù sa</p>
                                        <p>Của sông Kinh Thầy</p>
                                        <p>Có hương sen thơm</p>
                                        <p>Trong hồ nước đầy</p>
                                        <p>Có lời mẹ hát</p>
                                        <p>Ngọt bùi đắng cay...</p>
                                    </div>

                                    <div class="poem-stanza break-inside-avoid mb-8">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Có bão tháng Bảy</p>
                                        <p>Có mưa tháng Ba</p>
                                        <p>Giọt mồ hôi sa</p>
                                        <p>Những trưa tháng Sáu</p>
                                        <p>Nước như ai nấu</p>
                                        <p>Chết cả cá cờ</p>
                                        <p>Cua ngoi lên bờ</p>
                                        <p>Mẹ em xuống cấy...</p>
                                    </div>

                                    <div class="poem-stanza break-inside-avoid mb-8">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Những năm bom Mỹ</p>
                                        <p>Trút trên mái nhà</p>
                                        <p>Những năm cây súng</p>
                                        <p>Theo người đi xa</p>
                                        <p>Những năm băng đạn</p>
                                        <p>Vàng như lúa đồng</p>
                                        <p>Bát cơm mùa gặt</p>
                                        <p>Thơm hào giao thông...</p>
                                    </div>

                                    <div class="poem-stanza break-inside-avoid mb-8">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Có công các bạn</p>
                                        <p>Sớm nào chống hạn</p>
                                        <p>Vục mẻ miệng gàu</p>
                                        <p>Trưa nào bắt sâu</p>
                                        <p>Lúa cao rát mặt</p>
                                        <p>Chiều nào gánh phân</p>
                                        <p>Quang trành quết đất</p>
                                    </div>

                                    <div class="poem-stanza break-inside-avoid mb-8">
                                        <p>Hạt gạo làng ta</p>
                                        <p>Gửi ra tiền tuyến</p>
                                        <p>Gửi về phương xa</p>
                                        <p>Em vui em hát</p>
                                        <p>Hạt vàng làng ta.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Cột phải (30%) - Tìm hiểu bài -->
                <aside class="w-full lg:w-[30%]">
                    <div class="bg-yellow-50 rounded-[30px] shadow-sm border border-yellow-100 p-4 sticky top-20">
                        <h2 class="text-xl font-black text-blue-900 mb-4 flex items-center">
                            <span class="w-10 h-10 bg-yellow-400 rounded-xl flex items-center justify-center mr-3">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                    </path>
                                </svg>
                            </span>
                            Tìm hiểu bài
                        </h2>

                        <div class="space-y-4">
                            <!-- Câu 1 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        1. Hạt gạo kết tinh từ những tinh túy nào?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Chi tiết cho thấy hạt gạo được kết tinh từ những tinh túy của thiên nhiên là:
                                            <b>phù sa của sông Kinh Thầy, hương sen thơm trong hồ nước đầy</b>.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 2 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        2. Hạt gạo mang nét đẹp gì của người nông dân?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Bài thơ cho thấy <b>sự cần cù, chịu khó, tinh thần vượt lên thử thách khắc
                                                nghiệt</b> của thiên nhiên và tình yêu lao động của người nông dân.</p>
                                        <p class="mt-2">Hình ảnh: <i>bão tháng Bảy, mưa tháng Ba, giọt mồ hôi sa, nước
                                                như
                                                ai nấu (chết cả cá cờ, cua ngoi lên bờ), mẹ em xuống cấy...</i></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 3 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        3. Ý nghĩa "Bát cơm mùa gặt/ Thơm hào giao thông"?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Gợi lên hình ảnh những hạt gạo ấm áp nghĩa tình của hậu phương gửi ra tiền
                                            tuyến.
                                            Hạt gạo còn thơm mùi của những hào giao thông - biểu tượng của tinh thần
                                            kháng
                                            chiến chống Mỹ cứu nước.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 4 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        4. Đóng góp của các bạn nhỏ là gì?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Các bạn nhỏ đã tham gia: <b>chống hạn (vục mẻ miệng gàu), bắt sâu (lúa cao
                                                rát
                                                mặt), gánh phân (quang trành quết đất)</b> để cùng người lớn tạo ra hạt
                                            gạo.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Câu 5 -->
                            <div
                                class="accordion-item bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-50">
                                <button onclick="toggleAccordion(this)"
                                    class="w-full p-5 text-left flex justify-between items-center group">
                                    <span
                                        class="font-bold text-gray-700 group-hover:text-blue-600 transition-colors text-sm">
                                        5. Vì sao hạt gạo được gọi là "hạt vàng"?
                                    </span>
                                    <svg class="w-5 h-5 text-gray-400 transition-transform" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div class="accordion-content">
                                    <div
                                        class="px-5 pb-5 text-base text-gray-700 leading-relaxed border-t border-gray-50 pt-3">
                                        <span class="text-green-600 font-bold block mb-1">Gợi ý:</span>
                                        <p>Hạt gạo được gọi là <b>“hạt vàng”</b> là vì nó vô cùng quý giá. Nó được kết
                                            tinh
                                            từ đất trời và chứa đựng biết bao mồ hôi, công sức lao động vất vả, "một
                                            nắng
                                            hai sương" của con người mới làm ra được.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- Nội dung chính -->
            <div
                class="mt-2 bg-white rounded-[30px] shadow-sm border border-blue-100 p-6 md:p-8 overflow-hidden relative">
                <div class="absolute -right-10 -top-10 w-40 h-40 bg-blue-50 rounded-full opacity-50"></div>
                <div class="flex flex-col md:flex-row items-center gap-6 relative z-10">
                    <div
                        class="bg-blue-600 p-8 rounded-3xl text-white shadow-xl shadow-blue-200 shrink-0 text-center md:text-left">
                        <p class="text-xs font-bold uppercase tracking-widest opacity-80 mb-2">Thông điệp</p>
                        <h3 class="text-2xl font-black uppercase tracking-wider">Nội dung chính</h3>
                    </div>
                    <div class="flex-grow">
                        <p class="text-lg font-semibold leading-relaxed text-blue-900 mb-2">
                            Để làm ra hạt lúa, hạt gạo, người nông dân đã trải qua biết bao vất vả, khổ cực.
                        </p>
                        <p class="text-gray-600 leading-relaxed text-base">
                            Bài thơ ca ngợi tinh thần lao động bền bỉ, vượt khó của người nông dân và các bạn nhỏ. Qua
                            đó
                            nhắc nhở chúng ta phải biết <b>quý trọng công sức lao động</b> và trân quý hạt gạo mình ăn
                            mỗi
                            ngày.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Tab Content -->
        <div id="tab-quiz" class="tab-content">
            <div class="bg-white rounded-[30px] shadow-sm border border-gray-100 p-6 md:p-10 max-w-4xl mx-auto">
                <div id="quiz-registration">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-black text-blue-900 mb-2">THÔNG TIN HỌC SINH</h2>
                        <p class="text-gray-500">Vui lòng nhập thông tin để bắt đầu luyện tập: <b>Hạt gạo làng ta</b>
                        </p>
                    </div>
                    <form id="regForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">Họ và tên:</label>
                            <input type="text" id="studentName" required
                                class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                placeholder="Nhập đầy đủ họ tên của em">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Lớp:</label>
                                <select id="studentClass" required
                                    class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                    <option value="">-- Chọn lớp --</option>
                                    <option value="5/1">Lớp 5/1</option>
                                    <option value="5/2">Lớp 5/2</option>
                                    <option value="5/3">Lớp 5/3</option>
                                    <option value="5/4">Lớp 5/4</option>
                                    <option value="5/5">Lớp 5/5</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">Trường:</label>
                                <div class="relative">
                                    <select id="schoolSelect" onchange="checkSchool(this)"
                                        class="w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all">
                                        <option value="Tiểu học Đỗ Văn Nại">Tiểu học Đỗ Văn Nại</option>
                                        <option value="other">Trường khác...</option>
                                    </select>
                                    <input type="text" id="otherSchool"
                                        class="hidden mt-4 w-full p-4 border-2 border-gray-100 rounded-2xl focus:border-blue-500 outline-none transition-all"
                                        placeholder="Nhập tên trường của em">
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl shadow-xl shadow-blue-200 transition-all active:scale-95 text-lg uppercase tracking-wider">
                            Bắt đầu làm bài
                        </button>
                    </form>
                </div>

                <div id="quiz-container" class="hidden">
                    <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
                        <div class="flex items-center space-x-3">
                            <span id="questionNum"
                                class="w-12 h-12 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black text-xl">1</span>
                            <div>
                                <p class="text-[10px] font-bold text-blue-600 uppercase tracking-widest">Câu hỏi</p>
                                <p class="text-xs text-gray-400 font-bold" id="progressText">Đang thực hiện: 1/5</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Thời gian còn lại
                            </p>
                            <p id="timer" class="text-lg font-black text-blue-900">20:00</p>
                        </div>
                    </div>

                    <div id="questionArea" class="mb-8">
                        <h3 id="questionText" class="text-xl font-bold text-gray-800 mb-6 leading-relaxed"></h3>
                        <div id="optionsArea" class="grid grid-cols-1 gap-4"></div>
                    </div>

                    <div class="flex justify-end pt-6 border-t border-gray-100">
                        <button id="nextBtn" disabled
                            class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95 flex items-center">
                            Tiếp theo
                            <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div id="quiz-results" class="hidden text-center py-12">
                    <div class="mb-8 relative inline-block">
                        <svg class="w-48 h-48 mx-auto" viewBox="0 0 36 36">
                            <path class="text-gray-100" stroke-width="3" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path id="scoreCircle" class="text-green-500" stroke-width="3" stroke-dasharray="0, 100"
                                stroke-linecap="round" fill="none"
                                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="scoreText" class="text-5xl font-black text-blue-900">0</span>
                            <span class="text-sm font-bold text-gray-400 uppercase">Điểm</span>
                        </div>
                    </div>
                    <h2 class="text-3xl font-black text-gray-800 mb-2" id="resultTitle">Hoàn thành!</h2>
                    <p class="text-gray-500 mb-10" id="resultMsg">Chúc mừng em đã hoàn thành bài luyện tập.</p>

                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="restartQuiz()"
                            class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-50 font-bold py-4 px-10 rounded-2xl transition-all active:scale-95">Làm
                            lại</button>
                        <button onclick="submitResults()"
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-10 rounded-2xl shadow-lg transition-all active:scale-95">Nộp
                            bài</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Teacher Statistics Modal -->
        <div id="statsModal" class="modal">
            <div
                class="bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col m-4">
                <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-blue-600 text-white">
                    <h2 class="text-2xl font-black">THỐNG KÊ KẾT QUẢ HỌC TẬP</h2>
                    <div class="flex items-center space-x-2">
                        <button onclick="exportToExcel()"
                            class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-xl flex items-center text-sm font-bold shadow-lg transition-all">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            Xuất Excel
                        </button>
                        <button onclick="closeModal()" class="hover:bg-blue-700 p-2 rounded-full transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-6 overflow-x-auto flex-1">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 uppercase text-xs font-bold tracking-widest">
                                <th class="p-4 border-b">STT</th>
                                <th class="p-4 border-b">Họ và tên</th>
                                <th class="p-4 border-b">Lớp</th>
                                <th class="p-4 border-b">Trường</th>
                                <th class="p-4 border-b text-center">Điểm số</th>
                                <th class="p-4 border-b text-center">Thời gian làm</th>
                                <th class="p-4 border-b text-right">Thời gian nộp</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBody" class="text-sm"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-zinc-900 text-zinc-400 py-3 px-4 mt-2">
        <div class="container mx-auto text-center text-sm">
            <p>@ 2026 EduRobot - Phát triển bởi Lê Thành Long</p>
        </div>
    </footer>

    <script>
        /* FIREBASE CONFIG */
        const firebaseConfig = {
            apiKey: "AIzaSyC6zlWn8BKYU7P6A2-PYq6IIWOzaqJWFhc",
            authDomain: "gamhoctap.firebaseapp.com",
            databaseURL: "https://gamhoctap-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "gamhoctap",
            storageBucket: "gamhoctap.firebasestorage.app",
            messagingSenderId: "833329613932",
            appId: "1:833329613932:web:0d8574827bcfe50b535c49",
            measurementId: "G-YT1PKCYS67"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /* TEACHER STATS LOGIC */
        function openTeacherStats() {
            const pin = prompt("Vui lòng nhập mã PIN giáo viên:");
            if (pin === 'dvn') {
                document.getElementById('statsModal').classList.add('active');
                loadStats();
            } else if (pin !== null) {
                alert("Mã PIN không chính xác!");
            }
        }

        function closeModal() {
            document.getElementById('statsModal').classList.remove('active');
        }

        async function loadStats() {
            const tbody = document.getElementById('statsTableBody');
            tbody.innerHTML = `<tr>
        <td colspan="7" class="p-8 text-center text-gray-400">Đang tải dữ liệu...</td>
    </tr>`;
            try {
                const snapshot = await db.collection("diem_tieng_viet_lop5").where("lessonTitle", "==", "Hạt gạo làng ta").get();
                tbody.innerHTML = '';
                if (snapshot.empty) {
                    tbody.innerHTML = `<tr>
        <td colspan="7" class="p-8 text-center text-gray-400">Chưa có dữ liệu học tập.</td>
    </tr>`;
                    return;
                }
                const results = [];
                snapshot.forEach(doc => results.push(doc.data()));
                results.sort((a, b) => (b.submittedAt?.seconds || 0) - (a.submittedAt?.seconds || 0));
                results.forEach((data, index) => {
                    const date = data.submittedAt ? data.submittedAt.toDate().toLocaleString('vi-VN') : '---';

                    // Tính thời gian làm bài
                    let duration = '---';
                    if (data.startTime && data.endTime) {
                        const start = new Date(data.startTime);
                        const end = new Date(data.endTime);
                        const diffMs = end - start;
                        const mins = Math.floor(diffMs / 60000);
                        const secs = Math.floor((diffMs % 60000) / 1000);
                        duration = `${mins} phút ${secs} giây`;
                    }

                    const tr = document.createElement('tr');
                    tr.className = "hover:bg-blue-50 transition-colors border-b border-gray-50";
                    tr.innerHTML = `
    <td class="p-4 font-bold text-gray-400">${index + 1}</td>
    <td class="p-4 font-bold text-gray-800">${data.studentName}</td>
    <td class="p-4 text-gray-600">${data.className}</td>
    <td class="p-4 text-gray-600">${data.school}</td>
    <td class="p-4 text-center">
        <span
            class="px-3 py-1 rounded-full font-black ${data.score >= 80 ? 'bg-green-100 text-green-700' : data.score >= 50 ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'}">
            ${data.score}/100
        </span>
    </td>
    <td class="p-4 text-center text-gray-600 font-bold">${duration}</td>
    <td class="p-4 text-right text-xs text-gray-400 font-bold">${date}</td>
    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error("Error loading stats:", error);
                tbody.innerHTML = `<tr><td colspan="7" class="p-8 text-center text-red-500">Lỗi khi tải dữ liệu.</td></tr>`;
            }
        }

        function exportToExcel() {
            const table = document.querySelector("#statsModal table");
            // raw: true giúp giữ định dạng văn bản cho các cột như "Lớp"
            const wb = XLSX.utils.table_to_book(table, { sheet: "Kết quả", raw: true });
            XLSX.writeFile(wb, "ThongKe_GiaoVien_EduRobot.xlsx");
        }

        /* TAB LOGIC */
        function switchTab(tabId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active', 'text-blue-600'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('btn-' + tabId).classList.add('active', 'text-blue-600');
            document.getElementById('tab-' + tabId).classList.add('active');
        }

        /* REGISTRATION LOGIC */
        const otherSchoolInput = document.getElementById('otherSchool');
        function checkSchool(select) {
            if (select.value === 'other') {
                otherSchoolInput.classList.remove('hidden');
                otherSchoolInput.required = true;
            } else {
                otherSchoolInput.classList.add('hidden');
                otherSchoolInput.required = false;
            }
        }
        let studentData = {};
        document.getElementById('regForm').onsubmit = function (e) {
            e.preventDefault();
            studentData = {
                name: document.getElementById('studentName').value,
                className: document.getElementById('studentClass').value,
                school: document.getElementById('schoolSelect').value === 'other' ? document.getElementById('otherSchool').value :
                    document.getElementById('schoolSelect').value,
                startTime: new Date().toISOString()
            };
            document.getElementById('quiz-registration').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            startQuiz();
        };

        /* QUIZ ENGINE */
        const allQuestions = [
            {
                q: "Bài thơ \"Hạt gạo làng ta\" do nhà thơ nào sáng tác?", a: ["Tố Hữu", "Trần Đăng Khoa", "Phạm Tiến Duật",
                    "Nguyễn Duy"], c: 1
            },
            {
                q: "Dòng sông nào đã mang nặng phù sa bồi đắp cho hạt gạo làng ta?", a: ["Sông Hồng", "Sông Đuống", "Sông Cửu Long", "Sông Kinh Thầy"], c: 3
            },
            {
                q: "Ngoài vị phù sa và hương sen thơm, trong khổ thơ đầu, hạt gạo còn chứa đựng điều gì sâu sắc từ người mẹ?", a:
                    ["Lời ru buồn", "Lời mẹ hát ngọt bùi đắng cay", "Những câu chuyện cổ tích", "Tiếng cười vui vẻ"], c: 1
            },
            {
                q: "Những khó khăn của thiên nhiên mà hạt gạo và người nông dân phải trải qua được nhắc đến trong khổ thơ thứ hai là gì?", a: ["Bão tháng Bảy, mưa tháng Ba", "Lũ lụt miền Trung", "Hạn hán kéo dài quanh năm", "Gió rét mùa đông"],
                c: 0
            },
            {
                q: "Hình ảnh \"Nước như ai nấu / Chết cả cá cờ\" gợi tả điều gì?", a: ["Nước sông bị ô nhiễm", "Người dân đang nấu nước sôi", "Cái nắng nóng khắc nghiệt của trưa tháng Sáu", "Cuộc sống ấm no, sung túc"], c: 2
            },
            {
                q: "Trước cái nắng nóng làm \"cua ngoi lên bờ\", hình ảnh người mẹ hiện lên như thế nào?", a: ["Mẹ nghỉ ngơi dưới bóng cây", "Mẹ em xuống cấy", "Mẹ về nhà tránh nắng", "Mẹ ngồi quạt mát cho con"], c: 1
            },
            {
                q: "Khổ thơ thứ ba nhắc đến bối cảnh lịch sử nào của đất nước?", a: ["Thời kỳ xây dựng chủ nghĩa xã hội", "Những năm kháng chiến chống Pháp", "Những năm bom Mỹ trút trên mái nhà", "Thời kỳ bao cấp"], c: 2
            },
            {
                q: "Trong những năm tháng chiến tranh, hạt gạo đã theo người đi xa như thế nào?", a: ["Trong những năm băng đạn, bát cơm mùa gặt thơm hào giao thông", "Được chở bằng xe tải lớn ra chiến trường", "Được cất giấu kỹ trong kho", "Chỉ dùng để nuôi quân ở hậu phương"], c: 0
            },
            {
                q: "Các bạn nhỏ trong bài thơ đã góp công sức làm ra hạt gạo bằng những việc làm nào?", a: ["Đi học và trông em",
                    "Nấu cơm giúp mẹ", "Chống hạn, vục mẻ miệng gàu, bắt sâu, gánh phân", "Chăn trâu và cắt cỏ"], c: 2
            },
            {
                q: "Câu thơ \"Quang trành quết đất\" nói lên điều gì về sự đóng góp của các bạn nhỏ?", a: ["Các bạn nhỏ rất ham chơi", "Sự vất vả, nỗ lực lao động của các bạn nhỏ dù tuổi còn nhỏ", "Các bạn nhỏ làm hỏng dụng cụ lao động", "Đất ngoài đồng rất dính"], c: 1
            },
            {
                q: "Hạt gạo làm ra được gửi đi đâu?", a: ["Chỉ để ăn trong gia đình", "Xuất khẩu ra nước ngoài", "Gửi ra tiền tuyến, gửi về phương xa", "Đem ra chợ bán"], c: 2
            },
            {
                q: "Vì sao tác giả gọi hạt gạo là \"hạt vàng\"?", a: ["Vì hạt gạo có màu vàng óng", "Vì hạt gạo bán được rất nhiều tiền", "Vì hạt gạo rất quý giá, được làm nên từ mồ hôi công sức của bao người", "Vì lúa chín trên đồng trông như vàng"], c: 2
            },
            {
                q: "Bài thơ ca ngợi phẩm chất tốt đẹp nào của người nông dân?", a: ["Cần cù, chịu khó, không ngại gian khổ và yêu lao động", "Thông minh, sáng tạo trong sản xuất", "Vui vẻ, lạc quan yêu đời", "Dũng cảm trong chiến đấu"], c: 0
            },
            {
                q: "Hình ảnh nào dưới đây thể hiện sự kết tinh của đất trời trong hạt gạo?", a: ["Giọt mồ hôi sa", "Vị phù sa, hương sen thơm", "Mẻ miệng gàu", "Hào giao thông"], c: 1
            },
            {
                q: "Qua bài thơ, tác giả muốn nhắc nhở chúng ta điều gì?", a: ["Phải biết tiết kiệm nước", "Phải chăm chỉ học tập", "Phải biết quý trọng hạt gạo và công sức của những người lao động", "Phải yêu thiên nhiên, đất nước"], c: 2
            }
        ];

        let currentQuizQuestions = [];
        let currentQuestionIdx = 0;
        let score = 0;
        let selectedOption = null;
        let timeLeft = 1200; // 20 minutes
        let timerInterval;

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                const mins = Math.floor(timeLeft / 60);
                const secs = timeLeft % 60;
                document.getElementById('timer').innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2,
                    '0')}`;
                if (timeLeft <= 0) { clearInterval(timerInterval); showResults(); }
            }, 1000);
        } function startQuiz() {
            currentQuizQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
            currentQuestionIdx = 0;
            score = 0;
            document.getElementById('timer').innerText = "20:00";
            timeLeft = 1200;
            startTimer();
            showQuestion();
        }

        function showQuestion() {
            const q = currentQuizQuestions[currentQuestionIdx];
            document.getElementById('questionNum').innerText = currentQuestionIdx + 1;
            document.getElementById('progressText').innerText = `Đang thực hiện: ${currentQuestionIdx +
                1}/${currentQuizQuestions.length}`;
            document.getElementById('questionText').innerText = q.q;
            const optionsArea = document.getElementById('optionsArea');
            optionsArea.innerHTML = '';
            q.a.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option w-full p-4 rounded-2xl text-left font-bold text-gray-700 flex items-center group';
                btn.innerHTML = `<span
            class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center mr-4 group-hover:bg-blue-100">${String.fromCharCode(65
                    + idx)}</span><span class="flex-1">${opt}</span>`;
                btn.onclick = () => selectOption(idx, btn);
                optionsArea.appendChild(btn);
            });
            document.getElementById('nextBtn').disabled = true;
            selectedOption = null;
        }

        function selectOption(idx, btn) {
            document.querySelectorAll('.quiz-option').forEach(b => b.classList.remove('selected', 'border-blue-500'));
            btn.classList.add('selected', 'border-blue-500');
            selectedOption = idx;
            document.getElementById('nextBtn').disabled = false;
        }

        document.getElementById('nextBtn').onclick = function () {
            if (selectedOption === currentQuizQuestions[currentQuestionIdx].c) {
                score += (100 / currentQuizQuestions.length);
            }
            currentQuestionIdx++;
            if (currentQuestionIdx < currentQuizQuestions.length) { showQuestion(); } else { showResults(); }
        }; function
            showResults() {
            clearInterval(timerInterval);
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('quiz-results').classList.remove('hidden');
            document.getElementById('scoreText').innerText = Math.round(score); const
                circle = document.getElementById('scoreCircle'); circle.setAttribute('stroke-dasharray',
                    `${Math.round(score)}, 100`); if (score >= 80) {
                        document.getElementById('resultTitle').innerText = "Xuất sắc!";
                        document.getElementById('resultMsg').innerText = "Em rất hiểu bài thơ. Hạt vàng thật quý phải không nào!";
                    } else if (score >= 50) {
                        document.getElementById('resultTitle').innerText = "Khá tốt!";
                        document.getElementById('resultMsg').innerText = "Em đã hiểu cơ bản về ý nghĩa bài thơ rồi đấy.";
                    } else {
                document.getElementById('resultTitle').innerText = "Cố gắng lên!";
                document.getElementById('resultMsg').innerText = "Em nên đọc lại bài và thử lại lần nữa nhé.";
            }
        }

        function restartQuiz() {
            clearInterval(timerInterval);
            document.getElementById('quiz-results').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            startQuiz();
        }

        async function submitResults() {
            const finalData = {
                studentName: studentData.name,
                className: studentData.className,
                school: studentData.school,
                lessonTitle: "Hạt gạo làng ta",
                score: score,
                startTime: studentData.startTime,
                endTime: new Date().toISOString(),
                submittedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            const btn = event.target;
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = "Đang gửi...";
            try {
                await db.collection("diem_tieng_viet_lop5").add(finalData);
                alert(`Chúc mừng em ${studentData.name}!\nKết quả của em đã được gửi thành công.\nĐiểm: ${score}/100`);
                switchTab('lesson');
            } catch (error) {
                console.error("Error submitting quiz:", error);
                alert("Lỗi khi nộp bài. Kiểm tra lại mạng nhé!");
            } finally {
                btn.disabled = false;
                btn.innerText = originalText;
            }
        }

        function toggleAccordion(button) {
            const item = button.parentElement;
            const isOpen = item.classList.contains('accordion-open');
            document.querySelectorAll('.accordion-item').forEach(el => el.classList.remove('accordion-open'));
            if (!isOpen) item.classList.add('accordion-open');
        }

        const audio = document.getElementById('lessonAudio');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const audioStatus = document.getElementById('audioStatus');
        function toggleAudio() {
            if (audio.paused) {
                audio.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                audioStatus.innerText = "Đang phát...";
                audioStatus.classList.remove('text-gray-400');
                audioStatus.classList.add('text-green-500');
            } else {
                audio.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                audioStatus.innerText = "Đang dừng...";
                audioStatus.classList.remove('text-green-500');
                audioStatus.classList.add('text-gray-400');
            }
        }
        audio.onended = function () {
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            audioStatus.innerText = "Đang dừng...";
            audioStatus.classList.remove('text-green-500');
            audioStatus.classList.add('text-gray-400');
        };
    </script>
</body>

</html>